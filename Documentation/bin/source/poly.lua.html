<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>S.P.E.C.T.R.E.</h1>


<ul>
  <li><a href="../manual.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/ai.lua.html">ai.lua</a></li>
  <li><a href="../source/dynamic_spawner.lua.html">dynamic_spawner.lua</a></li>
  <li><a href="../source/fileio.lua.html">fileio.lua</a></li>
  <li><a href="../source/object.lua.html">object.lua</a></li>
  <li><a href="../source/player_manager.lua.html">player_manager.lua</a></li>
  <li><a href="../source/point_manager.lua.html">point_manager.lua</a></li>
  <li><strong>poly.lua</strong></li>
  <li><a href="../source/spectre.lua.html">spectre.lua</a></li>
  <li><a href="../source/utils.lua.html">utils.lua</a></li>
  <li><a href="../source/world.lua.html">world.lua</a></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/AI.html">AI</a></li>
  <li><a href="../modules/DYNAMIC_SPAWNER.html">DYNAMIC_SPAWNER</a></li>
  <li><a href="../modules/FileIO.html">FileIO</a></li>
  <li><a href="../modules/OBJECT.html">OBJECT</a></li>
  <li><a href="../modules/PLAYER_MANAGER.html">PLAYER_MANAGER</a></li>
  <li><a href="../modules/POINT_MANAGER.html">POINT_MANAGER</a></li>
  <li><a href="../modules/POLY.html">POLY</a></li>
  <li><a href="../modules/SPECTRE.html">SPECTRE</a></li>
  <li><a href="../modules/Utils.html">Utils</a></li>
  <li><a href="../modules/WORLD.html">WORLD</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/readme.md.html">readme</a></li>
</ul>

</div>

<div id="content">

    <h2>poly.lua</h2>
<pre>
<span class="comment">--- **SPECTRE.POLY**
</span><span class="comment">--
</span><span class="comment">-- POLYGON and shape operations.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">--      <a href="../modules/SPECTRE.html#">SPECTRE</a> ---&gt; ???
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">--  ***POLY for SPECTRE.***
</span><span class="comment">--
</span><span class="comment">--   * The POLY Class.
</span><span class="comment">--
</span><span class="comment">--   * All aspects of the POLY are accessed via this class.
</span><span class="comment">--
</span><span class="comment">--     -- Lorem Ipsum.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">--
</span><span class="comment">-- @module POLY
</span><span class="comment">-- @extends SPECTRE
</span>
env.info(<span class="string">" *** LOAD S.P.E.C.T.R.E. - POLY *** "</span>)

<span class="comment">---POLY.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- *POLYGON and shape operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section POLY
</span>
<span class="comment">--- ###POLY
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">--      POLYGON and shape operations.
</span><span class="comment">--
</span><span class="comment">-- * POLY for SPECTRE
</span><span class="comment">--
</span><span class="comment">--   * The POLY Class.
</span><span class="comment">--
</span><span class="comment">--   * All aspects of the POLY are accessed via this class.
</span><span class="comment">--
</span><span class="comment">-- @field #POLY
</span><span class="comment">-- @field ClassName SPECTRE.OBJECT.POLY
</span><a id="47"></a><span class="comment">-- @field ClassID The ID number of the class.
</span>SPECTRE.POLY = {
  ClassName = <span class="string">"POLY"</span>,
  ClassID = <span class="number">0</span>,
}

<span class="comment">---POLY.PointWithinShape.
</span><span class="comment">-- ===
</span><span class="comment">-- Checks if point is within shape.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section POLY.PointWithinShape
</span>
<span class="comment">---PointWithinShape.
</span><span class="comment">--
</span><span class="comment">--       1. Draw a horizontal line to the right of each point and extend it to infinity.
</span><span class="comment">--       2. Count the number of times the line intersects with polygon edges.
</span><span class="comment">--       3. A point is inside the polygon if either count of intersections is odd or point lies on an edge of polygon.
</span><span class="comment">--       4. If none of the conditions is true, then point lies outside.
</span><span class="comment">-- @param P The vec2 to test whether inside polygon or not.
</span><span class="comment">--
</span><span class="comment">--           P = {x=#,y=#}
</span><span class="comment">-- @param Polygon Polygon to test P against. Table of Vec2 points. #Polygon must be &gt;= 4
</span><span class="comment">--
</span><span class="comment">--        Polygon = {
</span><span class="comment">--                    [1] = {x = #, y = #},
</span><span class="comment">--                    [...] = {x = #, y = #},
</span><span class="comment">--                    [n] = {x = #, y = #},
</span><span class="comment">-- @return true
</span><a id="76"></a><span class="comment">-- @return false
</span><span class="keyword">function</span> SPECTRE.POLY.PointWithinShape(P, Polygon)
  <span class="keyword">local</span> inside
  inside = SPECTRE.POLY.checkInside(Polygon, P)
  <span class="keyword">return</span> inside
<span class="keyword">end</span>

<span class="comment">---POLY.PointWithinShape____.
</span><span class="comment">-- ===
</span><span class="comment">-- Child funtions used in ???.
</span><span class="comment">--
</span><span class="comment">-- - ???
</span><span class="comment">-- - ???
</span><span class="comment">-- - ???
</span><span class="comment">-- - ???
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section POLY.PointWithinShape____
</span>
<span class="comment">---onLine.
</span><span class="comment">--
</span><span class="comment">-- Checks if point is on a line.
</span><span class="comment">-- @param l1 line
</span><span class="comment">--
</span><span class="comment">--       l1 = {
</span><span class="comment">--              p1 = {x = #, y = #},
</span><span class="comment">--              p2 = {x = #, y = #},
</span><span class="comment">--       }
</span><span class="comment">-- @param p point
</span><span class="comment">--
</span><span class="comment">--       p = {x = #, y = #}
</span><span class="comment">-- @return true
</span><a id="108"></a><span class="comment">-- @return false
</span><span class="keyword">function</span> SPECTRE.POLY.onLine(l1, p)
  <span class="comment">-- Check whether p is on the line or not
</span>  <span class="keyword">if</span> (p.x &lt;= <span class="global">math</span>.max(l1.p1.x, l1.p2.x)
    <span class="keyword">and</span> p.x &lt;= <span class="global">math</span>.min(l1.p1.x, l1.p2.x)
    <span class="keyword">and</span> (p.y &lt;= <span class="global">math</span>.max(l1.p1.y, l1.p2.y)
    <span class="keyword">and</span> p.y &lt;= <span class="global">math</span>.min(l1.p1.y, l1.p2.y)
    )) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> <span class="keyword">false</span>
<span class="keyword">end</span>

<span class="comment">---direction.
</span><span class="comment">--
</span><span class="comment">-- Checks if point is on a line.
</span><span class="comment">-- @param a point, a = {x=#,y=#}
</span><span class="comment">-- @param b point, b = {x=#,y=#}
</span><span class="comment">-- @param c point, c = {x=#,y=#}
</span><span class="comment">-- @return 0 Colinear
</span><span class="comment">-- @return 1 Clockwise direction
</span><a id="129"></a><span class="comment">-- @return 2 Anti-clockwise direction
</span><span class="keyword">function</span> SPECTRE.POLY.direction(a, b, c)
  <span class="keyword">local</span> _1 = (b.y - a.y)
  <span class="keyword">local</span> _2 = (c.x - b.x)
  <span class="keyword">local</span> _3 = (b.x - a.x)
  <span class="keyword">local</span> _4 = (c.y - b.y)
  <span class="keyword">local</span> val = _1 * _2 - _3 * _4
  <span class="keyword">if</span> (val == <span class="number">0</span>) <span class="keyword">then</span>
    <span class="comment">-- Colinear
</span>    <span class="keyword">return</span> <span class="number">0</span>
  <span class="keyword">elseif</span> (val &lt; <span class="number">0</span>) <span class="keyword">then</span>
    <span class="comment">-- Anti-clockwise direction
</span>    <span class="keyword">return</span> <span class="number">2</span>
  <span class="keyword">end</span>
  <span class="comment">-- Clockwise direction
</span>  <span class="keyword">return</span> <span class="number">1</span>
<span class="keyword">end</span>

<span class="comment">---isIntersect.
</span><span class="comment">--
</span><span class="comment">-- Check if lines intersect.
</span><span class="comment">-- Lines are made from 2 Vec2 points.
</span><span class="comment">-- @param l1 line 1
</span><span class="comment">--
</span><span class="comment">--       l1 = {
</span><span class="comment">--              p1 = {x = #, y = #},
</span><span class="comment">--              p2 = {x = #, y = #},
</span><span class="comment">--       }
</span><span class="comment">-- @param l2 line 2
</span><span class="comment">--
</span><span class="comment">--       l2 = {
</span><span class="comment">--              p1 = {x = #, y = #},
</span><span class="comment">--              p2 = {x = #, y = #},
</span><span class="comment">--       }
</span><span class="comment">-- @return true Lines intersect
</span><a id="164"></a><span class="comment">-- @return false Lines do not intersect
</span><span class="keyword">function</span> SPECTRE.POLY.isIntersect(l1, l2)
  <span class="comment">-- Four direction for two lines and points of other line
</span>  <span class="keyword">local</span> dir1 = SPECTRE.POLY.direction(l1.p1, l1.p2, l2.p1)
  <span class="keyword">local</span> dir2 = SPECTRE.POLY.direction(l1.p1, l1.p2, l2.p2)
  <span class="keyword">local</span> dir3 = SPECTRE.POLY.direction(l2.p1, l2.p2, l1.p1)
  <span class="keyword">local</span> dir4 = SPECTRE.POLY.direction(l2.p1, l2.p2, l1.p2)
  <span class="comment">-- When intersecting
</span>  <span class="keyword">if</span> (dir1 ~= dir2 <span class="keyword">and</span> dir3 ~= dir4) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
  <span class="comment">-- When p2 of line2 are on the line1
</span>  <span class="keyword">if</span> (dir1 == <span class="number">0</span> <span class="keyword">and</span> SPECTRE.POLY.onLine(l1, l2.p1)) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
  <span class="comment">-- When p1 of line2 are on the line1
</span>  <span class="keyword">if</span> (dir2 == <span class="number">0</span> <span class="keyword">and</span> SPECTRE.POLY.onLine(l1, l2.p2)) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
  <span class="comment">-- When p2 of line1 are on the line2
</span>  <span class="keyword">if</span> (dir3 == <span class="number">0</span> <span class="keyword">and</span> SPECTRE.POLY.onLine(l2, l1.p1)) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
  <span class="comment">-- When p1 of line1 are on the line2
</span>  <span class="keyword">if</span> (dir4 == <span class="number">0</span> <span class="keyword">and</span> SPECTRE.POLY.onLine(l2, l1.p2)) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> <span class="keyword">false</span>
<span class="keyword">end</span>

<span class="comment">---checkInside.
</span><span class="comment">--
</span><span class="comment">--       1. Draw a horizontal line to the right of each point and extend it to infinity.
</span><span class="comment">--       2. Count the number of times the line intersects with polygon edges.
</span><span class="comment">--       3. A point is inside the polygon if either count of intersections is odd or point lies on an edge of polygon.
</span><span class="comment">--       4. If none of the conditions is true, then point lies outside.
</span><span class="comment">-- @param poly Polygon to test P against. Table of Vec2 points. #poly must be &gt;= 3, else returns false
</span><span class="comment">--
</span><span class="comment">--        poly = {
</span><span class="comment">--                    [1] = {x = #, y = #},
</span><span class="comment">--                    [...] = {x = #, y = #},
</span><span class="comment">--                    [n] = {x = #, y = #},
</span><span class="comment">-- @param p The vec2 to test whether inside polygon or not.
</span><span class="comment">--
</span><span class="comment">--           p = {x=#,y=#}
</span><span class="comment">-- @return true
</span><a id="210"></a><span class="comment">-- @return false
</span><span class="keyword">function</span> SPECTRE.POLY.checkInside(poly, p)
  <span class="keyword">local</span> n = #poly
  <span class="comment">-- When polygon has less than 3 edge, it is not polygon
</span>  <span class="keyword">if</span> (n &lt; <span class="number">3</span>) <span class="keyword">then</span>
    <span class="keyword">return</span> <span class="keyword">false</span>
  <span class="keyword">end</span>

  <span class="comment">-- Create a point at infinity, y is same as point p
</span>  <span class="keyword">local</span> tmp= {x = <span class="number">99999999</span>, y = p.y}
  <span class="keyword">local</span> exline = { p1 = p, p2 = tmp }
  <span class="keyword">local</span> count = <span class="number">0</span>
  <span class="keyword">local</span> i = <span class="string">"bunny"</span>
  <span class="keyword">while</span> (i ~= <span class="number">0</span>)
  <span class="keyword">do</span>
    <span class="keyword">if</span> i == <span class="string">"bunny"</span> <span class="keyword">then</span> i = <span class="number">1</span> <span class="keyword">end</span>
    <span class="comment">-- Forming a line from two consecutive points of
</span>    <span class="comment">-- poly
</span>    <span class="keyword">local</span> side
    <span class="keyword">if</span> ((i + <span class="number">1</span>) % n) == <span class="number">0</span> <span class="keyword">then</span>
      side = { p1 = poly[i], p2 = poly[n] }
    <span class="keyword">else</span>
      side = { p1 = poly[i], p2 = poly[(i + <span class="number">1</span>) % n] }
    <span class="keyword">end</span>
    <span class="keyword">if</span> (SPECTRE.POLY.isIntersect(side, exline)) <span class="keyword">then</span>

      <span class="comment">-- If side is intersects exline
</span>      <span class="keyword">if</span> (SPECTRE.POLY.direction(side.p1, p, side.p2) == <span class="number">0</span>) <span class="keyword">then</span>
        <span class="keyword">return</span> SPECTRE.POLY.onLine(side, p)
      <span class="keyword">end</span>
      count = count + <span class="number">1</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">if</span> (count % <span class="number">2</span>) == <span class="number">0</span> <span class="keyword">then</span>
    <span class="comment">--even
</span>    <span class="comment">--is not in poly
</span>    <span class="keyword">return</span> <span class="keyword">false</span>
  <span class="keyword">else</span>
    <span class="comment">--odd
</span>    <span class="comment">--is in poly
</span>    <span class="keyword">return</span> <span class="keyword">true</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">---POLY.Misc.
</span><span class="comment">-- ===
</span><span class="comment">-- Misc Poly functions.
</span><span class="comment">--
</span><span class="comment">--       You probably shouldnt use these.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section POLY.Misc
</span>
<span class="comment">--- BoundingBox.
</span><span class="comment">-- @param box
</span><span class="comment">-- @param tx
</span><span class="comment">-- @param ty
</span><span class="comment">-- @return (box[2].x &gt;= tx and box[2].y &gt;= ty) and (box[1].x &lt;= tx and box[1].y &lt;= ty)
</span><a id="268"></a><span class="comment">-- @return (box[1].x &gt;= tx and box[2].y &gt;= ty) and (box[2].x &lt;= tx and box[1].y &lt;= ty)
</span><span class="keyword">function</span> SPECTRE.POLY.BoundingBox(box, tx, ty)
  <span class="keyword">return</span>  (box[<span class="number">2</span>].x &gt;= tx <span class="keyword">and</span> box[<span class="number">2</span>].y &gt;= ty)
    <span class="keyword">and</span> (box[<span class="number">1</span>].x &lt;= tx <span class="keyword">and</span> box[<span class="number">1</span>].y &lt;= ty)
    <span class="keyword">or</span>  (box[<span class="number">1</span>].x &gt;= tx <span class="keyword">and</span> box[<span class="number">2</span>].y &gt;= ty)
    <span class="keyword">and</span> (box[<span class="number">2</span>].x &lt;= tx <span class="keyword">and</span> box[<span class="number">1</span>].y &lt;= ty)
<span class="keyword">end</span>

<span class="comment">--- colinear.
</span><span class="comment">-- @param line
</span><span class="comment">-- @param x
</span><span class="comment">-- @param y
</span><span class="comment">-- @param e
</span><a id="281"></a><span class="comment">-- @return math.abs(y - f(x)) &lt;= e
</span><span class="keyword">function</span> SPECTRE.POLY.colinear(line, x, y, e)
  e = e <span class="keyword">or</span> <span class="number">0.1</span>
  <span class="keyword">local</span> m = (line[<span class="number">2</span>].y - line[<span class="number">1</span>].y) / (line[<span class="number">2</span>].x - line[<span class="number">1</span>].x)
  <span class="keyword">local</span> <span class="keyword">function</span> f(x) <span class="keyword">return</span> line[<span class="number">1</span>].y + m*(x - line[<span class="number">1</span>].x) <span class="keyword">end</span>
  <span class="keyword">return</span> <span class="global">math</span>.abs(y - f(x)) &lt;= e
<span class="keyword">end</span>

<span class="comment">--- PointWithinLine.
</span><span class="comment">-- @param line
</span><span class="comment">-- @param tx
</span><span class="comment">-- @param ty
</span><span class="comment">-- @param e
</span><span class="comment">-- @return SPECTRE.POLY.colinear(line, tx, ty, e)
</span><a id="295"></a><span class="comment">-- @return false
</span><span class="keyword">function</span> SPECTRE.POLY.PointWithinLine(line, tx, ty, e)
  e = e <span class="keyword">or</span> <span class="number">0.66</span>
  <span class="keyword">if</span> SPECTRE.POLY.BoundingBox(line, tx, ty) <span class="keyword">then</span>
    <span class="keyword">return</span> SPECTRE.POLY.colinear(line, tx, ty, e)
  <span class="keyword">else</span>
    <span class="keyword">return</span> <span class="keyword">false</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">--- CrossingsMultiplyTest.
</span><span class="comment">-- @param pgon
</span><span class="comment">-- @param tx
</span><span class="comment">-- @param ty
</span><span class="comment">-- @return true
</span><a id="310"></a><span class="comment">-- @return false
</span><span class="keyword">function</span> SPECTRE.POLY.CrossingsMultiplyTest(pgon, tx, ty)
  <span class="keyword">local</span> i, yflag0, yflag1, inside_flag
  <span class="keyword">local</span> vtx0, vtx1
  <span class="keyword">local</span> numverts = #pgon
  vtx0 = pgon[numverts]
  vtx1 = pgon[<span class="number">1</span>]
  <span class="comment">-- get test bit for above/below X axis
</span>  yflag0 = ( vtx0.y &gt;= ty )
  inside_flag = <span class="keyword">false</span>
  <span class="keyword">for</span> i=<span class="number">2</span>,numverts+<span class="number">1</span> <span class="keyword">do</span>
    yflag1 = ( vtx1.y &gt;= ty )
    <span class="keyword">if</span> ( yflag0 ~= yflag1 ) <span class="keyword">then</span>
      <span class="keyword">if</span> ( ((vtx1.y - ty) * (vtx0.x - vtx1.x) &gt;= (vtx1.x - tx) * (vtx0.y - vtx1.y)) == yflag1 ) <span class="keyword">then</span>
        inside_flag =  <span class="keyword">not</span> inside_flag
      <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="comment">-- Move to the next pair of vertices, retaining info as possible.
</span>    yflag0  = yflag1
    vtx0    = vtx1
    vtx1    = pgon[i]
  <span class="keyword">end</span>
  <span class="keyword">return</span>  inside_flag
<span class="keyword">end</span>

<span class="comment">--- GetIntersect.
</span><span class="comment">--
</span><span class="comment">-- Checks for intersection of points, returns point of intersect.
</span><span class="comment">-- @param points
</span><a id="339"></a><span class="comment">-- @return xk, yk
</span><span class="keyword">function</span> SPECTRE.POLY.GetIntersect( points )
  <span class="keyword">local</span> g1 = points[<span class="number">1</span>].x
  <span class="keyword">local</span> h1 = points[<span class="number">1</span>].y

  <span class="keyword">local</span> g2 = points[<span class="number">2</span>].x
  <span class="keyword">local</span> h2 = points[<span class="number">2</span>].y

  <span class="keyword">local</span> i1 = points[<span class="number">3</span>].x
  <span class="keyword">local</span> j1 = points[<span class="number">3</span>].y

  <span class="keyword">local</span> i2 = points[<span class="number">4</span>].x
  <span class="keyword">local</span> j2 = points[<span class="number">4</span>].y

  <span class="keyword">local</span> xk = <span class="number">0</span>
  <span class="keyword">local</span> yk = <span class="number">0</span>

  <span class="keyword">if</span> SPECTRE.POLY.checkIntersect({x=g1, y=h1}, {x=g2, y=h2}, {x=i1, y=j1}, {x=i2, y=j2}) <span class="keyword">then</span>
    <span class="keyword">local</span> a = h2-h1
    <span class="keyword">local</span> b = (g2-g1)
    <span class="keyword">local</span> v = ((h2-h1)*g1) - ((g2-g1)*h1)

    <span class="keyword">local</span> d = i2-i1
    <span class="keyword">local</span> c = (j2-j1)
    <span class="keyword">local</span> w = ((j2-j1)*i1) - ((i2-i1)*j1)

    xk = (<span class="number">1</span>/((a*d)-(b*c))) * ((d*v)-(b*w))
    yk = (-<span class="number">1</span>/((a*d)-(b*c))) * ((a*w)-(c*v))
  <span class="keyword">end</span>
  <span class="keyword">return</span> xk, yk
<span class="keyword">end</span></pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2023-06-15 13:10:10 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
