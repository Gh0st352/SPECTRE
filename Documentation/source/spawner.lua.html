<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>S.P.E.C.T.R.E.</h1>


<ul>
  <li><a href="../manual.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/ai.lua.html">ai.lua</a></li>
  <li><a href="../source/brain.lua.html">brain.lua</a></li>
  <li><a href="../source/handlers.lua.html">handlers.lua</a></li>
  <li><a href="../source/iads.lua.html">iads.lua</a></li>
  <li><a href="../source/io.lua.html">io.lua</a></li>
  <li><a href="../source/markers.lua.html">markers.lua</a></li>
  <li><a href="../source/menu.lua.html">menu.lua</a></li>
  <li><a href="../source/plyrmgr.lua.html">plyrmgr.lua</a></li>
  <li><a href="../source/poly.lua.html">poly.lua</a></li>
  <li><a href="../source/rewards.lua.html">rewards.lua</a></li>
  <li><strong>spawner.lua</strong></li>
  <li><a href="../source/spectre.lua.html">spectre.lua</a></li>
  <li><a href="../source/utils.lua.html">utils.lua</a></li>
  <li><a href="../source/world.lua.html">world.lua</a></li>
  <li><a href="../source/zonemgr.lua.html">zonemgr.lua</a></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/AI.html">AI</a></li>
  <li><a href="../modules/BRAIN.html">BRAIN</a></li>
  <li><a href="../modules/HANDLERS.html">HANDLERS</a></li>
  <li><a href="../modules/IADS.html">IADS</a></li>
  <li><a href="../modules/IO.html">IO</a></li>
  <li><a href="../modules/MARKERS.html">MARKERS</a></li>
  <li><a href="../modules/MENU.html">MENU</a></li>
  <li><a href="../modules/PLYRMGR.html">PLYRMGR</a></li>
  <li><a href="../modules/POLY.html">POLY</a></li>
  <li><a href="../modules/REWARDS.html">REWARDS</a></li>
  <li><a href="../modules/SPAWNER.html">SPAWNER</a></li>
  <li><a href="../modules/SPECTRE.html">SPECTRE</a></li>
  <li><a href="../modules/UTILS.html">UTILS</a></li>
  <li><a href="../modules/WORLD.html">WORLD</a></li>
  <li><a href="../modules/ZONEMGR.html">ZONEMGR</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/readme.md.html">readme</a></li>
</ul>

</div>

<div id="content">

    <h2>spawner.lua</h2>
<pre>
<span class="comment">--- **SPAWNER**
</span><span class="comment">--
</span><span class="comment">-- *Automated Spawning System for SPECTRE*
</span><span class="comment">--
</span><span class="comment">-- The SPAWNER class is a sophisticated component of the SPECTRE system, dedicated to the automated
</span><span class="comment">-- spawning of dynamic simulation units. It serves as a centralized access point for all functionalities
</span><span class="comment">-- related to the dynamic generation, placement, and spawning of units within a simulated environment.
</span><span class="comment">--
</span><span class="comment">-- Features:
</span><span class="comment">--
</span><span class="comment">--   - **Dynamic Generation of DCS Units**:
</span><span class="comment">--      Efficiently generates units based on pre-defined or dynamic parameters.
</span><span class="comment">--   - **Intelligent Integration with Existing Elements**:
</span><span class="comment">--      Seamlessly integrates with existing elements in the simulation,
</span><span class="comment">--      such as ground and sea buildings, units, and objects,
</span><span class="comment">--      ensuring a cohesive and uninterrupted simulation experience.
</span><span class="comment">--   - **Non-Blocking Design**:
</span><span class="comment">--      Carefully engineered to avoid stalling or interfering with the main game thread,
</span><span class="comment">--      maintaining optimal performance and stability of the simulation.
</span><span class="comment">--   - **Configurable Generation Parameters**:
</span><span class="comment">--      Offers a high level of customization through a configuration table,
</span><span class="comment">--      allowing users to tailor the spawning process to specific needs and scenarios.
</span><span class="comment">--
</span><span class="comment">-- @module SPAWNER
</span><span class="comment">-- @extends SPECTRE
</span>
<span class="comment">--- 1 - Dynamic Spawner.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Dynamic Spawner operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- SPECTRE.SPAWNER.
</span><span class="comment">--
</span><span class="comment">-- *Core Module for Dynamic Unit Management in SPECTRE System*
</span><span class="comment">--
</span><span class="comment">-- This module plays a pivotal role in the SPECTRE system, providing advanced capabilities for
</span><span class="comment">-- dynamically generating, positioning, and deploying units within the simulation. It is crafted to
</span><span class="comment">-- offer a balance between automation and user-defined control, facilitating a realistic and
</span><span class="comment">-- dynamic simulation environment.
</span><span class="comment">--
</span><span class="comment">-- Responsibilities:
</span><span class="comment">--
</span><span class="comment">--   - **Automated Unit Generation**:
</span><span class="comment">--
</span><span class="comment">--       Automates the creation of units, leveraging both pre-set and adaptable generation logic.
</span><span class="comment">--
</span><span class="comment">--   - **Smart Placement and Positioning**:
</span><span class="comment">--
</span><span class="comment">--       Ensures units are placed in suitable and realistic locations,
</span><span class="comment">--       enhancing the authenticity of the simulation environment.
</span><span class="comment">--
</span><span class="comment">--   - **Customizable Spawning Mechanics**:
</span><span class="comment">--
</span><span class="comment">--       Empowers users with tools to customize various aspects of the spawning process,
</span><span class="comment">--       aligning with diverse simulation requirements.
</span><span class="comment">--
</span><span class="comment">--   - **Seamless Simulation Integration**:
</span><span class="comment">--
</span><span class="comment">--       Designed to integrate flawlessly with the broader SPECTRE system,
</span><span class="comment">--       contributing to a coherent and immersive simulation experience.
</span><span class="comment">--
</span><a id="66"></a><span class="comment">-- @field #SPAWNER
</span>SPECTRE.SPAWNER = {}

<span class="comment">--- Create a new SPAWNER instance.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for constructing a new instance of the SPAWNER class within the SPECTRE framework.
</span><span class="comment">-- It initializes the SPAWNER with base properties and configures it with a randomized seed for various operations.
</span><span class="comment">-- This setup is essential for the SPAWNER's functionality, which may include generating game entities or managing dynamic events.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="76"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:New()
  <span class="keyword">local</span> self=BASE:Inherit(self, SPECTRE:New())
  <span class="keyword">local</span> _randseedCount = SPECTRE.UTILS.generateNominal(self._randSeedNom, self._randSeedMin, self._randSeedMax, self._randSeedNudge)
  <span class="keyword">for</span> _seedC = <span class="number">1</span> , _randseedCount, <span class="number">1</span> <span class="keyword">do</span>
    <span class="global">math</span>.random()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>
<span class="comment">--- Initiate a lag reduction process at mission start.
</span><span class="comment">--
</span><span class="comment">-- This function serves as a preemptive measure to reduce server lag during spawns. It works by spawning and
</span><span class="comment">-- immediately deleting one instance of each Type Template Group found in the SPAWNER. This process helps cache
</span><span class="comment">-- these groups on the server, mitigating potential lag or hangs that can occur when SPAWNER spawns units faster
</span><span class="comment">-- than the game can cache them. This function should be used only at the start of a mission to optimize performance
</span><span class="comment">-- during subsequent spawn operations.
</span><span class="comment">--
</span><a id="93"></a><span class="comment">-- @param #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:LagBuster()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:LagBuster | START ---------------- |"</span>)
  <span class="keyword">for</span> _type, _typeObj <span class="keyword">in</span> <span class="global">pairs</span>(self.TEMPLATETYPES_) <span class="keyword">do</span>
    <span class="keyword">local</span> _spawns = {}
    <span class="keyword">for</span> _, _groupName <span class="keyword">in</span> <span class="global">ipairs</span>(_typeObj.GroupNames) <span class="keyword">do</span>
      _spawns[#_spawns + <span class="number">1</span>] = SPAWN:NewWithAlias(_groupName, _groupName .. <span class="string">"_LagBuster"</span>):Spawn()
    <span class="keyword">end</span>
    <span class="keyword">for</span> _, _group <span class="keyword">in</span> <span class="global">ipairs</span>(_spawns) <span class="keyword">do</span>
      _group:Destroy(<span class="keyword">false</span>)
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:LagBuster | END ---------------- |"</span>)
<span class="keyword">end</span>


<span class="comment">-- Random seed settings for generation processes within the SPAWNER system.
</span>
<a id="111"></a><span class="comment">--- The minimum value for the random seed.
</span>SPECTRE.SPAWNER._randSeedMin = <span class="number">500</span>
<a id="113"></a><span class="comment">--- The maximum value for the random seed.
</span>SPECTRE.SPAWNER._randSeedMax = <span class="number">2000</span>
<span class="comment">-- The nominal (default) value for the random seed.
</span>SPECTRE.SPAWNER._randSeedNom = <span class="number">2000</span>
<span class="comment">-- A factor to introduce variability in the random seed generation.
</span>SPECTRE.SPAWNER._randSeedNudge = <span class="number">0.7</span>

<span class="comment">-- Basic configurations and state indicators for the SPAWNER system.
</span>
<a id="122"></a><span class="comment">--- Sets the index reference for the SPAWNER class.
</span>SPECTRE.SPAWNER.__index = SPECTRE.SPAWNER
<a id="124"></a><span class="comment">--- Scheduler for managing spawn operations.
</span>SPECTRE.SPAWNER.MasterSpawnScheduler = {}
<a id="126"></a><span class="comment">--- Indicates if the generation process is complete.
</span>SPECTRE.SPAWNER.GenerationComplete = <span class="keyword">false</span>
<a id="128"></a><span class="comment">--- Indicates if the generation process is currently in progress.
</span>SPECTRE.SPAWNER.GenerationInProgress = <span class="keyword">false</span>
<a id="130"></a><span class="comment">--- A counter to keep track of spawned entities.
</span>SPECTRE.SPAWNER.COUNTER = <span class="number">1</span>

<span class="comment">-- Prefix and coalition/country settings for spawned units.
</span>
<a id="135"></a><span class="comment">--- A prefix string for spawned entities.
</span>SPECTRE.SPAWNER.PREFIX = <span class="string">""</span>
<a id="137"></a><span class="comment">--- Default coalition for spawned units.
</span>SPECTRE.SPAWNER.spawnCoalition = <span class="string">""</span>
<a id="139"></a><span class="comment">--- Default country for spawned units.
</span>SPECTRE.SPAWNER.spawnCountry = <span class="string">""</span>
<a id="141"></a><span class="comment">--- A prefix string for spawner templates to detect.
</span>SPECTRE.SPAWNER.TemplatePrefix = <span class="string">""</span>
<span class="comment">-- Type management containers for SPAWNER.
</span>
<a id="145"></a><span class="comment">--- Container for all types of entities to be spawned.
</span>SPECTRE.SPAWNER.AllTypes = {}
<a id="147"></a><span class="comment">--- Manipulatable container for entity types.
</span>SPECTRE.SPAWNER.AllTypesManip_ = {}
<a id="149"></a><span class="comment">--- Container for types with spawn limits.
</span>SPECTRE.SPAWNER.LimitedTypes = {}
<a id="151"></a><span class="comment">--- Container for types without spawn limits.
</span>SPECTRE.SPAWNER.NonLimitedTypes = {}

<span class="comment">-- Spawn count settings.
</span>
<a id="156"></a><span class="comment">--- Minimum count for total types.
</span>SPECTRE.SPAWNER._totalTypesMin = <span class="number">0</span>
<a id="158"></a><span class="comment">--- Maximum count for total types.
</span>SPECTRE.SPAWNER._totalTypesMax = <span class="number">0</span>
<a id="160"></a><span class="comment">--- Base delay in seconds between spawns.
</span>SPECTRE.SPAWNER._spawnDelay = <span class="number">6</span>
<a id="162"></a><span class="comment">--- Variance factor for spawn delay.
</span>SPECTRE.SPAWNER.spawnDelayVariance = <span class="number">0.5</span>
<a id="164"></a><span class="comment">--- Nominal count for total types.
</span>SPECTRE.SPAWNER._totalTypesNominal = <span class="number">0</span>


<span class="comment">-- Debugging configurations.
</span>
<a id="170"></a><span class="comment">--- Debug message level.
</span>SPECTRE.SPAWNER.DebugMessages = <span class="number">0</span>
<a id="172"></a><span class="comment">--- Player ID for debug menu display.
</span>SPECTRE.SPAWNER.DebugMenuPlayer = <span class="number">0</span>
<a id="174"></a><span class="comment">--- Logs for debugging purposes.
</span>SPECTRE.SPAWNER.BenchmarkLog = {}
<a id="176"></a><span class="comment">--- Indicates whether benchmarking is enabled.
</span>SPECTRE.SPAWNER.Benchmark = <span class="keyword">false</span>

<a id="179"></a><span class="comment">--- List of surface types where spawning is prohibited.
</span>SPECTRE.SPAWNER.NoGoSurface = {
  <span class="string">"WATER"</span>,        <span class="comment">-- Surface type: Water
</span>  <span class="string">"SHALLOW_WATER"</span>,<span class="comment">-- Surface type: Shallow Water
</span>  <span class="string">"RUNWAY"</span>,       <span class="comment">-- Surface type: Runway
</span>  <span class="string">"nil"</span>,          <span class="comment">-- Represents an undefined or non-existent surface type
</span>}

<span class="comment">--- Counter for co-routines within the SPAWNER system.
</span><a id="188"></a><span class="comment">-- Co-routines are functions that can be paused and resumed for complex tasks.
</span>SPECTRE.SPAWNER.Co_Counter = <span class="number">0</span>

<span class="comment">--- Indicates if persistence is enabled for the SPAWNER system.
</span><a id="192"></a><span class="comment">-- When true, SPAWNER maintains state across game sessions or events.
</span>SPECTRE.SPAWNER._persistence = <span class="keyword">false</span>

<a id="195"></a><span class="comment">--- Configurations for spawn count adjustments.
</span>SPECTRE.SPAWNER.nudgeFactor =  <span class="number">0.5</span>  <span class="comment">-- Factor for fine-tuning spawn counts.
</span>SPECTRE.SPAWNER.min =  <span class="number">0</span>            <span class="comment">-- Minimum spawn count.
</span>SPECTRE.SPAWNER.max = <span class="number">0</span>             <span class="comment">-- Maximum spawn count.
</span>SPECTRE.SPAWNER.nominal = <span class="number">0</span>         <span class="comment">-- Default spawn count.
</span>
<a id="201"></a><span class="comment">--- Container for additional types or groups in a specific zone.
</span>SPECTRE.SPAWNER._queueExtraTypeToGroupsZONE_A = {}

<a id="204"></a><span class="comment">--- Configurations for zone sizes within the SPAWNER system.
</span>SPECTRE.SPAWNER.ZoneSize = {
  Main = {
    <span class="comment">-- Minimum size of the main zone.
</span>    min = <span class="number">0</span>,
    <span class="comment">-- Maximum size of the main zone.
</span>    max = <span class="number">0</span>,
    <span class="comment">-- Default size of the main zone.
</span>    nominal = <span class="number">0</span>,
    <span class="comment">-- Adjustment factor for the main zone size.
</span>    nudgeFactor = <span class="number">0</span>,
    <span class="comment">-- Actual calculated size of the main zone.
</span>    Actual = <span class="number">0</span>
  },
  Sub = {
    <span class="comment">-- Minimum size of subzones.
</span>    min = <span class="number">0</span>,
    <span class="comment">-- Maximum size of subzones.
</span>    max = <span class="number">0</span>,
    <span class="comment">-- Default size of subzones.
</span>    nominal = <span class="number">0</span>,
    <span class="comment">-- Adjustment factor for subzone sizes.
</span>    nudgeFactor = <span class="number">0</span>,
    <span class="comment">-- Actual calculated size of subzones.
</span>    Actual = <span class="number">0</span>
  }
}

<a id="232"></a><span class="comment">--- Container for restricted zones within SPAWNER.
</span>SPECTRE.SPAWNER.ZonesRestricted = {}

<a id="235"></a><span class="comment">--- Container for generated subcircles within zones.
</span>SPECTRE.SPAWNER.generatedSubCircles = {}

<a id="238"></a><span class="comment">--- Vector position (Vec2) representing the main point or center for a zone.
</span>SPECTRE.SPAWNER.ZoneMainVec2 = {}

<a id="241"></a><span class="comment">--- Container for storing names of zones managed by SPAWNER.
</span>SPECTRE.SPAWNER.ZoneNames = {}

<span class="comment">--- persistenceFiles.
</span><span class="comment">-- Persistence file information for SPAWNER.
</span><a id="246"></a><span class="comment">-- Contains file paths and load status for persisted data.
</span>SPECTRE.SPAWNER._persistenceFiles = {
  SPAWNER = {name = <span class="string">""</span>, loaded = <span class="keyword">false</span>},           <span class="comment">-- File path and load status for SPAWNER.
</span>  TEMPLATETYPES_ = {name = <span class="string">""</span>, loaded = <span class="keyword">false</span>},    <span class="comment">-- File path and load status for template types.
</span>  ZONES = {name = <span class="string">""</span>, loaded = <span class="keyword">false</span>}              <span class="comment">-- File path and load status for zones.
</span>}

<span class="comment">--- Zones.
</span><span class="comment">-- Zone configurations within SPAWNER.
</span><a id="255"></a><span class="comment">-- Contains definitions for main, sub, and restricted zones used in spawning.
</span>SPECTRE.SPAWNER.Zones = {
  Main = {},         <span class="comment">-- Main zones for spawning.
</span>  Sub = {},          <span class="comment">-- Subzones for detailed spawn management.
</span>  Restricted = {}    <span class="comment">-- Zones where spawning is restricted or controlled.
</span>}

<span class="comment">--- 2 - typeENUMS.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All typeENUMS.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- typeENUMS.
</span><span class="comment">--
</span><span class="comment">-- This table provides a mapping of enumerated type names to their descriptive string representation in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">-- It serves as a dictionary for type names, ensuring consistent naming and easy reference across the system.
</span><span class="comment">--
</span><a id="275"></a><span class="comment">-- @field #SPAWNER.typeENUMS
</span>SPECTRE.SPAWNER.typeENUMS =  {}
<a id="277"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Ships = <span class="string">"Ships"</span>
<a id="279"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.UnarmedShips = <span class="string">"Unarmed ships"</span>
<a id="281"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.ArmedShips = <span class="string">"Armed ships"</span>
<a id="283"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.LightArmedShips = <span class="string">"Light armed ships"</span>
<a id="285"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.HeavyArmedShips = <span class="string">"Heavy armed ships"</span>
<a id="287"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Corvettes = <span class="string">"Corvettes"</span>
<a id="289"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Frigates = <span class="string">"Frigates"</span>
<a id="291"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Destroyers = <span class="string">"Destroyers"</span>
<a id="293"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Cruisers = <span class="string">"Cruisers"</span>
<a id="295"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.AircraftCarriers = <span class="string">"Aircraft Carriers"</span>
<a id="297"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.GroundUnits = <span class="string">"Ground Units"</span>
<a id="299"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Infantry = <span class="string">"Infantry"</span>
<a id="301"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.LightArmoredUnits = <span class="string">"LightArmoredUnits"</span>
<a id="303"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.IFV = <span class="string">"IFV"</span>
<a id="305"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.APC = <span class="string">"APC"</span>
<a id="307"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Artillery = <span class="string">"Artillery"</span>
<a id="309"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.MLRS = <span class="string">"MLRS"</span>
<a id="311"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.HeavyArmoredUnits = <span class="string">"HeavyArmoredUnits"</span>
<a id="313"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.ModernTanks = <span class="string">"Modern Tanks"</span>
<a id="315"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.OldTanks = <span class="string">"Old Tanks"</span>
<a id="317"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Tanks = <span class="string">"Tanks"</span>
<a id="319"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Buildings = <span class="string">"Buildings"</span>
<a id="321"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Fortifications = <span class="string">"Fortifications"</span>
<a id="323"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.GroundVehicles = <span class="string">"Ground vehicles"</span>
<a id="325"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.AAA = <span class="string">"AAA"</span>
<a id="327"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.AA_flak = <span class="string">"AA_flak"</span>
<a id="329"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.StaticAAA = <span class="string">"Static AAA"</span>
<a id="331"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.MobileAAA = <span class="string">"Mobile AAA"</span>
<a id="333"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.EWR = <span class="string">"EWR"</span>
<a id="335"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.UnarmedVehicles = <span class="string">"Unarmed vehicles"</span>
<a id="337"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Cars = <span class="string">"Cars"</span>
<a id="339"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.Trucks = <span class="string">"Trucks"</span>
<a id="341"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.SamElements = <span class="string">"SAM elements"</span>
<a id="343"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.IRGuidedSam = <span class="string">"IR Guided SAM"</span>
<a id="345"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.SRsam = <span class="string">"SR SAM"</span>
<a id="347"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.MRsam = <span class="string">"MR SAM"</span>
<a id="349"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.LRsam = <span class="string">"LR SAM"</span>
<a id="351"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.ArmedGroundUnits = <span class="string">"Armed ground units"</span>
<a id="353"></a><span class="comment">---.
</span>SPECTRE.SPAWNER.typeENUMS.MANPADS = <span class="string">"MANPADS"</span>

<span class="comment">--- 4 - Config.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Config associated with Dynamic Spawner operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>

<span class="comment">--- Config.
</span><span class="comment">-- Configuration settings for the <code>SPECTRE.SPAWNER</code>.
</span><a id="367"></a><span class="comment">-- This section defines various parameters used by the spawner system.
</span>SPECTRE.SPAWNER.Config = {
  operationLimit = <span class="number">150</span>,           <span class="comment">-- Number of operations the spawner can perform for an action.
</span>  operationInterval = <span class="number">0</span>,          <span class="comment">-- Interval in seconds between operations.
</span>  LimitedSpawnStrings = {},       <span class="comment">-- Table of strings limiting spawn conditions.
</span>  Types = {}                      <span class="comment">-- Table specifying different types of spawns.
</span>}

<span class="comment">--- 5 - Enable Toggles.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Enable Toggles.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Enables or disables the benchmarking mode for the SPAWNER instance.
</span><span class="comment">--
</span><span class="comment">-- This function serves to toggle the benchmarking mode in a SPAWNER instance. Benchmarking mode can be used to measure
</span><span class="comment">-- performance or other metrics within the SPAWNER's operations. When enabled, the SPAWNER instance may track additional
</span><span class="comment">-- data or operate differently to facilitate benchmarking.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param enabled Boolean value indicating whether to enable (true) or disable (false) the benchmarking mode.
</span><a id="391"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_Benchmark(enabled)
  self.Benchmark = enabled <span class="keyword">or</span> <span class="keyword">false</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Enables persistence for a SPECTRE.SPAWNER object.
</span><span class="comment">--
</span><span class="comment">-- This function activates persistence for the SPAWNER instance, allowing it to save its state across sessions.
</span><span class="comment">-- It sets up the necessary file paths for storing the spawner's data, including templates and zone information, under a unique spawner name.
</span><span class="comment">-- This capability is essential for maintaining continuity in game scenarios, ensuring that the state of the SPAWNER can be retrieved and
</span><span class="comment">-- restored accurately in subsequent sessions.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param spawnerName A unique name used as the identifier for saving the spawner object. This name is also used as the filename in the persistence database.
</span><a id="406"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:enablePersistence(spawnerName)
  <span class="comment">-- Debug Information
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:enablePersistence | Enabling persistence for spawner: "</span> .. spawnerName)

  <span class="comment">-- Activate persistence
</span>  self._persistence = <span class="keyword">true</span>

  <span class="comment">-- Set paths for saving different components of the spawner
</span>  self._persistenceFiles.SPAWNER.name = SPECTRE._persistenceLocations.SPAWNER.path .. spawnerName .. <span class="string">"/"</span> .. spawnerName .. <span class="string">".lua"</span>
  self._persistenceFiles.TEMPLATETYPES_.name = SPECTRE._persistenceLocations.SPAWNER.path .. spawnerName .. <span class="string">"/TYPETEMPLATES_/TEMPLATETYPES_.lua"</span>
  self._persistenceFiles.ZONES.name = SPECTRE._persistenceLocations.SPAWNER.path .. spawnerName .. <span class="string">"/ZONES/ZONES.lua"</span>

  <span class="comment">-- Debug output for constructed paths
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:enablePersistence | Paths:"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"  SPAWNER:        "</span> .. self._persistenceFiles.SPAWNER.name)
  SPECTRE.UTILS.debugInfo(<span class="string">"  TEMPLATETYPES_: "</span> .. self._persistenceFiles.TEMPLATETYPES_.name)
  SPECTRE.UTILS.debugInfo(<span class="string">"  ZONES:          "</span> .. self._persistenceFiles.ZONES.name)

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Resets the persistence settings of the SPECTRE spawner system.
</span><span class="comment">--
</span><span class="comment">-- This function disables persistence for the SPAWNER instance by setting the <code>_persistence</code> attribute to <code>false</code>. It also resets the filenames
</span><span class="comment">-- and loaded statuses within the <code>_persistenceFiles</code> attribute for SPAWNER and TEMPLATETYPES_ objects. This is essential for scenarios
</span><span class="comment">-- where persistence needs to be cleared or reconfigured, ensuring that the SPAWNER starts afresh without carrying over any previous state
</span><span class="comment">-- information.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="436"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:resetPersistence()
  self._persistence = <span class="keyword">false</span>
  self._persistenceFiles = {
    SPAWNER         = {name = <span class="string">""</span>, loaded = <span class="keyword">false</span>},
    TEMPLATETYPES_  = {name = <span class="string">""</span>, loaded = <span class="keyword">false</span>},
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- 6 - Setup.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All functions associated with Setup Operations*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Set the coalition for the SPAWNER.
</span><span class="comment">--
</span><span class="comment">-- This function assigns a specific coalition to the SPAWNER instance. The specified coalition
</span><span class="comment">-- is used for all spawn operations conducted by this SPAWNER. This setting is essential for
</span><span class="comment">-- defining the allegiance of the spawned units.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param coalition The coalition to be assigned to the SPAWNER.
</span><a id="462"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setCoalition(coalition)
  self.spawnCoalition = coalition
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set the country for the SPAWNER.
</span><span class="comment">--
</span><span class="comment">-- This function assigns a specific country to the SPAWNER instance. The specified country
</span><span class="comment">-- is used for all spawn operations conducted by this SPAWNER. This setting is crucial for
</span><span class="comment">-- defining the nationality of the spawned units.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param country The country to be assigned to the SPAWNER.
</span><a id="476"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setCountry(country)
  self.spawnCountry = country
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets a name prefix for all spawned groups by the SPAWNER instance.
</span><span class="comment">--
</span><span class="comment">-- This function assigns a specific prefix to be added to the names of all groups spawned by the SPAWNER instance.
</span><span class="comment">-- The prefix helps in identifying or categorizing groups based on different criteria or operational contexts within the game environment.
</span><span class="comment">-- This can be particularly useful for tracking or managing groups dynamically during gameplay.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param PREFIX The prefix string to be added to all spawned GROUP names.
</span><a id="490"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setNamePrefix(PREFIX)
  self.PREFIX = PREFIX <span class="keyword">or</span> <span class="string">""</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Configures the zones for the SPECTRE.SPAWNER class.
</span><span class="comment">--
</span><span class="comment">-- This function is pivotal in setting up the operational zones for the SPAWNER instance. It defines the main zone, optional subzones,
</span><span class="comment">-- and restricted zones where spawning is not permitted. The function ensures that the SPAWNER operates within designated areas,
</span><span class="comment">-- respecting any constraints imposed by no-go zones. This configuration is critical for maintaining the spatial integrity and strategic
</span><span class="comment">-- dynamics of spawned entities within the game environment.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param MainZone The name of the main zone for the spawner.
</span><span class="comment">-- @param SubZones (Optional) A list of names for all subzones. These are used for weighting spawn probabilities or distributions.
</span><span class="comment">-- @param NoGoZones (Optional) A list of names for all zones where spawning is explicitly prohibited.
</span><a id="507"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:SetZones(MainZone, SubZones, NoGoZones)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZones |  ---------------- |"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.SetZones = {Time = {},}
    self.BenchmarkLog.SetZones.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Debug Information
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZones | -------------------------------------------------------------------------"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZones | MainZone: "</span> .. MainZone)

  <span class="comment">-- Initialize optional tables if they aren't provided
</span>  SubZones = SubZones <span class="keyword">or</span> {}
  NoGoZones = NoGoZones <span class="keyword">or</span> {}

  <span class="comment">-- Debug output for subzones and restricted zones
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZones | SubZones: "</span>, <span class="global">table</span>.concat(SubZones, <span class="string">", "</span>))
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZones | NoGoZones: "</span>, <span class="global">table</span>.concat(NoGoZones, <span class="string">", "</span>))

  <span class="comment">-- Set the main zone
</span>  self.Zones.Main = self.Zone_:New(MainZone)

  <span class="comment">-- Set the subzones
</span>  <span class="keyword">for</span> _, zoneName <span class="keyword">in</span> <span class="global">ipairs</span>(SubZones) <span class="keyword">do</span>
    self.Zones.Sub[zoneName] = self.Zone_:New(zoneName)
  <span class="keyword">end</span>

  <span class="comment">-- Compute weights for zones
</span>  self:weightZones()

  <span class="comment">-- Set the restricted zones
</span>  self.Zones.Restricted = NoGoZones
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.SetZones.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Imports template settings into the SPAWNER instance.
</span><span class="comment">--
</span><span class="comment">-- This function takes a template object and applies its settings to the SPAWNER instance. It effectively updates the SPAWNER's configuration
</span><span class="comment">-- based on the provided template, allowing for dynamic customization or reconfiguration of the SPAWNER's behavior and attributes. This can
</span><span class="comment">-- be particularly useful for initializing the SPAWNER with predefined settings or for changing its operational parameters on the fly.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param template_ The template object containing settings to be imported into the SPAWNER instance.
</span><a id="554"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:ImportTemplate(template_)
  self = SPECTRE.UTILS.setTableValues(template_, self)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Detects and matches groups to templates based on a given prefix.
</span><span class="comment">--
</span><span class="comment">-- This function scans through groups in the game environment, matching them to predefined templates based on their names, which contain the specified prefix.
</span><span class="comment">-- It determines the template type with the highest priority for each matched group. The function also respects persistence settings, either loading existing templates
</span><span class="comment">-- or creating new ones based on detection results. An optional 'force' parameter can override persistence checks to ensure fresh detection.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param TemplatePrefix The prefix used to match group names against predefined templates.
</span><span class="comment">-- @param force (Optional) Boolean flag to force detection, ignoring existing persistence files.
</span><a id="569"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:DetectTypeTemplates(TemplatePrefix, force)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.DetectTypeTemplates = {Time = {},}
    self.BenchmarkLog.DetectTypeTemplates.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Default force to false if not provided
</span>  force = force <span class="keyword">or</span> <span class="keyword">false</span>
  <span class="comment">-- Debug information
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"Detecting type templates | Prefix: "</span> .. TemplatePrefix .. <span class="string">" | Force: "</span>, force)

  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:DetectTypeTemplates | SearchString: "</span> .. TemplatePrefix .. <span class="string">" | Force: "</span>, force)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:DetectTypeTemplates | PERSISTENCE:  "</span>, self._persistence)

  self.TemplatePrefix = TemplatePrefix

  self.TEMPLATETYPES_ = SPECTRE.BRAIN.checkAndPersist(
    self._persistenceFiles.TEMPLATETYPES_.name,
    force,
    self.TEMPLATETYPES_,
    self._persistence,
    <span class="keyword">function</span>(_Object)
      <span class="keyword">return</span> self:_detectHighestAttributes(TemplatePrefix, _Object)
    <span class="keyword">end</span>
  )
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.DetectTypeTemplates.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set the maximum amount and usage limitation for a specific template type.
</span><span class="comment">--
</span><span class="comment">-- This function updates the maximum value and usage limitation for a given template type in the <code>TEMPLATETYPES_</code> table
</span><span class="comment">-- of the <code>SPECTRE.SPAWNER</code> object. It sets the maximum value for the type, and optionally, a limitation flag that determines
</span><span class="comment">-- whether the spawner should restrict the use of this type when the configuration mathematics does not add up.
</span><span class="comment">-- This is particularly useful for hard-limiting certain types, like AAA/SAM spawns, to maintain gameplay balance.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param typeENUM The type enumeration key for the template type.
</span><span class="comment">-- @param max (Optional) The maximum value for the template type. Defaults to <code>9999</code> if not provided.
</span><span class="comment">-- @param limited (Optional) A boolean flag indicating whether to limit the use of this type. Defaults to <code>false</code>. If set to <code>true</code>, the spawner will not use these types as overflow selection.
</span><a id="611"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setTypeAmounts(typeENUM, max, limited)
  <span class="comment">-- Default values for min and max
</span>  max = max <span class="keyword">or</span> <span class="number">9999</span>
  limited = limited <span class="keyword">or</span> <span class="keyword">false</span>
  <span class="comment">-- Set values for the specified typeENUM
</span>  self.TEMPLATETYPES_[typeENUM].Max = max
  self.TEMPLATETYPES_[typeENUM].limited = limited

  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- 7 - Generation.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Generation operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Adds an extra type with a specified number to the SPAWNER groups.
</span><span class="comment">--
</span><span class="comment">-- This function is tasked with enhancing the SPAWNER groups by adding an additional type and its quantity.
</span><span class="comment">-- It updates the main spawn settings to include the new type and recalculates the total number of extra types and units.
</span><span class="comment">-- These adjustments are then applied to all sub-zones, ensuring a unified and coherent configuration across different zones.
</span><span class="comment">-- This function is pivotal for dynamically customizing the composition of spawned groups in the game environment.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _TYPE The type of entity or characteristic to be added.
</span><span class="comment">-- @param _numTYPE The number of entities or quantity of the specified type to add.
</span><a id="642"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:AddExtraTypeToGroups(_TYPE, _numTYPE)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:AddExtraTypeToGroups |  ---------------- |"</span>)
  <span class="keyword">local</span> setting = self.Zones.Main.SpawnAmountSettings
  <span class="keyword">if</span> <span class="keyword">not</span> setting.ExtraTypesToGroups[_TYPE] <span class="keyword">then</span> setting.ExtraTypesToGroups[_TYPE] = <span class="number">0</span> <span class="keyword">end</span>
  setting.ExtraTypesToGroups[_TYPE] = setting.ExtraTypesToGroups[_TYPE] + _numTYPE
  setting.numExtraTypes = SPECTRE.UTILS.sumTable(setting.ExtraTypesToGroups)
  setting.numExtraUnits = <span class="number">0</span>
  <span class="keyword">for</span> _t, _tv <span class="keyword">in</span> <span class="global">pairs</span>(setting.ExtraTypesToGroups) <span class="keyword">do</span>
    setting.numExtraUnits = setting.numExtraUnits + _tv
  <span class="keyword">end</span>
  <span class="comment">--  setting.numExtraUnits = setting.numExtraUnits + _numTYPE
</span>  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span> (self.Zones.Sub) <span class="keyword">do</span>
    <span class="keyword">local</span> settingSub = _zoneObject.SpawnAmountSettings
    <span class="keyword">if</span> <span class="keyword">not</span> settingSub.ExtraTypesToGroups[_TYPE] <span class="keyword">then</span> settingSub.ExtraTypesToGroups[_TYPE] = <span class="number">0</span> <span class="keyword">end</span>
    settingSub.ExtraTypesToGroups[_TYPE] = setting.ExtraTypesToGroups[_TYPE]
    settingSub.numExtraTypes = setting.numExtraTypes
    settingSub.numExtraUnits = setting.numExtraUnits
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Repeatedly apply the <code>_RollUpdates</code> method.
</span><span class="comment">--
</span><span class="comment">-- This function calls the <code>_RollUpdates</code> method multiple times, based on the value of
</span><span class="comment">-- <code>self.Zones.Main.SpawnAmountSettings.Generated.NudgeRecip</code>. The function's purpose is to ensure that
</span><span class="comment">-- updates are applied consistently across the spawner system. Debug information is output for each iteration
</span><span class="comment">-- if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1, providing details on the operation and iteration count.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="672"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Jiggle()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:Jiggle | ---------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Jiggle = {Time = {},}
    self.BenchmarkLog.Jiggle.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Debug: Print the total spawns and number of subzones
</span>  SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:Jiggle ------------------------------------- | SPAWNS TOTAL: %d | SPAWN DIVS: %d"</span>, self.Zones.Main.SpawnAmountSettings.Generated.Actual, self.Zones.Main.numSubZones))

  <span class="comment">-- Repeatedly apply the <code>_RollUpdates</code> method
</span>  <span class="keyword">for</span> _ = <span class="number">1</span>, self.Zones.Main.SpawnAmountSettings.Generated.NudgeRecip <span class="keyword">do</span>
    <span class="comment">-- Debug: Print the current cycle number
</span>    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:Jiggle ------------------------------------- | CYCLE   :  %d / %d"</span>, _, self.Zones.Main.SpawnAmountSettings.Generated.NudgeRecip))
    self:_RollUpdates()
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Jiggle.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>



<span class="comment">--- Set spawn amounts for both main and subzones.
</span><span class="comment">--
</span><span class="comment">-- This function configures the spawn amounts for the main zone and its subzones. It uses the provided nominal,
</span><span class="comment">-- minimum, maximum, and nudge factor values to calculate and set these amounts. The function ensures the calculated
</span><span class="comment">-- values are within the specified limits and applies them to each subzone. It also employs a 'jiggle' process to
</span><span class="comment">-- introduce randomness into the spawn amounts. Debug information, including configuration details and calculated values,
</span><span class="comment">-- is output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param nominal The nominal spawn amount.
</span><span class="comment">-- @param min The minimum spawn amount, with a default of 0 if not provided.
</span><span class="comment">-- @param max The maximum spawn amount, defaults to the nominal value if not provided.
</span><span class="comment">-- @param nudgeFactor The factor to introduce randomness, defaults to 0.5 if not provided.
</span><a id="710"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setSpawnAmounts(nominal, min, max, nudgeFactor)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:setSpawnAmounts | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.setSpawnAmounts = {Time = {},}
    self.BenchmarkLog.setSpawnAmounts.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>


  <span class="comment">-- Set default values for arguments if not provided
</span>  nudgeFactor = nudgeFactor <span class="keyword">or</span> <span class="number">0.5</span>
  min = min <span class="keyword">or</span> <span class="number">0</span>
  max = max <span class="keyword">or</span> nominal

  <span class="comment">-- Debug header
</span>  SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:setSpawnAmounts | CONFIG | NOMINAL: %d | MIN: %d | MAX: %d | NUDGE FACTOR: %f"</span>, nominal, min, max, nudgeFactor))

  <span class="comment">-- Calculate main zone values
</span>  self.Zones.Main.numSubZones = SPECTRE.UTILS.sumTable(self.Zones.Sub)
  self.Zones.Main:setSpawnAmounts(nominal, min, max, nudgeFactor):RollSpawnAmounts()

  <span class="comment">-- Calculate spawn configurations for subzones
</span>  <span class="keyword">local</span> avgDistribution = self.Zones.Main.SpawnAmountSettings.Generated.Actual / self.Zones.Main.numSubZones
  <span class="keyword">local</span> spawnsMax = <span class="global">math</span>.min(avgDistribution + avgDistribution * self.Zones.Main.SpawnAmountSettings.Generated.Ratio.Max,
    self.Zones.Main.SpawnAmountSettings.Generated.Max / self.Zones.Main.numSubZones)
  <span class="keyword">local</span> spawnsMin = <span class="global">math</span>.max(avgDistribution - avgDistribution * self.Zones.Main.SpawnAmountSettings.Generated.Ratio.Min,
    self.Zones.Main.SpawnAmountSettings.Generated.Min / self.Zones.Main.numSubZones)

  <span class="comment">-- Debug information for Zone configurations
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.DEBUGoutput.infoZoneCFG(self.Zones.Main)
    SPECTRE.UTILS.DEBUGoutput.infoZoneGEN(self.Zones.Main)
  <span class="keyword">end</span>

  <span class="comment">-- Set spawn amounts for each subzone
</span>  <span class="keyword">for</span> _, zoneObject_ <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    zoneObject_:setSpawnAmounts(avgDistribution, spawnsMin, spawnsMax, SPECTRE.UTILS.generateNudge(self.Zones.Main.SpawnAmountSettings.Generated.NudgeFactor)):RollSpawnAmounts()
  <span class="keyword">end</span>

  self:Jiggle()

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.setSpawnAmounts.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Calculate and assign weight to the main zone and its subzones.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for computing and assigning weights to both the main zone and its subzones
</span><span class="comment">-- within the SPAWNER system. The weight of each subzone is calculated based on its area relative to the main zone's area.
</span><span class="comment">-- After determining the weights for all subzones, the main zone's weight is adjusted accordingly to ensure
</span><span class="comment">-- that the total of all weights equals 1. This ensures a balanced distribution of importance or influence among
</span><span class="comment">-- the zones. Debug information related to the calculated weights and adjustments is output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a>
</span><span class="comment">-- is set to 1. Benchmark timing is recorded if enabled.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="767"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:weightZones()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:weightZones | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.weightZones = {Time = {},}
    self.BenchmarkLog.weightZones.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>


  <span class="keyword">local</span> mainZone = self.Zones.Main
  <span class="keyword">local</span> subZones = self.Zones.Sub
  <span class="keyword">local</span> totalWeight = <span class="number">0</span>

  <span class="comment">-- Calculate weights for each subzone
</span>  <span class="keyword">for</span> _, zoneObject_ <span class="keyword">in</span> <span class="global">pairs</span>(subZones) <span class="keyword">do</span>
    zoneObject_.weight = zoneObject_.area / mainZone.area
    totalWeight = totalWeight + zoneObject_.weight
  <span class="keyword">end</span>

  <span class="comment">-- Adjust main zone's weight
</span>  mainZone.weight = <span class="number">1</span> - totalWeight

  <span class="comment">-- Debug information for zone weights
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.DEBUGoutput.infoZoneWeights(mainZone, subZones)
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.weightZones.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Calculate and assign group settings for each subzone based on the specified group sizes.
</span><span class="comment">--
</span><span class="comment">-- This function determines the number and configuration of groups to be spawned in each subzone.
</span><span class="comment">-- It calculates the number of groups for different sizes based on the total spawn amount and specified
</span><span class="comment">-- group sizes. Each group is then configured with specific spacing settings, and a new group settings
</span><span class="comment">-- object is created for each group. The function provides detailed configuration for group distribution
</span><span class="comment">-- and layout within each subzone. Debug information regarding the group configurations and sizes is
</span><span class="comment">-- output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="809"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:RollSpawnGroupSizes()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:RollSpawnGroupSizes | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.RollSpawnGroupSizes = {Time = {},}
    self.BenchmarkLog.RollSpawnGroupSizes.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="comment">-- Debug header
</span>  SPECTRE.UTILS.DEBUGoutput.infoZoneGEN(self.Zones.Main)
  <span class="keyword">local</span> subZones = self.Zones.Sub

  <span class="keyword">for</span> zoneName_, zoneObject_ <span class="keyword">in</span> <span class="global">pairs</span>(subZones) <span class="keyword">do</span>
    <span class="comment">--SPECTRE.UTILS.DEBUGoutput.infoSubzoneGroupSizes(zoneObject_)
</span>
    <span class="keyword">local</span> groupSizes_ = zoneObject_.GroupSizes
    <span class="keyword">local</span> SpacingSettings_ = zoneObject_.SpacingSettings
    <span class="keyword">local</span> numTypesZone = zoneObject_.SpawnAmountSettings.Generated.Actual

    <span class="keyword">for</span> i = <span class="number">1</span>, #groupSizes_ <span class="keyword">do</span>
      <span class="keyword">local</span> size = groupSizes_[i]
      <span class="keyword">local</span> numGroupSize = <span class="global">math</span>.floor(numTypesZone / size)

      <span class="keyword">if</span> numGroupSize &gt; <span class="number">0</span> <span class="keyword">then</span>
        numTypesZone = numTypesZone - (numGroupSize * size)
        <span class="keyword">local</span> index_ = SPECTRE.UTILS.sumTable(zoneObject_.GroupSettings) + <span class="number">1</span>

        zoneObject_.GroupSettings[index_] = self:_createGroupSettings(size, numGroupSize, SpacingSettings_)

      <span class="keyword">end</span>
    <span class="keyword">end</span>
    SPECTRE.UTILS.DEBUGoutput.infoGroupSettings(zoneObject_)
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.RollSpawnGroupSizes.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the spacing configurations for a specified group size for all zones in the spawner.
</span><span class="comment">--
</span><span class="comment">-- This function is used to configure the spacing between groups and units within those groups
</span><span class="comment">-- for a specified group size across all subzones in the SPAWNER system. It allows setting minimum
</span><span class="comment">-- and maximum separations for both groups and individual units within groups. If specific values
</span><span class="comment">-- for these parameters are not provided, the function defaults to using values from
</span><span class="comment">-- <code>SPECTRE.SPAWNER.SpacingSettings_</code>. This configuration is crucial for maintaining organized
</span><span class="comment">-- and strategically placed spawns within the game environment.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param groupSize The size of the group for which spacing is being configured.
</span><span class="comment">-- @param groupMinSep (Optional) The minimum separation between groups, default value used if not specified.
</span><span class="comment">-- @param groupMaxSep (Optional) The maximum separation between groups, default value used if not specified.
</span><span class="comment">-- @param unitMinSep (Optional) The minimum separation between units within a group, default value used if not specified.
</span><span class="comment">-- @param unitMaxSep (Optional) The maximum separation between units within a group, default value used if not specified.
</span><span class="comment">-- @param distFromBuildings (Optional) The minimum distance from buildings, defaulting to 20 if not specified.
</span><a id="864"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setGroupSpacing(groupSize, groupMinSep, groupMaxSep, unitMinSep, unitMaxSep , distFromBuildings)
  <span class="keyword">for</span> zoneName_, zoneObject_ <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    zoneObject_:setGroupSpacing(groupSize, groupMinSep, groupMaxSep, unitMinSep, unitMaxSep , distFromBuildings)
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>
<span class="comment">--- Set the priority of group sizes for the main zone and its subzones.
</span><span class="comment">--
</span><span class="comment">-- This function assigns a set of group size priorities to the main zone and all subzones within the SPAWNER system.
</span><span class="comment">-- The group size priority is defined by an array where each element represents a group size and its index indicates
</span><span class="comment">-- its priority, with a lower index indicating a higher priority. This configuration determines the order in which
</span><span class="comment">-- different group sizes are considered during the spawning process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param groupSizePrio An array defining the group sizes and their priorities, e.g., <code>{[1] = 4, [2] = 3, [3] = 2, [4] = 1}</code>.
</span><a id="880"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setGroupSizePrio(groupSizePrio)
  self.Zones.Main.GroupSizes = groupSizePrio
  <span class="keyword">for</span> zoneName_, zoneObject_ <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    zoneObject_.GroupSizes = groupSizePrio
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Roll and assign group types for each subzone.
</span><span class="comment">--
</span><span class="comment">-- This function initiates the process of generating and assigning group types for each subzone within the SPAWNER system.
</span><span class="comment">-- It starts by seeding types using the <code>_seedTypes</code> method. Then, for each subzone, it generates group types and templates
</span><span class="comment">-- by calling <code>_generateGroupTypes</code> and <code>_generateGroupTemplates</code>. This comprehensive process ensures that each subzone
</span><span class="comment">-- is populated with appropriately sized and varied groups, according to the SPAWNER's configuration. Debug information
</span><span class="comment">-- is output for each step of the process if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled,
</span><span class="comment">-- providing performance metrics for the group rolling process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="899"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:RollSpawnGroupTypes()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:RollSpawnGroupTypes | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.RollSpawnGroupTypes = {Time = {},}
    self.BenchmarkLog.RollSpawnGroupTypes.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  self:_seedTypes()
  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    self:_generateGroupTypes(_zoneObject):_generateGroupTemplates(_zoneObject)
  <span class="keyword">end</span>

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.RollSpawnGroupTypes.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Determine and set placement for groups and units within each subzone.
</span><span class="comment">--
</span><span class="comment">-- This function handles the placement of groups and units in each subzone of the SPAWNER system.
</span><span class="comment">-- It iterates through all subzones, setting vector positions (<code>Vec2</code>) for both group centers and
</span><span class="comment">-- individual unit templates within those groups. The process ensures that each group and unit is
</span><span class="comment">-- appropriately positioned within the confines of their respective subzones. Debug information
</span><span class="comment">-- regarding the placement process is output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing
</span><span class="comment">-- is recorded if enabled, to monitor the efficiency of the placement process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="928"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:RollPlacement()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:RollPlacement | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.RollPlacement = {Time = {},}
    self.BenchmarkLog.RollPlacement.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    self:Set_Vec2_GroupCenters(_zoneObject):Set_Vec2_UnitTemplates(_zoneObject)
  <span class="keyword">end</span>

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.RollPlacement.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set up spawn groups for each subzone.
</span><span class="comment">--
</span><span class="comment">-- This function orchestrates the setup of spawn groups for each subzone within the SPAWNER system.
</span><span class="comment">-- It iterates through all subzones, invoking a setup process for each that configures the groups
</span><span class="comment">-- to be spawned according to the zone's settings. This setup includes determining group sizes, types,
</span><span class="comment">-- and positions. The process is vital for preparing each subzone with the appropriate spawn configurations
</span><span class="comment">-- before actual spawning takes place. Debug information is output for each subzone's setup process if
</span><span class="comment">-- <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled, to assess the efficiency
</span><span class="comment">-- of the setup process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="957"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:SetupSpawnGroups()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetupSpawnGroups | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.SetupSpawnGroups = {Time = {},}
    self.BenchmarkLog.SetupSpawnGroups.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    self:_SetupSpawnGroups(_zoneObject)
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.SetupSpawnGroups.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Trigger the spawning process for each subzone.
</span><span class="comment">--
</span><span class="comment">-- This function initiates the spawning of groups in each subzone managed by the SPAWNER. It iterates through
</span><span class="comment">-- all subzones, executing a spawn operation for each. This is the final step in the spawn process where the
</span><span class="comment">-- previously configured groups and units are actually instantiated in the game environment. Debug information
</span><span class="comment">-- is output for each subzone's spawn operation if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing
</span><span class="comment">-- is recorded if enabled, to assess the performance of the spawning process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="982"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Spawn()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:Spawn | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Spawn = {Time = {},}
    self.BenchmarkLog.Spawn.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    self:_Spawn(_zoneObject)
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Spawn.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Generate and spawn all groups and units as per the SPAWNER configuration.
</span><span class="comment">--
</span><span class="comment">-- This function encompasses the entire generation and spawning process for the SPAWNER. It rolls spawn group types,
</span><span class="comment">-- places groups and units, sets up spawn groups, and finally triggers the spawn. This function is the high-level
</span><span class="comment">-- orchestrator for all SPAWNER operations, ensuring that all necessary steps are taken to generate and spawn units
</span><span class="comment">-- according to the configured settings. Debug information and benchmark timing are output if enabled, providing
</span><span class="comment">-- insights into each step of the generation process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="1007"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Generate()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:Generate | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Generate = {Time = {},}
    self.BenchmarkLog.Generate.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  self:RollSpawnGroupTypes()
  self:RollPlacement()
  self:SetupSpawnGroups()
  self:Spawn()

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Generate.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>



<span class="comment">--- 8 - Utilities.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *Utilities for dynamic spawns*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Check if a vector position is within a no-go area.
</span><span class="comment">--
</span><span class="comment">-- This function determines whether a given vector position (<code>possibleVec2</code>) falls within any restricted
</span><span class="comment">-- areas or surfaces defined in the SPAWNER system. It first checks against no-go surfaces and then against
</span><span class="comment">-- restricted zones. The function returns a flag indicating whether the position is suitable (not within
</span><span class="comment">-- no-go areas) for spawning purposes. Debug information is output detailing the checks and their outcomes
</span><span class="comment">-- if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param possibleVec2 The vector position to be checked.
</span><span class="comment">-- @param restrictedZones A list of restricted zones to check against.
</span><a id="1047"></a><span class="comment">-- @return flag_goodcoord A boolean flag indicating if the position is outside no-go areas (true if suitable, false otherwise).
</span><span class="keyword">function</span> SPECTRE.SPAWNER.checkNOGO(self, possibleVec2, restrictedZones)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:checkNOGO | -------------------------------------------------------------------------"</span>)
  <span class="keyword">local</span> flag_goodcoord = <span class="keyword">true</span>
  <span class="keyword">if</span> self:vec2AtNoGoSurface(possibleVec2) <span class="keyword">then</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.checkNOGO | NOGO SURFACE: TRUE"</span>)
    flag_goodcoord = <span class="keyword">false</span>
  <span class="keyword">else</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.checkNOGO | NOGO SURFACE: FALSE"</span>)
  <span class="keyword">end</span>
  <span class="keyword">if</span> flag_goodcoord <span class="keyword">then</span>
    <span class="keyword">if</span> self:Vec2inZones(possibleVec2, restrictedZones) <span class="keyword">then</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.checkNOGO | NOGO ZONE: TRUE"</span>)
      flag_goodcoord = <span class="keyword">false</span>
    <span class="keyword">else</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.checkNOGO | NOGO ZONE: FALSE"</span>)
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> flag_goodcoord
<span class="keyword">end</span>

<span class="comment">--- Find and catalog all Object entities within a specified ZONE_RADIUS object.
</span><span class="comment">--
</span><span class="comment">-- This function scans a given ZONE_RADIUS object and identifies various Object entities present within it.
</span><span class="comment">-- It catalogs scenery, static objects, and units, including ground units, structures, and ships.
</span><span class="comment">-- The function creates a table, <code>ObjectCoords</code>, which categorizes and stores the coordinates of all detected objects.
</span><span class="comment">-- This data is essential for understanding the zone's composition and for making informed decisions about
</span><span class="comment">-- spawn placements and other operations within the zone.
</span><span class="comment">--
</span><span class="comment">-- Finds the following, then adds them to a table for tracking:
</span><span class="comment">--
</span><span class="comment">--       Object.Category.SCENERY
</span><span class="comment">--       Object.Category.STATIC
</span><span class="comment">--       Object.Category.UNIT
</span><span class="comment">--       Unit.Category.GROUND_UNIT
</span><span class="comment">--       Unit.Category.STRUCTURE
</span><span class="comment">--       Unit.Category.SHIP
</span><span class="comment">--
</span><span class="comment">--        ObjectCoords = {
</span><span class="comment">--                          building = {DATA},
</span><span class="comment">--                          others   = {DATA},
</span><span class="comment">--                          units    = {DATA},
</span><span class="comment">--                       }
</span><span class="comment">--
</span><span class="comment">-- @param _zone ZONE_RADIUS object to be scanned for objects.
</span><a id="1092"></a><span class="comment">-- @return ObjectCoords A table containing the coordinates of all objects detected in the zone, categorized by type.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.FindObjectsInZone(_zone)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.FindObjectsInZone | -------------------------------------------------------------------------"</span>)
  <span class="keyword">local</span> ObjectCoords = {
    buildings = {},
    others = {},
    units = {}
  }

  _zone:Scan({Object.Category.SCENERY, Object.Category.STATIC, Object.Category.UNIT}, {Unit.Category.GROUND_UNIT, Unit.Category.STRUCTURE, Unit.Category.SHIP})

  <span class="keyword">local</span> scanData = _zone.ScanData
  <span class="keyword">if</span> scanData <span class="keyword">then</span>
    <span class="comment">-- Scenery and Static objects
</span>    <span class="keyword">if</span> scanData.Scenery <span class="keyword">then</span>
      <span class="keyword">for</span> _, sceneryList <span class="keyword">in</span> <span class="global">pairs</span>(scanData.Scenery) <span class="keyword">do</span>
        <span class="keyword">for</span> _, scenery <span class="keyword">in</span> <span class="global">pairs</span>(sceneryList) <span class="keyword">do</span>
          <span class="keyword">local</span> description = scenery:GetDesc()
          <span class="keyword">if</span> description <span class="keyword">and</span> description.attributes <span class="keyword">and</span> description.attributes.Buildings <span class="keyword">then</span>
            ObjectCoords.buildings[#ObjectCoords.buildings + <span class="number">1</span>] = {x = scenery:GetCoordinate().x, y = scenery:GetCoordinate().z}
          <span class="keyword">else</span>
            ObjectCoords.others[#ObjectCoords.others + <span class="number">1</span>] = {x = scenery.SceneryObject:getPosition().p.x, y = scenery.SceneryObject:getPosition().p.z}
          <span class="keyword">end</span>
        <span class="keyword">end</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">-- Units
</span>    <span class="keyword">if</span> scanData.Units <span class="keyword">then</span>
      <span class="keyword">for</span> _, unit <span class="keyword">in</span> <span class="global">pairs</span>(scanData.Units) <span class="keyword">do</span>
        ObjectCoords.units[#ObjectCoords.units + <span class="number">1</span>] = {x = UNIT:FindByName(unit:getName()):GetPosition().p.x, y = UNIT:FindByName(unit:getName()):GetPosition().p.z}
      <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">-- Scenery Table
</span>    <span class="keyword">if</span> scanData.SceneryTable <span class="keyword">then</span>
      <span class="keyword">for</span> _, scenery <span class="keyword">in</span> <span class="global">ipairs</span>(scanData.SceneryTable) <span class="keyword">do</span>
        ObjectCoords.others[#ObjectCoords.others + <span class="number">1</span>] = {x = scenery.SceneryObject:getPosition().p.x, y = scenery.SceneryObject:getPosition().p.z}
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">return</span> ObjectCoords
<span class="keyword">end</span>

<span class="comment">--- Check if a given vector position is on a no-go surface.
</span><span class="comment">--
</span><span class="comment">-- This function evaluates the surface type at a specified vector position (<code>vec2</code>) and determines whether
</span><span class="comment">-- it matches any of the defined no-go surface types in the SPAWNER. If the surface type at the vector position
</span><span class="comment">-- is listed as a no-go surface, the function returns true, indicating that the location is unsuitable for certain
</span><span class="comment">-- operations like spawning. This check is crucial for ensuring that activities such as spawning occur only in
</span><span class="comment">-- appropriate areas.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param vec2 The vector position to be checked.
</span><a id="1147"></a><span class="comment">-- @return boolean true if the vector position is on a no-go surface, false otherwise.
</span><span class="keyword">function</span> SPECTRE.SPAWNER:vec2AtNoGoSurface(vec2)
  <span class="comment">-- local DEBUG = false or SPECTRE.DebugEnabled
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:vec2AtNoGoSurface | -------------------------------------------------------------------------")
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:vec2AtNoGoSurface | vec2.x : " .. vec2.x .. " | vec2.y : " .. vec2.y)
</span>
  <span class="keyword">local</span> surfaceType = COORDINATE:NewFromVec2(vec2):GetSurfaceType()
  <span class="keyword">local</span> Surfaces = {
    [<span class="number">1</span>] = <span class="string">"LAND"</span>,
    [<span class="number">2</span>] = <span class="string">"SHALLOW_WATER"</span>,
    [<span class="number">3</span>] = <span class="string">"WATER"</span>,
    [<span class="number">4</span>] = <span class="string">"ROAD"</span>,
    [<span class="number">5</span>] = <span class="string">"RUNWAY"</span>,
  }
  <span class="comment">-- SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:vec2AtNoGoSurface | surfaceType | " ..  Surfaces[surfaceType] or "NOT FOUND")
</span>  <span class="keyword">for</span> _, noGoSurface <span class="keyword">in</span> <span class="global">ipairs</span>(self.NoGoSurface) <span class="keyword">do</span>
    <span class="keyword">if</span> noGoSurface == Surfaces[surfaceType] <span class="keyword">then</span>
      <span class="comment">--SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:vec2AtNoGoSurface | NOGO SURFACE |")
</span>      <span class="keyword">return</span> <span class="keyword">true</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> <span class="keyword">false</span>
<span class="keyword">end</span>

<span class="comment">--- Determine if a given vector position is within a list of specified zones.
</span><span class="comment">--
</span><span class="comment">-- This function checks whether a provided vector position (<code>vec2</code>) falls within any of the zones listed in
</span><span class="comment">-- <code>zoneList</code>. The zones are expected to be quadpoint zones defined in the Mission Editor. If the vector
</span><span class="comment">-- position is found within any of these zones, the function returns true, indicating the location is within
</span><span class="comment">-- a restricted or designated area. This check is vital for validating positions against specific spatial
</span><span class="comment">-- constraints or boundaries.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param vec2 The vector position to be checked, in the format <code>{x = , y = }</code>.
</span><span class="comment">-- @param zoneList A list of zone names to check against, e.g., <code>{&quot;name1&quot;, &quot;name2&quot;, ..., &quot;nameN&quot;}</code>.
</span><a id="1182"></a><span class="comment">-- @return boolean true if the vector position is within any of the specified zones, false otherwise.
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Vec2inZones(vec2,zoneList)
  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:Vec2inZones | -------------------------------------------------------------------------")
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:Vec2inZones | vec2.x : " .. vec2.x .. " | vec2.y : " .. vec2.y)
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:Vec2inZones | zoneList |", zoneList)
</span>  <span class="keyword">local</span> result
  <span class="keyword">for</span> _v = <span class="number">1</span>, #zoneList, <span class="number">1</span> <span class="keyword">do</span>
    result = self:PointInZone(vec2, zoneList[_v])
    <span class="keyword">if</span> result <span class="keyword">then</span>
      <span class="keyword">return</span> <span class="keyword">true</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> <span class="keyword">false</span>
<span class="keyword">end</span>

<span class="comment">--- Determine if a given vector position is within a specified quadpoint zone.
</span><span class="comment">--
</span><span class="comment">-- This function checks if a specified vector position (<code>vec2</code>) is within the bounds of a given
</span><span class="comment">-- quadpoint zone, as defined in the Mission Editor. The zone is identified by its name. The function
</span><span class="comment">-- assesses whether the vector position falls within the geometric boundaries of the zone. This check
</span><span class="comment">-- is essential for spatial validation and ensuring that positions align with designated areas or
</span><span class="comment">-- operational boundaries.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param vec2 The vector position to be checked, in the format <code>{x = , y = }</code>.
</span><span class="comment">-- @param zoneName The name of the quadpoint zone as defined in the Mission Editor.
</span><a id="1208"></a><span class="comment">-- @return result Boolean value indicating whether the vector position is within the zone (true) or not (false).
</span><span class="keyword">function</span> SPECTRE.SPAWNER:PointInZone(vec2, zoneName)
  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:PointInZone | -------------------------------------------------------------------------")
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:PointInZone | vec2.x : " .. vec2.x .. " | vec2.y : " .. vec2.y)
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:PointInZone | vec2     |", vec2)
</span>  <span class="keyword">local</span> _zone = mist.DBs.zonesByName[zoneName]
  <span class="keyword">local</span> box =  _zone.verticies
  <span class="keyword">local</span> _vec2 = {}
  <span class="keyword">if</span> vec2.x == <span class="keyword">nil</span> <span class="keyword">then</span>
    _vec2.x = vec2[<span class="number">1</span>]
    _vec2.y = vec2[<span class="number">2</span>]
  <span class="keyword">else</span>
    _vec2 = vec2
  <span class="keyword">end</span>

  <span class="keyword">local</span> result = self:PointWithinShape(_vec2, box)
  <span class="keyword">return</span> result
<span class="keyword">end</span>

<span class="comment">--- Determine if a point lies within a given polygon shape.
</span><span class="comment">--
</span><span class="comment">-- This function uses a ray-casting algorithm to determine if a given point (<code>point</code>) is inside a specified polygon.
</span><span class="comment">-- The algorithm works by drawing a horizontal line to the right of the point and extending it to infinity, then
</span><span class="comment">-- counting the number of times this line intersects with the edges of the polygon. The point is considered inside
</span><span class="comment">-- the polygon if the count of intersections is odd or if the point lies on an edge of the polygon. This method is
</span><span class="comment">-- used for complex spatial checks, particularly useful in scenarios where geometric boundaries need to be accurately
</span><span class="comment">-- assessed.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param point The vector position to test, in the format <code>{x = #, y = #}</code>.
</span><span class="comment">-- @param polygon The polygon against which the point is being tested. It is a table of vector positions defining the polygon's vertices.
</span><a id="1239"></a><span class="comment">-- @return oddNodes True if the point is inside the polygon, false otherwise.
</span><span class="keyword">function</span> SPECTRE.SPAWNER:PointWithinShape(point, polygon)
  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:PointWithinShape | -------------------------------------------------------------------------")
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:PointWithinShape | vec2.x : " .. point.x .. " | vec2.y : " .. point.y)
</span>  <span class="comment">--  SPECTRE.UTILS.debugInfo("SPECTRE.SPAWNER:PointWithinShape | polygon |" , polygon)
</span>  <span class="keyword">local</span> i, j = #polygon, <span class="number">1</span>
  <span class="keyword">local</span> oddNodes = <span class="keyword">false</span>
  <span class="keyword">for</span> i = <span class="number">1</span>, #polygon <span class="keyword">do</span>
    <span class="keyword">if</span> (polygon[i].y &lt; point.y <span class="keyword">and</span> polygon[j].y &gt;= point.y <span class="keyword">or</span> polygon[j].y &lt; point.y <span class="keyword">and</span> polygon[i].y &gt;= point.y) <span class="keyword">then</span>
      <span class="keyword">if</span> (polygon[i].x + (point.y - polygon[i].y) / (polygon[j].y - polygon[i].y) * (polygon[j].x - polygon[i].x) &lt; point.x) <span class="keyword">then</span>
        oddNodes = <span class="keyword">not</span> oddNodes
      <span class="keyword">end</span>
    <span class="keyword">end</span>
    j = i
  <span class="keyword">end</span>
  <span class="keyword">return</span> oddNodes
<span class="keyword">end</span>


<span class="comment">--- 9 - Zone TypeDef.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- Defines properties and attributes associated with a zone in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">-- This table specifies various parameters related to the zone's configuration and settings.
</span><span class="comment">-- It includes information on zone dimensions, weighting, and group settings.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Defines properties and attributes associated with a zone in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">-- This table specifies various parameters related to the zone's configuration and settings.
</span><span class="comment">-- It includes information on zone dimensions, weighting, and group settings.
</span><a id="1272"></a><span class="comment">-- @field #SPAWNER.Zone_
</span>SPECTRE.SPAWNER.Zone_ = {
  <span class="comment">-- Name of the zone.
</span>  name = <span class="string">""</span>,
  <span class="comment">-- Object representing the zone.
</span>  Object = {},
  <span class="comment">-- Types available for ZoneSpawn.
</span>  Types = {},
  <span class="comment">-- Storage for spawner configurations.
</span>  BuiltSpawner = {},
  <span class="comment">-- Settings for groups within the zone.
</span>  GroupSettings = {},
  <span class="comment">-- Radius of the zone in meters.
</span>  radius = <span class="number">0</span>,
  <span class="comment">-- Area of the zone in square meters.
</span>  area = <span class="number">0</span>,
  <span class="comment">-- Weight associated with the zone, used in calculations.
</span>  weight = <span class="number">0</span>,
  <span class="comment">-- Number of sub-zones within the main zone.
</span>  numSubZones = <span class="number">0</span>,
  <span class="comment">-- Average distribution of entities within the zone.
</span>  avgDistribution = <span class="number">0</span>,
  <span class="comment">-- Priority of group sizes to be created within the zone.
</span>  GroupSizes = {
    [<span class="number">1</span>] = <span class="number">4</span>,
    [<span class="number">2</span>] = <span class="number">3</span>,
    [<span class="number">3</span>] = <span class="number">2</span>,
    [<span class="number">4</span>] = <span class="number">1</span>,
  },
  <span class="comment">-- Storage for obstacle coordinates within the zone.
</span>  ObjectCoords = {
    <span class="comment">-- Storage for the placement of spawned units within the zone.
</span>    groupcenters = {},
  },

}

<span class="comment">--- Create a new instance of the SPECTRE.SPAWNER.Zone_ object.
</span><span class="comment">--
</span><span class="comment">-- This constructor function initializes a new instance of the Zone_ object within the SPAWNER system.
</span><span class="comment">-- It sets up the zone with a specified name and initializes various properties such as the associated DCS zone object,
</span><span class="comment">-- its radius, area, and initial weight. The function also sets default group spacing settings for different group sizes.
</span><span class="comment">-- This setup is essential for managing zones and their characteristics within the SPAWNER framework.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.Zone_ self The instance of the Zone_ object being created.
</span><span class="comment">-- @param zoneName The name of the zone to be initialized.
</span><span class="comment">-- @return #SPAWNER.Zone_ self The newly created Zone_ instance with the specified configurations.
</span><a id="1319"></a><span class="comment">-- @usage local zoneInstance = SPECTRE.SPAWNER.Zone_:New("MyZone") -- Initializes and returns a new zone named "MyZone".
</span><span class="keyword">function</span> SPECTRE.SPAWNER.Zone_:New(zoneName)
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New())

  <span class="comment">-- Initialize properties based on the given zone name
</span>  self.name = zoneName
  self.Object = ZONE:FindByName(zoneName)
  self.radius = self.Object:GetRadius()
  self.area = <span class="global">math</span>.pi * (self.radius^<span class="number">2</span>)
  self.weight = <span class="number">0</span>

  <span class="comment">-- Set default group spacing settings
</span>  self:setGroupSpacing(<span class="number">1</span>, <span class="number">5</span>, <span class="keyword">nil</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">20</span>)
  self:setGroupSpacing(<span class="number">2</span>, <span class="number">25</span>, <span class="keyword">nil</span>, <span class="number">10</span>, <span class="number">35</span>, <span class="number">30</span>)
  self:setGroupSpacing(<span class="number">3</span>, <span class="number">30</span>, <span class="keyword">nil</span>, <span class="number">15</span>, <span class="number">35</span>, <span class="number">35</span>)
  self:setGroupSpacing(<span class="number">4</span>, <span class="number">35</span>, <span class="keyword">nil</span>, <span class="number">15</span>, <span class="number">40</span>, <span class="number">35</span>)

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Configure spawn amount settings for a specific zone.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for calculating and setting various spawn settings for a zone.
</span><span class="comment">-- It takes into consideration factors such as the zone's weight and adjusts spawn counts
</span><span class="comment">-- accordingly, computing threshold values to manage deviations. The settings include nominal,
</span><span class="comment">-- minimum, and maximum spawn counts, as well as a nudge factor for fine-tuning. These calculations
</span><span class="comment">-- are crucial for controlling the spawn behavior within the zone, ensuring spawns are aligned
</span><span class="comment">-- with strategic objectives.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.Zone_ self The instance of the Zone_ object being configured.
</span><span class="comment">-- @param nominal The nominal spawn count.
</span><span class="comment">-- @param min The minimum spawn count.
</span><span class="comment">-- @param max The maximum spawn count.
</span><span class="comment">-- @param nudgeFactor The nudge factor for adjusting spawn counts.
</span><span class="comment">-- @return #SPAWNER.Zone_ self The zone object with updated spawn amount settings.
</span><a id="1354"></a><span class="comment">-- @usage local modifiedZone = myZone:setSpawnAmounts(50, 40, 60, 0.2) -- Configures and returns spawn settings for 'myZone'.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.Zone_:setSpawnAmounts(nominal, min, max, nudgeFactor)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.Zone_:setSpawnAmounts |  ---------------- |"</span>)


  <span class="keyword">local</span> CFG = self.SpawnAmountSettings.Config  <span class="comment">-- Reference to config spawn settings
</span>
  <span class="comment">-- Configure spawn settings based on provided arguments
</span>  CFG.NudgeFactor = nudgeFactor
  CFG.NudgeRecip = nudgeFactor ~= <span class="number">0</span> <span class="keyword">and</span> <span class="number">1</span> / nudgeFactor <span class="keyword">or</span> <span class="number">0</span>
  CFG.Nominal = <span class="global">math</span>.ceil(nominal)
  CFG.Ratio.Max = max / nominal - <span class="number">1</span>
  CFG.Ratio.Min = min / nominal
  CFG.Max = <span class="global">math</span>.ceil(max)
  CFG.Min = <span class="global">math</span>.ceil(min)
  CFG.Weighted = <span class="global">math</span>.ceil(nominal * self.weight)
  CFG.DivisionFactor = CFG.Nominal / CFG.Weighted
  CFG.Actual = <span class="global">math</span>.ceil(SPECTRE.UTILS.generateNominal(CFG.Nominal, CFG.Min, CFG.Max, CFG.NudgeFactor))
  CFG.ActualWeighted = <span class="global">math</span>.ceil(CFG.Actual * self.weight)

  <span class="comment">-- Calculate threshold deviations
</span>  CFG.Thresholds = {
    overNom  = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Actual - CFG.Nominal),
    underNom = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Nominal - CFG.Actual),
    overMax  = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Actual - CFG.Max),
    underMax = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Max - CFG.Actual),
    overMin  = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Actual - CFG.Min),
    underMin = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Min - CFG.Actual)
  }

  <span class="comment">-- Output debug information if debugging is enabled
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.DEBUGoutput.infoZoneCFG(self)
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Generate and adjust spawn amount settings for a specific zone.
</span><span class="comment">--
</span><span class="comment">-- This function recalculates spawn settings for a zone based on the existing configuration.
</span><span class="comment">-- It derives a new nudge factor and adjusts spawn counts, ensuring they align with the strategic
</span><span class="comment">-- objectives of the zone. The function also calculates various threshold values to manage and
</span><span class="comment">-- understand deviations from nominal counts. This recalibration is crucial for dynamically
</span><span class="comment">-- adjusting spawns to changing conditions or requirements within the zone.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.Zone_
</span><span class="comment">-- @return #SPAWNER.Zone_ self
</span><a id="1402"></a><span class="comment">-- @usage local modifiedZone = myZone:RollSpawnAmounts() -- Recalculates and returns adjusted spawn settings for 'myZone'.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.Zone_:RollSpawnAmounts()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.Zone_:RollSpawnAmounts |  ---------------- |"</span>)
  <span class="keyword">local</span> GEN = self.SpawnAmountSettings.Generated  <span class="comment">-- Reference to generated spawn settings
</span>  <span class="keyword">local</span> CFG = self.SpawnAmountSettings.Config     <span class="comment">-- Reference to config spawn settings
</span>
  <span class="comment">-- Derive new nudge factor and related values
</span>  GEN.NudgeFactor = SPECTRE.UTILS.generateNudge(CFG.NudgeFactor)
  GEN.NudgeRecip = GEN.NudgeFactor ~= <span class="number">0</span> <span class="keyword">and</span> <span class="number">1</span> / GEN.NudgeFactor <span class="keyword">or</span> <span class="number">0</span>

  <span class="comment">-- Calculate spawn amounts based on derived nudge factor and zone's weight
</span>  GEN.Nominal = <span class="global">math</span>.ceil(SPECTRE.UTILS.generateNominal(CFG.Actual, CFG.Min, CFG.Max, GEN.NudgeFactor))
  GEN.Ratio.Max = CFG.Ratio.Max
  GEN.Ratio.Min = CFG.Ratio.Min
  GEN.Max = <span class="global">math</span>.ceil(<span class="global">math</span>.min(GEN.Nominal + (GEN.Nominal * GEN.Ratio.Max), CFG.Max))
  GEN.Min = <span class="global">math</span>.ceil(<span class="global">math</span>.max(GEN.Nominal - (GEN.Nominal * GEN.Ratio.Min), CFG.Min))
  GEN.Weighted = <span class="global">math</span>.ceil(GEN.Nominal * self.weight)
  GEN.DivisionFactor = GEN.Nominal / GEN.Weighted
  GEN.Actual = <span class="global">math</span>.ceil(SPECTRE.UTILS.generateNominal(GEN.Nominal, GEN.Min, GEN.Max, GEN.NudgeFactor))
  GEN.ActualWeighted = <span class="global">math</span>.ceil(GEN.Actual * self.weight)

  <span class="comment">-- Calculate threshold deviations
</span>  GEN.Thresholds = {
    overNom  = <span class="global">math</span>.max(<span class="number">0</span>, GEN.Actual - CFG.Nominal),
    underNom = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Nominal - GEN.Actual),
    overMax  = <span class="global">math</span>.max(<span class="number">0</span>, GEN.Actual - CFG.Max),
    underMax = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Max - GEN.Actual),
    overMin  = <span class="global">math</span>.max(<span class="number">0</span>, GEN.Actual - CFG.Min),
    underMin = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Min - GEN.Actual)
  }

  <span class="comment">-- Output debug information if debugging is enabled
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.DEBUGoutput.infoZoneGEN(self)
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Update the threshold values for the spawn amount settings of a zone.
</span><span class="comment">--
</span><span class="comment">-- This function recalculates the threshold values for a zone's spawn settings.
</span><span class="comment">-- It assesses how much the actual spawn count deviates from the nominal, minimum,
</span><span class="comment">-- and maximum counts defined in the configuration. These recalculated thresholds
</span><span class="comment">-- are crucial for understanding and managing spawn behavior in relation to
</span><span class="comment">-- the defined limits, ensuring that the spawning process remains controlled and
</span><span class="comment">-- within expected parameters.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.Zone_
</span><span class="comment">-- @return #SPAWNER.Zone_ self The zone object with updated threshold values.
</span><a id="1452"></a><span class="comment">-- @usage local modifiedZone = myZone:_UpdateGenThresholds() -- Updates and returns recalculated threshold values for 'myZone'.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.Zone_:_UpdateGenThresholds()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.Zone_:_UpdateGenThresholds |  ---------------- |"</span>)
  <span class="keyword">local</span> GEN = self.SpawnAmountSettings.Generated  <span class="comment">-- Reference to generated spawn settings
</span>  <span class="keyword">local</span> CFG = self.SpawnAmountSettings.Config     <span class="comment">-- Reference to config spawn settings
</span>
  <span class="comment">-- Calculate threshold deviations
</span>  GEN.Thresholds = {
    overNom  = <span class="global">math</span>.max(<span class="number">0</span>, GEN.Actual - CFG.Nominal),
    underNom = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Nominal - GEN.Actual),
    overMax  = <span class="global">math</span>.max(<span class="number">0</span>, GEN.Actual - CFG.Max),
    underMax = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Max - GEN.Actual),
    overMin  = <span class="global">math</span>.max(<span class="number">0</span>, GEN.Actual - CFG.Min),
    underMin = <span class="global">math</span>.max(<span class="number">0</span>, CFG.Min - GEN.Actual)
  }

  <span class="comment">-- Output debug information if debugging is enabled
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.DEBUGoutput.infoZoneGEN(self)
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set the spacing configurations for a specified group size within a zone.
</span><span class="comment">--
</span><span class="comment">-- This function configures the spacing settings for groups of a specific size within a zone.
</span><span class="comment">-- It sets the minimum and maximum separation distances between groups and between units within those groups.
</span><span class="comment">-- These configurations are vital for ensuring proper spacing and organization of spawned groups,
</span><span class="comment">-- avoiding overcrowding and ensuring tactical effectiveness. Default values are used if specific
</span><span class="comment">-- parameters are not provided.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.Zone_ self The instance of the Zone_ object being configured.
</span><span class="comment">-- @param groupSize The size of the group for which spacing settings are being configured.
</span><span class="comment">-- @param groupMinSep (Optional) The minimum separation distance between groups.
</span><span class="comment">-- @param groupMaxSep (Optional) The maximum separation distance between groups.
</span><span class="comment">-- @param unitMinSep (Optional) The minimum separation distance between units within a group.
</span><span class="comment">-- @param unitMaxSep (Optional) The maximum separation distance between units within a group.
</span><span class="comment">-- @param distFromBuildings (Optional) The minimum distance from nearby buildings.
</span><span class="comment">-- @return #SPAWNER.Zone_ self The zone object with updated group spacing settings.
</span><a id="1492"></a><span class="comment">-- @usage modifiedZone = myZone:setGroupSpacing(3, 10, 20, 2, 4) -- Configures spacing settings for groups of size 3 in 'myZone'.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.Zone_:setGroupSpacing(groupSize, groupMinSep, groupMaxSep, unitMinSep, unitMaxSep , distFromBuildings)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER.Zone_:setGroupSpacing |  ---------------- |"</span>)
  <span class="comment">-- Default spacing values from SPECTRE.SPAWNER.SpacingSettings_ if not provided
</span>  groupMinSep = groupMinSep <span class="keyword">or</span> SPECTRE.SPAWNER.SpacingSettings_.Groups.minSeperation
  groupMaxSep = groupMaxSep <span class="keyword">or</span> SPECTRE.SPAWNER.SpacingSettings_.Groups.maxSeperation
  unitMinSep  = unitMinSep  <span class="keyword">or</span> SPECTRE.SPAWNER.SpacingSettings_.Units.minSeperation
  unitMaxSep  = unitMaxSep  <span class="keyword">or</span> SPECTRE.SPAWNER.SpacingSettings_.Units.maxSeperation
  distFromBuildings = distFromBuildings <span class="keyword">or</span>  SPECTRE.SPAWNER.SpacingSettings_.DistanceFromBuildings
  <span class="comment">-- Initialize the spacing settings for the given group size
</span>  self.SpacingSettings[groupSize] = SPECTRE.SPAWNER.SpacingSettings_:New()
  self.SpacingSettings[groupSize].Groups = {
    minSeperation = groupMinSep,
    maxSeperation = groupMaxSep
  }
  self.SpacingSettings[groupSize].Units = {
    minSeperation = unitMinSep,
    maxSeperation = unitMaxSep
  }
  self.SpacingSettings[groupSize].DistanceFromBuildings = distFromBuildings  <span class="comment">-- Default distance from buildings
</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>


<span class="comment">--- Configuration settings for spawn amounts within a zone.
</span><span class="comment">--
</span><span class="comment">-- This template defines various settings related to the spawning of units or objects within a zone.
</span><span class="comment">-- It includes factors affecting spawn quantities, such as nudge factors, ratios, and thresholds.
</span><a id="1521"></a><span class="comment">-- @field #SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate
</span>SPECTRE.SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate = {
  <span class="comment">-- Extra types to be added to groups.
</span>  ExtraTypesToGroups = {},
  <span class="comment">-- Number of extra types to be added.
</span>  numExtraTypes = <span class="number">0</span>,
  <span class="comment">-- Number of extra units to be added.
</span>  numExtraUnits = <span class="number">0</span>,
  <span class="comment">-- Factor used to introduce variability in spawn counts.
</span>  NudgeFactor = <span class="number">0</span>,
  <span class="comment">-- Reciprocal of the nudge factor for adjustments.
</span>  NudgeRecip = <span class="number">0</span>,
  <span class="comment">-- Ratio settings for spawn counts.
</span>  Ratio = {
    <span class="comment">-- Maximum ratio for spawn count adjustment.
</span>    Max = <span class="number">0</span>,
    <span class="comment">-- Minimum ratio for spawn count adjustment.
</span>    Min = <span class="number">0</span>
  },
  <span class="comment">-- Maximum allowable spawn count.
</span>  Max = <span class="number">0</span>,
  <span class="comment">-- Minimum allowable spawn count.
</span>  Min = <span class="number">0</span>,
  <span class="comment">-- Factor for division in calculations.
</span>  DivisionFactor = <span class="number">0</span>,
  <span class="comment">-- Actual calculated spawn count.
</span>  Actual = <span class="number">0</span>,
  <span class="comment">-- Weight-adjusted actual spawn count.
</span>  ActualWeighted = <span class="number">0</span>,
  <span class="comment">-- Nominal or standard spawn count.
</span>  Nominal = <span class="number">0</span>,
  <span class="comment">-- Weighted nominal spawn count.
</span>  Weighted = <span class="number">0</span>,
  <span class="comment">-- Thresholds for deviation in spawn counts.
</span>  Thresholds = {
    <span class="comment">-- Over nominal threshold.
</span>    overNom = <span class="number">0</span>,
    <span class="comment">-- Under nominal threshold.
</span>    underNom = <span class="number">0</span>,
    <span class="comment">-- Over maximum threshold.
</span>    overMax = <span class="number">0</span>,
    <span class="comment">-- Under maximum threshold.
</span>    underMax = <span class="number">0</span>,
    <span class="comment">-- Over minimum threshold.
</span>    overMin = <span class="number">0</span>,
    <span class="comment">-- Under minimum threshold.
</span>    underMin = <span class="number">0</span>
  }
}

<span class="comment">--- Create a new instance of SpawnAmountSettingsConfigTemplate for a zone.
</span><span class="comment">--
</span><span class="comment">-- This constructor function initializes a new instance of the SpawnAmountSettingsConfigTemplate,
</span><span class="comment">-- which is part of the SPECTRE.SPAWNER.Zone_ system. The template is used to configure spawn amount
</span><span class="comment">-- settings for zones within the SPAWNER framework. The function employs inheritance from the BASE class
</span><span class="comment">-- to create an object with the properties and behaviors specific to spawn amount configurations.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate
</span><a id="1579"></a><span class="comment">-- @return #SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate self The newly created SpawnAmountSettingsConfigTemplate instance.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate:New()
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New())
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Defines properties and attributes for spacing settings in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">-- This table specifies parameters related to the separation distances between groups and units,
</span><span class="comment">-- and their distance from buildings.
</span><a id="1588"></a><span class="comment">-- @field #SPAWNER.SpacingSettings_
</span>SPECTRE.SPAWNER.SpacingSettings_ = {
  Groups = {
    <span class="comment">-- Minimum separation between groups in meters.
</span>    minSeperation = <span class="number">15</span>,
    <span class="comment">-- Maximum separation between groups in meters.
</span>    maxSeperation = <span class="number">30</span>
  },
  Units = {
    <span class="comment">-- Minimum separation between units within groups in meters.
</span>    minSeperation = <span class="number">15</span>,
    <span class="comment">-- Maximum separation between units within groups in meters.
</span>    maxSeperation = <span class="number">30</span>
  },
  <span class="comment">-- Minimum distance from buildings in meters.
</span>  DistanceFromBuildings = <span class="number">20</span>
}

<span class="comment">--- Create a new instance of SpacingSettings for the SPECTRE spawner system.
</span><span class="comment">--
</span><span class="comment">-- This constructor function initializes a new instance of SpacingSettings, a component of the SPECTRE spawner system.
</span><span class="comment">-- The newly created object is tailored to manage and configure the spacing
</span><span class="comment">-- settings for spawn operations, crucial for ensuring proper placement and distribution of spawned units.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.SpacingSettings_
</span><span class="comment">-- @return #SPAWNER.SpacingSettings_ self
</span><a id="1614"></a><span class="comment">-- @usage local spacingSettingsInstance = SPECTRE.SPAWNER.SpacingSettings_:New() -- Instantiates a new SpacingSettings object.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.SpacingSettings_:New()
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New())
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Configuration settings for spawn amounts within a zone.
</span><span class="comment">--
</span><span class="comment">-- This structure defines both the configured and dynamically generated settings related to the number of entities to be spawned within a zone.
</span><span class="comment">-- It includes extra types and units settings, as well as specific configurations for spawn amounts.
</span><a id="1624"></a><span class="comment">-- @field #SPAWNER.Zone_.SpawnAmountSettings
</span>SPECTRE.SPAWNER.Zone_.SpawnAmountSettings = {
  <span class="comment">-- Extra types to be added to groups within the zone.
</span>  ExtraTypesToGroups = {},
  <span class="comment">-- Number of extra types to be included in the spawn.
</span>  numExtraTypes = <span class="number">0</span>,
  <span class="comment">-- Number of extra units to be included in the spawn.
</span>  numExtraUnits = <span class="number">0</span>,
  <span class="comment">-- Configured settings for spawn amounts within the zone.
</span>  Config = SPECTRE.SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate:New(),
  <span class="comment">-- Dynamically generated settings based on the configuration.
</span>  Generated = SPECTRE.SPAWNER.Zone_.SpawnAmountSettingsConfigTemplate:New()
}

<span class="comment">--- Configuration settings for spacing within a zone.
</span><span class="comment">--
</span><span class="comment">-- This structure defines the general spacing configurations for groups and units within a zone.
</span><span class="comment">-- It includes settings for minimum and maximum separations between groups and units, and the distance from buildings.
</span><a id="1642"></a><span class="comment">-- @field #SPAWNER.Zone_.SpacingSettings
</span>SPECTRE.SPAWNER.Zone_.SpacingSettings = {
  <span class="comment">-- General spacing settings for the zone.
</span>  General = SPECTRE.SPAWNER.SpacingSettings_:New()
}



<span class="comment">--- 10 - ZONEMGR.
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with ZONEMGR operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Adds an extra type with a specified number to the AddExtraTypeToGroupsZONE_A queue.
</span><span class="comment">--
</span><span class="comment">-- This function is designed to augment the AddExtraTypeToGroupsZONE_A queue within the SPAWNER class by adding an additional type and its corresponding quantity.
</span><span class="comment">-- It is useful for dynamically adjusting the composition or characteristics of groups within a specific zone, allowing for customized and flexible game scenarios.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _TYPE The type of entity or characteristic to be added to the queue.
</span><span class="comment">-- @param _numTYPE The number of entities or quantity of the specified type to add.
</span><a id="1667"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:AddExtraTypeToGroupsZONE_A(_TYPE, _numTYPE)
  self._queueExtraTypeToGroupsZONE_A[_TYPE] = _numTYPE
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Applies the extra type settings from AddExtraTypeToGroupsZONE_A to AddExtraTypeToGroupsZONE_B.
</span><span class="comment">--
</span><span class="comment">-- This function transfers the extra type settings configured in GroupsZONE_A to AddExtraTypeToGroupsZONE_B within the SPAWNER class.
</span><span class="comment">-- It iterates through the types and quantities specified in the queue for AddExtraTypeToGroupsZONE_A and applies these settings to AddExtraTypeToGroupsZONE_B.
</span><span class="comment">-- This ensures consistency and synchronization of extra types across different zones, facilitating coherent and balanced game dynamics.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="1680"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:AddExtraTypeToGroupsZONE_B()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:AddExtraTypeToGroupsZONE_B |  ---------------- |"</span>)
  <span class="keyword">for</span> _TYPE, _numTYPE <span class="keyword">in</span> <span class="global">pairs</span>(self._queueExtraTypeToGroupsZONE_A) <span class="keyword">do</span>
    <span class="keyword">local</span> setting = self.Zones.Main.SpawnAmountSettings
    <span class="keyword">if</span> <span class="keyword">not</span> setting.ExtraTypesToGroups[_TYPE] <span class="keyword">then</span> setting.ExtraTypesToGroups[_TYPE] = <span class="number">0</span> <span class="keyword">end</span>
    setting.ExtraTypesToGroups[_TYPE] = setting.ExtraTypesToGroups[_TYPE] + _numTYPE
    setting.numExtraTypes = SPECTRE.UTILS.sumTable(setting.ExtraTypesToGroups)
    setting.numExtraUnits = <span class="number">0</span>
    <span class="keyword">for</span> _t, _tv <span class="keyword">in</span> <span class="global">pairs</span>(setting.ExtraTypesToGroups) <span class="keyword">do</span>
      setting.numExtraUnits = setting.numExtraUnits + _tv
    <span class="keyword">end</span>
    <span class="comment">--  setting.numExtraUnits = setting.numExtraUnits + _numTYPE
</span>    <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span> (self.Zones.Sub) <span class="keyword">do</span>
      <span class="keyword">local</span> settingSub = _zoneObject.SpawnAmountSettings
      <span class="keyword">if</span> <span class="keyword">not</span> settingSub.ExtraTypesToGroups[_TYPE] <span class="keyword">then</span> settingSub.ExtraTypesToGroups[_TYPE] = <span class="number">0</span> <span class="keyword">end</span>
      settingSub.ExtraTypesToGroups[_TYPE] = setting.ExtraTypesToGroups[_TYPE]
      settingSub.numExtraTypes = setting.numExtraTypes
      settingSub.numExtraUnits = setting.numExtraUnits
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>


<span class="comment">--- FOR ZONEMGR USE: Set spawn amounts for both main and subzones.
</span><span class="comment">--
</span><span class="comment">-- This function initializes the spawn amount settings for the SPAWNER object. It is designed for use
</span><span class="comment">-- by ZONEMGR and is part of a two-step process that allows spawn zones to be determined at a later stage.
</span><span class="comment">-- The function sets nominal, minimum, maximum, and nudge factor values for spawn amounts.
</span><span class="comment">-- The nudge factor introduces a degree of randomness in spawn amounts, with a default value of 0.5 if not specified.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param nominal The nominal (standard or expected) spawn amount.
</span><span class="comment">-- @param min The minimum spawn amount, defaults to 0 if not provided.
</span><span class="comment">-- @param max The maximum spawn amount, defaults to the value of <code>nominal</code> if not provided.
</span><span class="comment">-- @param nudgeFactor The factor used to introduce randomness in spawn amounts, defaults to 0.5 if not provided.
</span><a id="1717"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setSpawnAmountsZONE_A(nominal, min, max, nudgeFactor)
  <span class="comment">-- Set default values for arguments if not provided
</span>  self.nominal = nominal
  self.nudgeFactor = nudgeFactor <span class="keyword">or</span> <span class="number">0.5</span>
  self.min = min <span class="keyword">or</span> <span class="number">0</span>
  self.max = max <span class="keyword">or</span> nominal
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- FOR DYNAMIC SPAWN ZONE USE: Set size for main zone.
</span><span class="comment">--
</span><span class="comment">-- This function sets the size parameters for the main zone in the SPAWNER object.
</span><span class="comment">-- It defines the nominal, minimum, and maximum sizes, as well as a nudge factor to introduce
</span><span class="comment">-- randomness in size determination. The function is particularly relevant for dynamic spawn zones,
</span><span class="comment">-- allowing customization of zone size based on specified criteria. Default values are provided
</span><span class="comment">-- for minimum size (0 meters) and nudge factor (0.5) if they are not explicitly set.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param nominal The nominal size of the main zone in meters.
</span><span class="comment">-- @param min The minimum size of the main zone in meters, defaults to 0 if not provided.
</span><span class="comment">-- @param max The maximum size of the main zone in meters, defaults to the value of <code>nominal</code> if not provided.
</span><span class="comment">-- @param nudgeFactor The factor used to introduce randomness in the size of the main zone, defaults to 0.5 if not provided.
</span><a id="1740"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setZoneSizeMain(nominal, min, max, nudgeFactor)
  <span class="comment">-- Set default values for arguments if not provided
</span>  self.ZoneSize.Main.nominal = nominal
  self.ZoneSize.Main.nudgeFactor = nudgeFactor <span class="keyword">or</span> <span class="number">0.5</span>
  self.ZoneSize.Main.min = min <span class="keyword">or</span> <span class="number">0</span>
  self.ZoneSize.Main.max = max <span class="keyword">or</span> nominal
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- FOR DYNAMIC SPAWN ZONE USE: Set number of subzones for spawner.
</span><span class="comment">--
</span><span class="comment">-- This function configures the number of subzones for the SPAWNER object. It sets the nominal,
</span><span class="comment">-- minimum, and maximum number of subzones, along with a nudge factor that introduces randomness
</span><span class="comment">-- into the calculation. The sizes of subzones are determined based on these numbers. Default values
</span><span class="comment">-- are assigned to the minimum number of subzones (0) and the nudge factor (0.5) if they are not
</span><span class="comment">-- specifically provided.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param nominal The nominal number of subzones.
</span><span class="comment">-- @param min The minimum number of subzones, defaults to 0 if not provided.
</span><span class="comment">-- @param max The maximum number of subzones, defaults to the value of <code>nominal</code> if not provided.
</span><span class="comment">-- @param nudgeFactor The factor used to introduce randomness in the number of subzones, defaults to 0.5 if not provided.
</span><a id="1763"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setNumSubZones(nominal, min, max, nudgeFactor)
  <span class="comment">-- Set default values for arguments if not provided
</span>  self.ZoneSize.Sub.nominal = nominal
  self.ZoneSize.Sub.nudgeFactor = nudgeFactor <span class="keyword">or</span> <span class="number">0.5</span>
  self.ZoneSize.Sub.min = min <span class="keyword">or</span> <span class="number">0</span>
  self.ZoneSize.Sub.max = max <span class="keyword">or</span> nominal
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- FOR DYNAMIC SPAWN ZONE USE: Set restricted zones for spawner.
</span><span class="comment">--
</span><span class="comment">-- This function defines a set of restricted zones for the SPAWNER object. It allows specifying
</span><span class="comment">-- zones where spawning should be limited or prohibited. The function accepts a table of restricted
</span><span class="comment">-- zones and applies these restrictions to the SPAWNER's operation. If no restricted zones are
</span><span class="comment">-- provided, the function defaults to an empty table, implying no restrictions.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param restrictedZones A table of restricted zones. Defaults to an empty table if not provided.
</span><a id="1782"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setZoneRestricted(restrictedZones)
  self.ZonesRestricted = restrictedZones <span class="keyword">or</span> {}
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- FOR DYNAMIC SPAWN ZONE USE: Set number of subzones for spawner.
</span><span class="comment">--
</span><span class="comment">-- This function parses and assigns names to the main zone and its subzones for the SPAWNER object.
</span><span class="comment">-- It generates unique names for each zone by appending a random factor to the provided MainZoneName.
</span><span class="comment">-- The function also creates instances of <code>ZONE_RADIUS</code> for both the main and subzones using their respective names
</span><span class="comment">-- and size attributes. The names of restricted zones, if any, are also included in the zone naming process.
</span><span class="comment">-- Debug information regarding the assigned zone names is printed if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param MainZoneName The name of the main zone to which subzones are related.
</span><a id="1798"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:parseSubCirclesToZoneNames( MainZoneName)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:parseSubCirclesToZoneNames | ---------------"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:parseSubCirclesToZoneNames | MainZoneName: "</span> .. MainZoneName)
  <span class="keyword">local</span> ZoneNames = {}
  <span class="keyword">local</span> randFact = <span class="global">os</span>.time()
  ZoneNames.Main = MainZoneName .. randFact
  ZONE_RADIUS:New(MainZoneName  .. randFact, self.ZoneMainVec2,self.ZoneSize.Main.Actual,<span class="keyword">false</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:parseSubCirclesToZoneNames | ZONE Main Name: "</span> .. ZoneNames.Main)
  ZoneNames.Sub = {}
  <span class="keyword">for</span> _subZoneNum, _subCircle <span class="keyword">in</span> <span class="global">ipairs</span>(self.generatedSubCircles) <span class="keyword">do</span>
    <span class="keyword">local</span> _subZoneName = ZoneNames.Main .. <span class="string">"_"</span> .. _subZoneNum
    <span class="global">table</span>.insert(ZoneNames.Sub, _subZoneName)
    ZONE_RADIUS:New(_subZoneName,_subCircle.vec2,_subCircle.diameter/<span class="number">2</span>,<span class="keyword">false</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:parseSubCirclesToZoneNames | ZONE Sub Name: "</span> .. _subZoneName)
  <span class="keyword">end</span>
  ZoneNames.Restricted = self.ZonesRestricted
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:parseSubCirclesToZoneNames | ZONE Restricted Names: "</span>, ZoneNames.Restricted)
  self.ZoneNames = ZoneNames
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- DYNAMIC GEN ONLY: Set the generated zones for the SPAWNER.
</span><span class="comment">--
</span><span class="comment">-- This function establishes the zones for the SPAWNER object, including the main zone, subzones, and restricted zones.
</span><span class="comment">-- It initializes these zones based on the names provided in <code>self.ZoneNames</code>. If the subzones and restricted zones
</span><span class="comment">-- are not specified, they are initialized as empty sets. The function also calculates zone weights for spawn balancing.
</span><span class="comment">-- Debug information is output for zone names and weights if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing
</span><span class="comment">-- is recorded if enabled, tracking the performance of the zone setup process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="1829"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:SetZonesGenerated()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZonesGenerated | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.SetZones = {Time = {},}
    self.BenchmarkLog.SetZones.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">local</span> MainZone = self.ZoneNames.Main
  <span class="keyword">local</span> SubZones = self.ZoneNames.Sub
  <span class="keyword">local</span> NoGoZones = self.ZoneNames.Restricted
  <span class="comment">-- Debug Information
</span>
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZonesGenerated | MainZone: "</span> .. MainZone)

  <span class="comment">-- Initialize optional tables if they aren't provided
</span>  SubZones = SubZones <span class="keyword">or</span> {}
  NoGoZones = NoGoZones <span class="keyword">or</span> {}

  <span class="comment">-- Debug output for subzones and restricted zones
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZonesGenerated | SubZones: "</span>, <span class="global">table</span>.concat(SubZones, <span class="string">", "</span>))
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SetZonesGenerated | NoGoZones: "</span>, <span class="global">table</span>.concat(NoGoZones, <span class="string">", "</span>))

  <span class="comment">-- Set the main zone
</span>  self.Zones.Main = self.Zone_:New(MainZone)

  <span class="comment">-- Set the subzones
</span>  <span class="keyword">for</span> _, zoneName <span class="keyword">in</span> <span class="global">ipairs</span>(SubZones) <span class="keyword">do</span>
    self.Zones.Sub[zoneName] = self.Zone_:New(zoneName)
  <span class="keyword">end</span>

  <span class="comment">-- Compute weights for zones
</span>  self:weightZones()

  <span class="comment">-- Set the restricted zones
</span>  self.Zones.Restricted = NoGoZones
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.SetZones.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- DYNAMIC GEN ONLY: Generate subzone circles for dynamic spawn zones.
</span><span class="comment">--
</span><span class="comment">-- This function generates geometric data for subzones within a dynamic spawn zone. It calculates
</span><span class="comment">-- and assigns positions and sizes for subzone circles based on the provided main zone vector (<code>vec2</code>)
</span><span class="comment">-- and internal size settings. The function ensures that the subzones are appropriately placed within the main zone
</span><span class="comment">-- and do not overlap with any restricted zones. Debug information is output, detailing the generation process and
</span><span class="comment">-- the properties of each subzone circle if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. The function uses several internal
</span><span class="comment">-- configurations and thresholds to manage the generation process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param vec2 The vector position of the main zone.
</span><a id="1882"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:generateSubZoneCircles(vec2)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | -------------------------------------------------------------------------"</span>)
  self.generatedSubCircles = {}
  self.ZoneMainVec2 = vec2
  <span class="keyword">local</span> _mainSett = self.ZoneSize.Main
  <span class="keyword">local</span> _subSett = self.ZoneSize.Sub
  <span class="keyword">local</span> mainCircleSize = SPECTRE.UTILS.generateNominal(_mainSett.nominal, _mainSett.min, _mainSett.max, _mainSett.nudgeFactor)
  self.ZoneSize.Main.Actual = mainCircleSize
  <span class="keyword">local</span> mainCircleVec2 = vec2
  <span class="keyword">local</span> numSubCircles = <span class="global">math</span>.floor(SPECTRE.UTILS.generateNominal(_subSett.nominal, _subSett.min, _subSett.max, _subSett.nudgeFactor))
  self.ZoneSize.Sub.Actual = numSubCircles
  <span class="keyword">local</span> subCircleMinSize = (mainCircleSize/numSubCircles)/<span class="number">2</span>

  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | mainCircleSize   | "</span> .. mainCircleSize)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | numSubCircles    | "</span> .. numSubCircles)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | subCircleMinSize | "</span> .. subCircleMinSize)

  <span class="comment">--local generatedSubCircles = SPECTRE.POLY.generateSubCircles(mainCircleSize, mainCircleVec2, numSubCircles, subCircleMinSize, true, self)
</span>
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | -------VEC 2 GEN ------ |"</span>)
  self.generatedSubCircles = {}
  <span class="keyword">local</span> generatedSubCircles = {}
  <span class="keyword">local</span> mainRadius = mainCircleSize / <span class="number">2</span>
  <span class="keyword">local</span> attempts = <span class="number">0</span> <span class="comment">-- to prevent infinite loops
</span>  <span class="keyword">local</span> attemptLimit = numSubCircles * self.Config.operationLimit

  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | #generatedSubCircles       |"</span> .. #generatedSubCircles)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | numSubCircles              |"</span> .. numSubCircles)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | attempts                   |"</span> .. attempts)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | numSubCircles              |"</span> .. numSubCircles)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | self.Config.operationLimit |"</span> .. self.Config.operationLimit)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | attemptLimit               |"</span> .. attemptLimit)


  <span class="comment">-- while #generatedSubCircles &lt; numSubCircles and attempts &lt; attemptLimit do
</span>  <span class="keyword">repeat</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | CURRENT ATTEMPT            |"</span> .. attempts)
    <span class="keyword">local</span> flag_goodcoord = <span class="keyword">true</span>
    <span class="keyword">local</span> glassBreak = <span class="number">0</span>
    <span class="keyword">local</span> subCircle = {}
    <span class="keyword">local</span> subRadius

    <span class="keyword">repeat</span>
      flag_goodcoord = <span class="keyword">true</span>
      subRadius = <span class="global">math</span>.random(subCircleMinSize / <span class="number">2</span>, mainRadius) / <span class="number">2</span>
      <span class="keyword">local</span> angle =  <span class="global">math</span>.random() * <span class="number">2</span> * <span class="global">math</span>.pi
      <span class="keyword">local</span> maxDistFromCenter = mainRadius - subRadius
      <span class="keyword">local</span> minDistFromCenter = subRadius
      <span class="keyword">local</span> distFromCenter = <span class="global">math</span>.random(minDistFromCenter, maxDistFromCenter)

      subCircle.vec2 = {
        x = mainCircleVec2.x + distFromCenter * <span class="global">math</span>.cos(angle),
        y = mainCircleVec2.y + distFromCenter * <span class="global">math</span>.sin(angle)
      }
      subCircle.diameter = subRadius * <span class="number">2</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | vec2.x : "</span> .. subCircle.vec2.x .. <span class="string">" | vec2.y "</span> .. subCircle.vec2.y)

      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | ------- GOODCOORD CHECK -------- |"</span>)

      <span class="keyword">if</span> flag_goodcoord <span class="keyword">then</span> flag_goodcoord = self.checkNOGO(self, subCircle.vec2, self.ZonesRestricted) <span class="keyword">end</span>

      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | GOODCOORD? | "</span> .. <span class="global">tostring</span>(flag_goodcoord))
      <span class="keyword">if</span> glassBreak &gt;= self.Config.operationLimit <span class="keyword">then</span>
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | --- GLASSBREAK --"</span>)
        flag_goodcoord = <span class="keyword">true</span>
      <span class="keyword">end</span>
      glassBreak = glassBreak + <span class="number">1</span>
    <span class="keyword">until</span> flag_goodcoord


    <span class="keyword">if</span> SPECTRE.POLY.isSubCircleValidThreshold(subCircle, generatedSubCircles, mainCircleVec2, mainRadius, <span class="number">0.75</span>) <span class="keyword">then</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | SubCircle: VALID"</span>)
      <span class="global">table</span>.insert(generatedSubCircles, subCircle)
    <span class="keyword">else</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | SubCircle: INVALID, regen"</span>)
    <span class="keyword">end</span>

    <span class="keyword">if</span> attempts &gt;= attemptLimit <span class="keyword">then</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | --- attempts GLASSBREAK --"</span>)
      flag_goodcoord = <span class="keyword">true</span>
    <span class="keyword">end</span>
    attempts = attempts + <span class="number">1</span>
  <span class="keyword">until</span> #generatedSubCircles == numSubCircles <span class="keyword">and</span> flag_goodcoord<span class="comment">--end
</span>

  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    <span class="keyword">for</span> _, _v <span class="keyword">in</span> <span class="global">ipairs</span>(generatedSubCircles) <span class="keyword">do</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | generatedSubCircle | "</span> .. _)
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | diameter | "</span> .. _v.diameter)
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | vec2.x   | "</span> ..  _v.vec2.x)
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:generateSubZoneCircles | vec2.y   | "</span> ..  _v.vec2.y)
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  self.generatedSubCircles = generatedSubCircles
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- FOR ZONEMGR USE: Set spawn amounts for both main and subzones (Part B).
</span><span class="comment">--
</span><span class="comment">-- This function is the second part of the process to set spawn amounts for the SPAWNER object. It is used
</span><span class="comment">-- after the initial setup of spawn zones and configuration parameters (handled in <code>setSpawnAmountsZONE_A</code>).
</span><span class="comment">-- This function calculates and assigns spawn amounts for the main zone and each subzone based on predefined settings
</span><span class="comment">-- and a calculated average distribution. The function also allows for the application of nudge factors to introduce
</span><span class="comment">-- variability in spawn amounts. Debug information is generated if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1, providing details
</span><span class="comment">-- on the configuration and generation of spawn amounts. Benchmark timing is recorded if enabled.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="1990"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:setSpawnAmountsZONE_B()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:setSpawnAmountsZONE_B | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.setSpawnAmounts = {Time = {},}
    self.BenchmarkLog.setSpawnAmounts.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">local</span> nudgeFactor = self.nudgeFactor
  <span class="keyword">local</span> min = self.min
  <span class="keyword">local</span> max = self.max
  <span class="keyword">local</span> nominal = self.nominal

  <span class="comment">-- Debug header
</span>  SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:setSpawnAmountsZONE_B | CONFIG | NOMINAL: %d | MIN: %d | MAX: %d | NUDGE FACTOR: %f"</span>, nominal, min, max, nudgeFactor))

  <span class="comment">-- Calculate main zone values
</span>  self.Zones.Main.numSubZones = SPECTRE.UTILS.sumTable(self.Zones.Sub)
  self.Zones.Main:setSpawnAmounts(nominal, min, max, nudgeFactor):RollSpawnAmounts()

  <span class="comment">-- Calculate spawn configurations for subzones
</span>  <span class="keyword">local</span> avgDistribution = self.Zones.Main.SpawnAmountSettings.Generated.Actual / self.Zones.Main.numSubZones
  <span class="keyword">local</span> spawnsMax = <span class="global">math</span>.min(avgDistribution + avgDistribution * self.Zones.Main.SpawnAmountSettings.Generated.Ratio.Max,
    self.Zones.Main.SpawnAmountSettings.Generated.Max / self.Zones.Main.numSubZones)
  <span class="keyword">local</span> spawnsMin = <span class="global">math</span>.max(avgDistribution - avgDistribution * self.Zones.Main.SpawnAmountSettings.Generated.Ratio.Min,
    self.Zones.Main.SpawnAmountSettings.Generated.Min / self.Zones.Main.numSubZones)

  <span class="comment">-- Debug information for Zone configurations
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.DEBUGoutput.infoZoneCFG(self.Zones.Main)
    SPECTRE.UTILS.DEBUGoutput.infoZoneGEN(self.Zones.Main)
  <span class="keyword">end</span>

  <span class="comment">-- Set spawn amounts for each subzone
</span>  <span class="keyword">for</span> _, zoneObject_ <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    zoneObject_:setSpawnAmounts(avgDistribution, spawnsMin, spawnsMax, SPECTRE.UTILS.generateNudge(self.Zones.Main.SpawnAmountSettings.Generated.NudgeFactor)):RollSpawnAmounts()
  <span class="keyword">end</span>

  self:Jiggle()

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.setSpawnAmounts.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- FOR ZONEMGR USE: Dynamically generate a spawn zone.
</span><span class="comment">--
</span><span class="comment">-- This function orchestrates a series of operations to dynamically generate and configure a spawn zone.
</span><span class="comment">-- It involves generating subzone circles, parsing these subzones into zone names, setting up the generated zones,
</span><span class="comment">-- and configuring spawn amounts and group sizes. Additional operations for group type addition and final generation
</span><span class="comment">-- are also performed. The function allows for benchmarking and summary generation, controlled through optional
</span><span class="comment">-- parameters. This method is key for creating flexible and dynamic spawn zones within the SPAWNER framework.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param vec2 The vector location where the spawner will operate.
</span><span class="comment">-- @param name The name to be used for the generated zone.
</span><span class="comment">-- @param benchmark (optional) A boolean flag to enable benchmarking.
</span><span class="comment">-- @param summary (optional) A boolean flag to enable summary generation.
</span><a id="2049"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:DynamicGenerationZONE(vec2, name, benchmark, summary)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:DynamicGenerationZONE | -------------------------------------------------------------------------"</span>)
  benchmark = benchmark <span class="keyword">or</span> <span class="keyword">false</span>
  summary = summary <span class="keyword">or</span> <span class="keyword">false</span>
  self:generateSubZoneCircles(vec2)
  self:parseSubCirclesToZoneNames(name)
  self:SetZonesGenerated()
  self:AddExtraTypeToGroupsZONE_B()
  self:setSpawnAmountsZONE_B()
  self:RollSpawnGroupSizes()
  self:Generate()
  <span class="keyword">if</span> self.Benchmark <span class="keyword">then</span>
  <span class="keyword">if</span> benchmark <span class="keyword">then</span> self:_SaveBenchmark() <span class="keyword">end</span>
  <span class="keyword">if</span> summary <span class="keyword">then</span> self:Summary() <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- 11 - Misc.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *Misc Methods*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Saves and reports benchmarking data for the SPAWNER instance.
</span><span class="comment">--
</span><span class="comment">-- This function is dedicated to processing and displaying benchmarking data collected by the SPAWNER instance.
</span><span class="comment">-- It calculates execution times for various benchmarked functions and zones, then outputs this information for analysis.
</span><span class="comment">-- This function is critical for performance evaluation, helping to identify potential bottlenecks or areas for optimization within the SPAWNER's operations.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2083"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_SaveBenchmark()
  <span class="keyword">local</span> _trun = <span class="number">6</span>
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:BENCHMARK INFO   |"</span>)
  <span class="keyword">for</span> _benchmarkFuncName, _value <span class="keyword">in</span> <span class="global">pairs</span> (self.BenchmarkLog) <span class="keyword">do</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"_benchmarkFuncName"</span>,_benchmarkFuncName)
    SPECTRE.UTILS.debugInfo(<span class="string">"_value"</span>,_value)
    <span class="keyword">if</span>  _value.Time <span class="keyword">then</span>
      <span class="keyword">local</span> exe_Time = _value.Time.stop - _value.Time.start
      _value.Time.real = exe_Time
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:BENCHMARK INFO   | Param: "</span>  .._benchmarkFuncName .. <span class="string">" | Time: "</span> .. SPECTRE.UTILS.trunc(exe_Time, _trun) .. <span class="string">"s"</span> )
    <span class="keyword">else</span>
      <span class="keyword">for</span> _benchmarkZoneName, _valueZone <span class="keyword">in</span> <span class="global">pairs</span> (self.BenchmarkLog[_benchmarkFuncName]) <span class="keyword">do</span>
        <span class="keyword">if</span>  _valueZone.Time <span class="keyword">then</span>
          <span class="keyword">local</span> exe_Time = _valueZone.Time.stop - _valueZone.Time.start
          _valueZone.Time.real = exe_Time
          SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:BENCHMARK INFO   | Param: "</span>  .._benchmarkFuncName .. <span class="string">" | Zone: "</span> .. _benchmarkZoneName .. <span class="string">" | Time: "</span> .. SPECTRE.UTILS.trunc(exe_Time, _trun) .. <span class="string">"s"</span>)
        <span class="keyword">end</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Generates and saves a summary report for SPAWNER activities.
</span><span class="comment">--
</span><span class="comment">-- This function creates a comprehensive summary of the SPAWNER's activities, including details on spawned groups, types, templates, and benchmarking data.
</span><span class="comment">-- It aggregates information from various zones, calculating the total number of groups, types, and templates used. The function also includes benchmarking
</span><span class="comment">-- times for different SPAWNER operations, offering insights into performance. The summary is saved to a file and detailed logs are produced for analysis.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2114"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Summary()
  SPECTRE.IO.PersistenceToFile(SPECTRE._persistenceLocations.SPAWNER.path .. <span class="string">"Summary/"</span> .. self.Zones.Main.name .. <span class="string">".lua"</span>, self, <span class="keyword">true</span>)
  <span class="keyword">local</span> curDEBUG = SPECTRE.DebugEnabled
  SPECTRE.DebugEnabled = <span class="number">1</span>

  <span class="keyword">local</span> numSpawnedTypes = <span class="number">0</span>
  <span class="keyword">local</span> numSpawnedTemplates = <span class="number">0</span>
  <span class="keyword">local</span> allTypesNames = {}
  <span class="keyword">local</span> allTypesCount = <span class="number">0</span>
  <span class="keyword">local</span> allTemplatesNames = {}
  <span class="keyword">local</span> allTemplatesCount = <span class="number">0</span>
  <span class="keyword">local</span> numGroups = <span class="number">0</span>

  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span> (self.Zones.Sub) <span class="keyword">do</span>
    <span class="keyword">local</span> _AmountSetting = _zoneObject.SpawnAmountSettings
    <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
      <span class="keyword">for</span> _GIndex = <span class="number">1</span>, setting.numGroups, <span class="number">1</span> <span class="keyword">do</span>
        <span class="keyword">for</span> _UIndex = <span class="number">1</span>, setting.size + _AmountSetting.numExtraUnits, <span class="number">1</span> <span class="keyword">do</span>
          <span class="global">table</span>.insert(allTypesNames, setting.Types[_GIndex][_UIndex])
          <span class="global">table</span>.insert(allTemplatesNames, setting.Templates[_GIndex][_UIndex])
          allTypesCount = allTypesCount + <span class="number">1</span>
          allTemplatesCount = allTemplatesCount + <span class="number">1</span>
        <span class="keyword">end</span>
        numGroups = numGroups + <span class="number">1</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">local</span> numUniqueTypesNames = <span class="number">0</span>
  <span class="keyword">local</span> numUniqueTemplates = <span class="number">0</span>
  <span class="keyword">local</span> uniqueTypesNames = SPECTRE.UTILS.CountValues(allTypesNames)
  <span class="keyword">local</span> uniqueTemplates = SPECTRE.UTILS.CountValues(allTemplatesNames)

  <span class="keyword">for</span> _k,_v <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTypesNames) <span class="keyword">do</span>
    numUniqueTypesNames = numUniqueTypesNames + <span class="number">1</span>
  <span class="keyword">end</span>
  <span class="keyword">for</span> _k,_v <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTemplates) <span class="keyword">do</span>
    numUniqueTemplates = numUniqueTemplates + <span class="number">1</span>
  <span class="keyword">end</span>


  <span class="keyword">local</span> setGEN = self.Zones.Main.SpawnAmountSettings.Generated
  <span class="keyword">local</span> setCFG = self.Zones.Main.SpawnAmountSettings.Config

  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ZONE | "</span> .. self.Zones.Main.name .. <span class="string">" | #SUBZONES | "</span> .. self.Zones.Main.numSubZones )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | GROUPS SPAWNED          : "</span> .. numGroups .. <span class="string">" | TYPES USED | "</span> .. allTypesCount .. <span class="string">" | TEMPLATES USED | "</span> .. allTemplatesCount )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | UNIQUE TYPES USED       : "</span> .. numUniqueTypesNames .. <span class="string">" | UNIQUE TEMPLATES USED | "</span> .. numUniqueTemplates )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | GEN TARGET # SPAWNS     : "</span> .. setGEN.Actual .. <span class="string">" | OVER NOM: "</span> .. setGEN.Thresholds.overNom .. <span class="string">" | UNDER NOM: "</span> .. setGEN.Thresholds.underNom  )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | OVER MAX: "</span> .. setGEN.Thresholds.overMax .. <span class="string">" | UNDER MIN: "</span> .. setGEN.Thresholds.underMin  )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | CFG NOM : "</span> .. setCFG.Nominal .. <span class="string">" CFG Min : "</span> .. setCFG.Min .. <span class="string">" CFG Max : "</span> .. setCFG.Max )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | # EXTRA TYPES: "</span> .. self.Zones.Main.SpawnAmountSettings.numExtraTypes .. <span class="string">" | # EXTRA UNITS: "</span> .. self.Zones.Main.SpawnAmountSettings.numExtraUnits  )
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | GENERATE TOTAL   : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.Generate.Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME |   Group SIZE GEN : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.RollSpawnGroupSizes.Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME |   Group TYPE GEN : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.RollSpawnGroupTypes.Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | PLACEMENT TOTAL  : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.RollPlacement.Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | SETUP GROUPS     : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.SetupSpawnGroups.Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | SPAWN GROUPS     : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.Spawn.Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ------ NUMBER OF TYPES USED"</span>)
  <span class="keyword">for</span> _Name, _numUsed <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTypesNames) <span class="keyword">do</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | "</span> .. _numUsed .. <span class="string">" : "</span> .. _Name )
  <span class="keyword">end</span>
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ------ NUMBER OF TEMPLATES USED"</span>)
  <span class="keyword">for</span> _Name, _numUsed <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTemplates) <span class="keyword">do</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | "</span> .. _numUsed .. <span class="string">" : "</span> .. _Name )
  <span class="keyword">end</span>
  <span class="keyword">for</span> _zoneName, _zoneObject <span class="keyword">in</span> <span class="global">pairs</span> (self.Zones.Sub) <span class="keyword">do</span>
    <span class="keyword">local</span> _AmountSetting = _zoneObject.SpawnAmountSettings
    <span class="keyword">local</span> numSpawnedTypes = <span class="number">0</span>
    <span class="keyword">local</span> numSpawnedTemplates = <span class="number">0</span>
    <span class="keyword">local</span> allTypesNames = {}
    <span class="keyword">local</span> allTypesCount = <span class="number">0</span>
    <span class="keyword">local</span> allTemplatesNames = {}
    <span class="keyword">local</span> allTemplatesCount = <span class="number">0</span>
    <span class="keyword">local</span> numGroups = <span class="number">0</span>

    <span class="comment">--    if not allTypesNames[_zoneName] then allTypesNames[_zoneName] = {} end
</span>    <span class="comment">--    if not allTemplatesNames[_zoneName] then allTemplatesNames[_zoneName] = {} end
</span>    <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
      <span class="keyword">for</span> _GIndex = <span class="number">1</span>, setting.numGroups, <span class="number">1</span> <span class="keyword">do</span>
        <span class="keyword">for</span> _UIndex = <span class="number">1</span>, setting.size + _AmountSetting.numExtraUnits, <span class="number">1</span> <span class="keyword">do</span>
          <span class="global">table</span>.insert(allTypesNames, setting.Types[_GIndex][_UIndex])
          <span class="global">table</span>.insert(allTemplatesNames, setting.Templates[_GIndex][_UIndex])
          allTypesCount = allTypesCount + <span class="number">1</span>
          allTemplatesCount = allTemplatesCount + <span class="number">1</span>
        <span class="keyword">end</span>
        numGroups = numGroups + <span class="number">1</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">local</span> numUniqueTypesNames = <span class="number">0</span>
    <span class="keyword">local</span> numUniqueTemplates = <span class="number">0</span>
    <span class="keyword">local</span> uniqueTypesNames = SPECTRE.UTILS.CountValues(allTypesNames)
    <span class="keyword">local</span> uniqueTemplates = SPECTRE.UTILS.CountValues(allTemplatesNames)

    <span class="keyword">for</span> _k,_v <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTypesNames) <span class="keyword">do</span>
      numUniqueTypesNames = numUniqueTypesNames + <span class="number">1</span>
    <span class="keyword">end</span>
    <span class="keyword">for</span> _k,_v <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTemplates) <span class="keyword">do</span>
      numUniqueTemplates = numUniqueTemplates + <span class="number">1</span>
    <span class="keyword">end</span>


    <span class="keyword">local</span> setGEN = _zoneObject.SpawnAmountSettings.Generated
    <span class="keyword">local</span> setCFG = _zoneObject.SpawnAmountSettings.Config

    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | SUBZONE SUMMARY | "</span> .. _zoneObject.name .. <span class="string">" | #SUBZONES | "</span> .. _zoneObject.numSubZones )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | GROUPS SPAWNED          : "</span> .. numGroups .. <span class="string">" | TYPES USED | "</span> .. allTypesCount .. <span class="string">" | TEMPLATES USED | "</span> .. allTemplatesCount )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | UNIQUE TYPES USED       : "</span> .. numUniqueTypesNames .. <span class="string">" | UNIQUE TEMPLATES USED | "</span> .. numUniqueTemplates )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | GEN TARGET # SPAWNS     : "</span> .. setGEN.Actual .. <span class="string">" | OVER NOM: "</span> .. setGEN.Thresholds.overNom .. <span class="string">" | UNDER NOM: "</span> .. setGEN.Thresholds.underNom  )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | OVER MAX: "</span> .. setGEN.Thresholds.overMax .. <span class="string">" | UNDER MIN: "</span> .. setGEN.Thresholds.underMin  )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | CFG NOM : "</span> .. setCFG.Nominal .. <span class="string">" CFG Min : "</span> .. setCFG.Min .. <span class="string">" CFG Max : "</span> .. setCFG.Max )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | # EXTRA TYPES: "</span> .. _zoneObject.SpawnAmountSettings.numExtraTypes .. <span class="string">" | # EXTRA UNITS: "</span> .. _zoneObject.SpawnAmountSettings.numExtraUnits  )
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | Group TYPE     : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog._generateGroupTypes[_zoneObject.name].Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span> <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | Group TEMPLATE : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog._generateGroupTemplates[_zoneObject.name].Time.real , <span class="number">5</span>) .. <span class="string">" seconds"</span> <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | Unit  VEC2     : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.Set_Vec2_UnitTemplates[_zoneObject.name].Time.real , <span class="number">5</span>) .. <span class="string">" seconds"</span> <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | Group VEC2     : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog.Set_Vec2_GroupCenters[_zoneObject.name].Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | SETUP GROUPS   : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog._SetupSpawnGroups[_zoneObject.name].Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | TIME | SPAWN GROUPS   : "</span> .. SPECTRE.UTILS.trunc(self.BenchmarkLog._Spawn[_zoneObject.name].Time.real, <span class="number">5</span>) .. <span class="string">" seconds"</span>  <span class="keyword">or</span> <span class="string">"enableBenchmark"</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ---------------------------------------------------------------------------- "</span>)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ------ NUMBER OF TYPES USED"</span>)
    <span class="keyword">for</span> _Name, _numUsed <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTypesNames) <span class="keyword">do</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | "</span> .. _numUsed .. <span class="string">" : "</span> .. _Name )
    <span class="keyword">end</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | ------ NUMBER OF TEMPLATES USED"</span>)
    <span class="keyword">for</span> _Name, _numUsed <span class="keyword">in</span> <span class="global">pairs</span>(uniqueTemplates) <span class="keyword">do</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:SUMMARY   | "</span> .. _numUsed .. <span class="string">" : "</span> .. _Name )
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  SPECTRE.DebugEnabled = curDEBUG
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- 12 - Internal Methods.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *Internal methods, can be used with care and know how*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Execute the spawning process for a specific zone object.
</span><span class="comment">--
</span><span class="comment">-- This internal function handles the actual spawning of groups within a given zone. It iterates through
</span><span class="comment">-- the group settings of the zone, spawning each group at the pre-calculated vector positions. The function
</span><span class="comment">-- manages the timing and coordinates of each spawn, ensuring that groups are spawned accurately according to
</span><span class="comment">-- their configurations. It utilizes a timer to stagger the spawning of groups for added realism and efficiency.
</span><span class="comment">-- Debug information is output detailing each group's spawning process if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1.
</span><span class="comment">-- Benchmark timing is recorded if enabled, to track the performance of the spawning process for the zone.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _zoneObject The zone object for which groups are being spawned.
</span><a id="2272"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_Spawn(_zoneObject)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_Spawn | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.BenchmarkLog._Spawn <span class="keyword">then</span> self.BenchmarkLog._Spawn = {} <span class="keyword">end</span>
    self.BenchmarkLog._Spawn[_zoneObject.name] = {Time = {},}
    self.BenchmarkLog._Spawn[_zoneObject.name].Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="comment">-- Loop through each group setting.
</span>  <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
    <span class="keyword">local</span> _groupTypes = {}
    <span class="comment">-- Loop for the number of groups specified in the current setting.
</span>    <span class="keyword">for</span> _groupIndex = <span class="number">1</span>, setting.numGroups <span class="keyword">do</span>
      <span class="comment">-- List to store types for this group.
</span>      <span class="keyword">local</span> _UnitTypes = {}
      <span class="comment">--local _UnitTypesobj = {}
</span>      <span class="comment">-- Loop for the size of the group + extra units.
</span>      <span class="keyword">for</span> _Unit = <span class="number">1</span>, setting.size + _zoneObject.SpawnAmountSettings.numExtraUnits <span class="keyword">do</span> <span class="comment">--+ self.Config.numExtraUnits
</span>        <span class="keyword">local</span> _vec2 = setting.TemplateCoords[_groupIndex][_Unit]
        <span class="keyword">local</span> SpawnGroup_ = setting.SpawnedGROUPS[_groupIndex][_Unit]<span class="comment">--:SpawnFromVec2(_vec2)
</span>        <span class="keyword">local</span> capturedSpawnGroup = SpawnGroup_
        <span class="keyword">local</span> _Tvec2 = _vec2
        <span class="keyword">local</span> _Timer = TIMER:New(<span class="keyword">function</span>()

            <span class="keyword">local</span> SpawnGroupt_ = capturedSpawnGroup:SpawnFromVec2(_vec2)

            SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_Spawn | GROUP ------------------------------------"</span>)
            SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_Spawn | SpawnGroup_    : "</span>,  SpawnGroupt_:GetName())
            SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_Spawn | _vec2.x       : "</span> .. _vec2.x .. <span class="string">" | _vec2.y :"</span> .._vec2.y)

        <span class="keyword">end</span>, capturedSpawnGroup, _vec2)
        _Timer:Start(<span class="global">math</span>.random(<span class="number">1</span>,<span class="number">5</span>))
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._Spawn[_zoneObject.name].Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<a id="2314"></a><span class="comment">--- Called by DetectTypeTemplates.
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_detectHighestAttributes(TemplatePrefix, _Object)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:DetectTypeTemplates | DETECT HIGHEST PRIORITY ATTRIBUTE ---------------------------------"</span>)

  <span class="comment">-- Nested function to find the template type with the highest priority
</span>  <span class="keyword">local</span> <span class="keyword">function</span> findTypeIndex(<span class="global">table</span>, input)
    <span class="keyword">local</span> highestPriority = -<span class="number">1</span>
    <span class="keyword">local</span> matchingType = <span class="keyword">nil</span>
    <span class="comment">-- Iterate through the TEMPLATETYPES_ table to find the matching type with highest priority
</span>    <span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="global">pairs</span>(<span class="global">table</span>) <span class="keyword">do</span>
      <span class="keyword">for</span> _i,_attr <span class="keyword">in</span> <span class="global">ipairs</span>(input) <span class="keyword">do</span>
        <span class="keyword">if</span> _attr == key <span class="keyword">and</span> value._Priority <span class="keyword">and</span> value._Priority &gt; highestPriority <span class="keyword">then</span>
          highestPriority = value._Priority
          matchingType = key
        <span class="keyword">end</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:DetectTypeTemplates | MATCH TYPE: "</span> .. matchingType)
    <span class="keyword">return</span> matchingType
  <span class="keyword">end</span>
  <span class="keyword">for</span> Group_, GroupObject <span class="keyword">in</span> <span class="global">pairs</span>(mist.DBs.groupsByName) <span class="keyword">do</span>
    <span class="keyword">if</span> <span class="global">string</span>.find(Group_, TemplatePrefix, <span class="number">1</span>, <span class="keyword">true</span>) <span class="keyword">then</span>
      <span class="keyword">local</span> _groupAttributes = SPECTRE.UTILS.GetGroupAttributes(Group_)
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:DetectTypeTemplates | GROUP:  "</span> .. Group_ .. <span class="string">" | ATTRIBUTES: "</span>, _groupAttributes)
      <span class="keyword">local</span> matchedType = findTypeIndex(_Object, _groupAttributes)
      <span class="keyword">if</span> matchedType <span class="keyword">then</span>
        <span class="comment">-- Add the group name to the matched type
</span>        SPECTRE.UTILS.safeInsert(_Object[matchedType].GroupNames, Group_)
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> _Object
<span class="keyword">end</span>

<span class="comment">--- Distributes difference in spawn amounts across subzones and introduces randomness.
</span><span class="comment">--
</span><span class="comment">-- This function is essential in the SPAWNER's spawn logic, especially when dealing with multiple zones. It processes the subzone data
</span><span class="comment">-- from the <code>Zones.Sub</code> table, calculating the total 'Actual' spawn amounts for these subzones. The function also plays a role in
</span><span class="comment">-- introducing randomness and variation in the spawn process. If debugging is enabled, it provides detailed information about the distribution
</span><span class="comment">-- of spawns across the subzones. This step ensures that spawn logic accommodates both the pre-configured settings and dynamic elements in gameplay.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2356"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_seedRollUpdates()
  <span class="comment">-- Debugging header
</span>  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedRollUpdates                             | -------------------------------------------------------------------------"</span>)
    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_seedRollUpdates                             | DISTRIBUTE RESULTS | TOTAL SPAWNS: %d"</span>, self.Zones.Main.SpawnAmountSettings.Generated.Actual))
  <span class="keyword">end</span>

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._seedRollUpdates = {Time = {},}
    self.BenchmarkLog._seedRollUpdates.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>



  <span class="comment">-- Initialize the keys table, spawnsManip_ table, and _spawnsManipTotal counter
</span>  self.keys = {}
  self.spawnsManip_ = {}
  self._spawnsManipTotal = <span class="number">0</span>

  <span class="comment">-- Iterate over subzones, extract keys, and accumulate spawn amounts
</span>  <span class="keyword">for</span> k, zoneObject <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    <span class="global">table</span>.insert(self.keys, k)
    self.spawnsManip_[k] = zoneObject.SpawnAmountSettings.Generated.Actual
    self._spawnsManipTotal = self._spawnsManipTotal + self.spawnsManip_[k]
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._seedRollUpdates.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Introduce randomness in the spawn distribution.
</span><span class="comment">--
</span><span class="comment">-- This function plays a key role in diversifying the spawn distribution across different subzones.
</span><span class="comment">-- It adds a layer of randomness while adhering to the minimum and maximum constraints for each subzone
</span><span class="comment">-- and the total spawn limit of the main zone. The randomness ensures a dynamic and unpredictable gameplay
</span><span class="comment">-- experience by varying the number of spawns in each subzone. Debug information is provided if debugging is enabled,
</span><span class="comment">-- offering insights into the randomized adjustments made during the spawn distribution process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2398"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_introduceRandomness()


  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_introduceRandomness | ---------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._introduceRandomness = {Time = {},}
    self.BenchmarkLog._introduceRandomness.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="comment">-- Iterate over the zones as defined by the nudge reciprocation number
</span>  <span class="keyword">for</span> _ = <span class="number">1</span>, self.Zones.Main.SpawnAmountSettings.Generated.NudgeRecip <span class="keyword">do</span>
    <span class="keyword">local</span> subZoneKey_ = self.keys[<span class="global">math</span>.random(self.Zones.Main.numSubZones)]
    <span class="keyword">local</span> random_value = <span class="global">math</span>.random(-<span class="number">2</span>, <span class="number">2</span>)
    <span class="keyword">local</span> newActual = self.spawnsManip_[subZoneKey_] + random_value
    <span class="keyword">local</span> newTotal = self._spawnsManipTotal + random_value

    <span class="comment">-- Debug: Print the random value introduced
</span>    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_introduceRandomness                         | ZONE: %s  | Random Value         : %d"</span>, self.Zones.Sub[subZoneKey_].name, random_value))

    <span class="comment">-- Check if the new actual value and the new total value are within the allowed range
</span>    <span class="keyword">if</span> newActual &gt; self.Zones.Sub[subZoneKey_].SpawnAmountSettings.Generated.Min
      <span class="keyword">and</span> newTotal &lt;= self.Zones.Main.SpawnAmountSettings.Generated.Max
      <span class="keyword">and</span> newActual &lt; self.Zones.Sub[subZoneKey_].SpawnAmountSettings.Generated.Max <span class="keyword">then</span>

      <span class="comment">-- Debug: Print values before update
</span>      SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_introduceRandomness                         | ZONE: %s  | Before SubZone Actual: %d | Before MainZone Total: %d"</span>, self.Zones.Sub[subZoneKey_].name, self.spawnsManip_[subZoneKey_], self._spawnsManipTotal))

      <span class="comment">-- Update the actual value and the total value with the new randomized numbers
</span>      self.spawnsManip_[subZoneKey_] = newActual
      self._spawnsManipTotal = newTotal

      <span class="comment">-- Debug: Print values after update
</span>      SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_introduceRandomness                         | ZONE: %s  | After SubZone Actual : %d | After MainZone Total : %d"</span>, self.Zones.Sub[subZoneKey_].name, self.spawnsManip_[subZoneKey_], self._spawnsManipTotal))
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._introduceRandomness.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Distribute difference in spawn amounts across subzones.
</span><span class="comment">--
</span><span class="comment">-- This function calculates the difference between the expected spawn amount for the main zone
</span><span class="comment">-- and the total spawns across subzones. It then distributes this difference across the subzones
</span><span class="comment">-- to ensure the total spawn amount matches the expected value for the main zone. Debug information
</span><span class="comment">-- can be printed if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2449"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_distributeDifference()


  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_distributeDifference | ---------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._distributeDifference = {Time = {},}
    self.BenchmarkLog._distributeDifference.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="comment">-- Calculate the difference between the expected and current total spawn amount
</span>  <span class="keyword">local</span> difference = self.Zones.Main.SpawnAmountSettings.Generated.Actual - self._spawnsManipTotal

  <span class="comment">-- Debug: Print the calculated difference
</span>  SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_distributeDifference                        | ZONE: %s  | DIFFERENCE           : %d"</span>, self.Zones.Main.name, difference))

  <span class="comment">-- Distribute the difference across the subzones
</span>  <span class="keyword">for</span> _ = <span class="number">1</span>, <span class="global">math</span>.abs(difference) <span class="keyword">do</span>
    <span class="keyword">local</span> subZoneKey_ = self.keys[<span class="global">math</span>.random(self.Zones.Main.numSubZones)]
    <span class="keyword">local</span> _val = (difference &gt; <span class="number">0</span> <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">or</span> -<span class="number">1</span>) <span class="comment">-- Determine if we need to add or subtract
</span>
    <span class="comment">-- Debug: Print changes before and after distribution
</span>    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_distributeDifference                        | ZONE: %s  | Change Value         : %d"</span>, self.Zones.Sub[subZoneKey_].name, _val))
    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_distributeDifference                        | ZONE: %s  | Before SubZone Actual: %d | Before MainZone Total: %d"</span>, self.Zones.Sub[subZoneKey_].name, self.spawnsManip_[subZoneKey_], self._spawnsManipTotal))

    <span class="comment">-- Update the spawn amounts for the subzone and the total
</span>    self.spawnsManip_[subZoneKey_] = self.spawnsManip_[subZoneKey_] + _val
    self._spawnsManipTotal = self._spawnsManipTotal + _val

    <span class="comment">-- Debug: Print updated values
</span>    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_distributeDifference                        | ZONE: %s  | After SubZone Actual : %d | After MainZone Total : %d"</span>, self.Zones.Sub[subZoneKey_].name, self.spawnsManip_[subZoneKey_], self._spawnsManipTotal))
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._distributeDifference.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Execute a sequence of updates on the SPECTRE.SPAWNER object.
</span><span class="comment">--
</span><span class="comment">-- This function orchestrates a series of method calls to update the <code>SPECTRE.SPAWNER</code> object.
</span><span class="comment">-- It sequentially executes the following methods:
</span><span class="comment">-- 1. <code>_seedRollUpdates</code> - Initiates updates based on seed rolls.
</span><span class="comment">-- 2. <code>_introduceRandomness</code> - Injects randomness into the spawning process.
</span><span class="comment">-- 3. <code>_distributeDifference</code> - Balances spawn distribution across subzones.
</span><span class="comment">-- 4. <code>_assignAndUpdateSubZones</code> - Assigns spawns and updates subzone details.
</span><span class="comment">-- This method chain is crucial for maintaining the operational integrity and dynamic behavior of the spawner.
</span><span class="comment">-- If enabled, benchmark timing for this process is recorded for performance analysis.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2500"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_RollUpdates()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_RollUpdates | ---------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._RollUpdates = {Time = {},}
    self.BenchmarkLog._RollUpdates.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Chain together method calls for update
</span>
  self:_seedRollUpdates():_introduceRandomness():_distributeDifference():_assignAndUpdateSubZones()

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._RollUpdates.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>


<span class="comment">--- Assign computed values to subzones and perform updates.
</span><span class="comment">--
</span><span class="comment">-- This function takes computed values stored in <code>self.spawnsManip_</code> and applies them to the subzones.
</span><span class="comment">-- It updates the generation thresholds of each subzone, applies clamping to these thresholds, and then verifies
</span><span class="comment">-- the overall totals for consistency. If <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1, debug information is generated,
</span><span class="comment">-- detailing the operations performed on each subzone, including updates to spawn totals and threshold adjustments.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2527"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_assignAndUpdateSubZones()
  <span class="comment">-- Debug: Print header
</span>  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_assignAndUpdateSubZones | ASSIGN UPDATES"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._assignAndUpdateSubZones = {Time = {},}
    self.BenchmarkLog._assignAndUpdateSubZones.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>


  <span class="comment">-- Assign computed values to subzones and update them
</span>  <span class="keyword">for</span> zoneName, newActual <span class="keyword">in</span> <span class="global">pairs</span>(self.spawnsManip_) <span class="keyword">do</span>
    <span class="comment">-- Assign new actual spawn value
</span>    self.Zones.Sub[zoneName].SpawnAmountSettings.Generated.Actual = newActual

    <span class="comment">-- Debug: Print zone and new actual spawn total
</span>    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_assignAndUpdateSubZones | -------------------------------------------------"</span>)
    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_assignAndUpdateSubZones | ZONE        | %s"</span>, zoneName))
    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_assignAndUpdateSubZones | DISTRIBUTED | NEW ACTUAL SPAWN TOTAL | %d"</span>, newActual))

    <span class="comment">-- Update generation thresholds and clamp them
</span>    self.Zones.Sub[zoneName]:_UpdateGenThresholds()
    self:_thresholdClamp(zoneName)
  <span class="keyword">end</span>

  <span class="comment">-- Confirm the updated totals
</span>  self:_confirmTotals()
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._assignAndUpdateSubZones.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Adjust spawn values based on threshold violations.
</span><span class="comment">--
</span><span class="comment">-- This function assesses the spawn values of a specified subzone against its predefined thresholds
</span><span class="comment">-- (maximum, minimum, and nominal). In cases where the spawn value exceeds or falls short of these thresholds,
</span><span class="comment">-- adjustments are made by altering the spawn values of randomly selected subzones. This ensures that
</span><span class="comment">-- the overall spawn values remain within acceptable limits. Debug information detailing the adjustment process
</span><span class="comment">-- and the nature of threshold violations can be output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param zoneName The name of the subzone being checked for threshold violations.
</span><a id="2571"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_thresholdClamp(zoneName)


  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_thresholdClamp | ---------------"</span>)
  <span class="keyword">local</span> thresholds = self.Zones.Sub[zoneName].SpawnAmountSettings.Generated.Thresholds

  <span class="comment">-- Check for threshold violations and adjust spawn values accordingly
</span>  <span class="keyword">if</span> thresholds.overMax &gt; <span class="number">0</span> <span class="keyword">or</span> thresholds.underMin &gt; <span class="number">0</span> <span class="keyword">then</span>
    <span class="keyword">local</span> action, logAction, logMessage
    <span class="keyword">if</span> thresholds.overMax &gt; <span class="number">0</span> <span class="keyword">then</span>
      action = -<span class="number">1</span>
      logAction = <span class="string">"REDUCING"</span>
      logMessage = <span class="string">"OVER MAX SPAWNS"</span>
    <span class="keyword">elseif</span> thresholds.underMin &gt; <span class="number">0</span> <span class="keyword">then</span>
      action = <span class="number">1</span>
      logAction = <span class="string">"INCREASING"</span>
      logMessage = <span class="string">"UNDER MIN SPAWNS"</span>
    <span class="keyword">elseif</span> thresholds.overNom &gt; <span class="number">0</span> <span class="keyword">then</span>
      action = -<span class="number">1</span>
      logAction = <span class="string">"REDUCING"</span>
      logMessage = <span class="string">"OVER NOM SPAWNS"</span>
    <span class="keyword">elseif</span> thresholds.underNom &gt; <span class="number">0</span> <span class="keyword">then</span>
      action = <span class="number">1</span>
      logAction = <span class="string">"INCREASING"</span>
      logMessage = <span class="string">"UNDER NOM SPAWNS"</span>
    <span class="keyword">end</span>

    <span class="comment">-- Log the threshold violation and start adjustments
</span>    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_thresholdClamp | ZONE: %s | %s | Init Nudge"</span>, self.Zones.Main.name, logMessage))
    <span class="keyword">for</span> _ = <span class="number">1</span>, <span class="global">math</span>.abs(action * (thresholds.overMax + thresholds.underMin + thresholds.overNom + thresholds.underNom)) <span class="keyword">do</span>
      <span class="keyword">local</span> index = self.keys[<span class="global">math</span>.random(#self.keys)]
      self.Zones.Sub[index].SpawnAmountSettings.Generated.Actual = self.Zones.Sub[index].SpawnAmountSettings.Generated.Actual + action
      SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_thresholdClamp | %s SUB ZONE: %s BY %d"</span>, logAction, index, action))
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Confirm the total spawns across all subzones.
</span><span class="comment">--
</span><span class="comment">-- This function verifies that the sum of spawn values across all subzones aligns with the expected total
</span><span class="comment">-- for the main zone. It iterates through each subzone, summing up their respective spawn values, and compares
</span><span class="comment">-- this sum with the main zone's expected total spawn value. If <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1, it outputs
</span><span class="comment">-- debug information, including the spawn totals for each subzone and the cumulative total, to facilitate monitoring
</span><span class="comment">-- and verification of spawn distribution.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2621"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_confirmTotals()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | ---------------"</span>)
  <span class="keyword">local</span> confirmedTotal = <span class="number">0</span>

  <span class="keyword">for</span> zoneName, zoneObj <span class="keyword">in</span> <span class="global">pairs</span>(self.Zones.Sub) <span class="keyword">do</span>
    <span class="keyword">local</span> currentZoneActual = zoneObj.SpawnAmountSettings.Generated.Actual

    <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
      <span class="comment">-- Debug: Print details for the current subzone
</span>      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | -------------------------------------------------"</span>)
      SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | SUB ZONE    | %s"</span>, zoneName))
      SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | DISTRIBUTED | SUB ZONE SPAWN TOTAL      | %d"</span>, currentZoneActual))
    <span class="keyword">end</span>

    <span class="comment">-- Update the confirmed total
</span>    confirmedTotal = confirmedTotal + currentZoneActual
    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | DISTRIBUTED | NEW MAIN ZONE SPAWN TOTAL | %d"</span>, confirmedTotal))
  <span class="keyword">end</span>

  <span class="keyword">if</span> SPECTRE.DebugEnabled == <span class="number">1</span> <span class="keyword">then</span>
    <span class="comment">-- Debug: Print details for the main zone
</span>    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | MAIN ZONE          | %s"</span>, self.Zones.Main.name))
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | -------------------------------------------------------------------------"</span>)
    SPECTRE.UTILS.debugInfo(<span class="global">string</span>.format(<span class="string">"SPECTRE.SPAWNER:_confirmTotals | DISTRIBUTE RESULTS | Expected: %d | GOT: %d"</span>, self.Zones.Main.SpawnAmountSettings.Generated.Actual, confirmedTotal))
  <span class="keyword">end</span>

  <span class="comment">-- Return self for potential method chaining
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Calculate and assign group types for a given zone.
</span><span class="comment">--
</span><span class="comment">-- This internal function generates the types of units for each group in a specified zone. It iterates
</span><span class="comment">-- through the group settings of the zone, creating lists of unit types for each group based on the
</span><span class="comment">-- specified sizes and available unit types. The function manages the allocation of unit types, ensuring
</span><span class="comment">-- that the number of units of each type stays within the defined limits. It also handles the addition of
</span><span class="comment">-- extra unit types to groups as specified in the zone's settings. Debug information is output for each step
</span><span class="comment">-- of the process if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _zoneObject The zone object for which group types are being generated.
</span><a id="2663"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_generateGroupTypes(_zoneObject)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.BenchmarkLog._generateGroupTypes <span class="keyword">then</span> self.BenchmarkLog._generateGroupTypes = {} <span class="keyword">end</span>
    self.BenchmarkLog._generateGroupTypes[_zoneObject.name] = {Time = {},}
    self.BenchmarkLog._generateGroupTypes[_zoneObject.name].Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="comment">-- Loop through each group setting.
</span>  <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
    <span class="keyword">local</span> _groupTypes = {}
    <span class="comment">-- Loop for the number of groups specified in the current setting.
</span>    <span class="keyword">for</span> _ = <span class="number">1</span>, setting.numGroups <span class="keyword">do</span>
      <span class="comment">-- List to store types for this group.
</span>      <span class="keyword">local</span> _UnitTypes = {}
      <span class="comment">-- Loop for the size of the group + extra units.
</span>      <span class="keyword">for</span> _Unit = <span class="number">1</span>, setting.size <span class="keyword">do</span>
        <span class="keyword">local</span> typeToAdd  <span class="comment">-- Variable to store the type to add for this iteration.
</span>        <span class="keyword">local</span> _TypeK

        <span class="comment">-- Pick a random type.
</span>        <span class="keyword">if</span> SPECTRE.UTILS.sumTable(self.AllTypesManip_) &gt; <span class="number">0</span> <span class="keyword">then</span>
          SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | AllTypesManip_ so pick from self.AllTypesManip_"</span> , self.AllTypesManip_)
          _TypeK = SPECTRE.UTILS.PickRandomFromKVTable(self.AllTypesManip_)
        <span class="keyword">else</span>
          SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | NOT AllTypesManip_ so pick from self.NonLimitedTypes"</span> , self.NonLimitedTypes)
          _TypeK = SPECTRE.UTILS.PickRandomFromKVTable(self.NonLimitedTypes)
        <span class="keyword">end</span>


        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | Selected Type:"</span> , _TypeK)

        <span class="keyword">local</span> randType = self.AllTypes[_TypeK]
        <span class="comment">-- Increment the number used count for this type.
</span>        randType.Actual = randType.Actual + <span class="number">1</span>
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | Selected Type Value self.AllTypes[_TypeK]:"</span> , randType)

        <span class="keyword">if</span> (randType.Actual &gt;= randType.Max) <span class="keyword">then</span>
          SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | Selected Type count is at max. Removing from possible choices."</span>)
          SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | (randType.Actual &gt;= randType.Max)"</span>)
          self.AllTypesManip_[_TypeK] = <span class="keyword">nil</span>
        <span class="keyword">end</span>

        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | Finalized Type to add:"</span> ..  _TypeK)
        typeToAdd = _TypeK
        <span class="comment">-- Add the selected type to the group types list, all types list, and the main AllTypes list.
</span>        <span class="global">table</span>.insert(_UnitTypes, typeToAdd)
      <span class="keyword">end</span>

      <span class="keyword">for</span> _type, _numType <span class="keyword">in</span> <span class="global">pairs</span>(_zoneObject.SpawnAmountSettings.ExtraTypesToGroups) <span class="keyword">do</span>
        <span class="keyword">for</span> _i = <span class="number">1</span>, _numType, <span class="number">1</span> <span class="keyword">do</span>
          <span class="global">table</span>.insert(_UnitTypes, _type)
        <span class="keyword">end</span>
      <span class="keyword">end</span>
      <span class="global">table</span>.insert(_groupTypes, _UnitTypes)
    <span class="keyword">end</span>
    <span class="comment">-- Add the group types list to the main group list for this iteration.
</span>    setting.Types = _groupTypes
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | setting"</span> , setting)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | _groupSettingIndex"</span> ..  _groupSettingIndex)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | setting.Types"</span> , setting.Types)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | setting.Types[_groupSettingIndex]"</span> , setting.Types[_groupSettingIndex])
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTypes | _groupTypes"</span> , _groupTypes)
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._generateGroupTypes[_zoneObject.name].Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Generate group templates for a specific zone object.
</span><span class="comment">--
</span><span class="comment">-- This function is tasked with creating templates for groups within a given zone. It iterates through the
</span><span class="comment">-- group settings of the zone, assigning unit types to each group based on predefined settings and types.
</span><span class="comment">-- The function ensures that each group is composed of a mix of unit types as specified in the zone's settings,
</span><span class="comment">-- including any additional units. The final templates are then stored in the zone's group settings. Debug information
</span><span class="comment">-- regarding the composition of each group is output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded
</span><span class="comment">-- if enabled, to monitor the performance of the template generation process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _zoneObject The zone object for which group templates are being generated.
</span><a id="2745"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_generateGroupTemplates(_zoneObject)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_generateGroupTemplates | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.BenchmarkLog._generateGroupTemplates <span class="keyword">then</span> self.BenchmarkLog._generateGroupTemplates = {} <span class="keyword">end</span>
    self.BenchmarkLog._generateGroupTemplates[_zoneObject.name] = {Time = {},}
    self.BenchmarkLog._generateGroupTemplates[_zoneObject.name].Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Loop through each group setting.
</span>  <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
    <span class="keyword">local</span> _groupTypes = {}
    <span class="comment">-- Loop for the number of groups specified in the current setting.
</span>    <span class="keyword">for</span> _ = <span class="number">1</span>, setting.numGroups <span class="keyword">do</span>
      <span class="comment">-- List to store types for this group.
</span>      <span class="keyword">local</span> _UnitTypes = {}
      <span class="comment">-- Loop for the size of the group + extra units.
</span>      <span class="keyword">for</span> _Unit = <span class="number">1</span>, setting.size + _zoneObject.SpawnAmountSettings.numExtraUnits <span class="keyword">do</span> <span class="comment">--+ self.Config
</span>        <span class="keyword">local</span> typeToAdd  <span class="comment">-- Variable to store the type to add for this iteration.
</span>        <span class="keyword">local</span> lookUpType  = setting.Types[_][_Unit]
        <span class="comment">-- Pick a random type.
</span>        <span class="keyword">local</span> _Table = SPECTRE.UTILS.Shuffle(self.AllTypes[lookUpType].GroupNames)
        <span class="keyword">local</span> _TypeV = SPECTRE.UTILS.PickRandomFromTable(_Table)
        SPECTRE.UTILS.debugInfo(<span class="string">"_TypeV"</span> , _TypeV)
        typeToAdd = _TypeV
        <span class="comment">-- Add the selected type to the group types list, all types list, and the main AllTypes list.
</span>        <span class="global">table</span>.insert(_UnitTypes, typeToAdd)
      <span class="keyword">end</span>
      <span class="global">table</span>.insert(_groupTypes, _UnitTypes)
    <span class="keyword">end</span>
    <span class="comment">-- Add the group types list to the main group list for this iteration.
</span>    setting.Templates = _groupTypes
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._generateGroupTemplates[_zoneObject.name].Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Initialize and assign type settings for the SPAWNER.
</span><span class="comment">--
</span><span class="comment">-- This function populates the SPAWNER with various types based on the template settings.
</span><span class="comment">-- It filters and adds types that meet specific criteria, such as having a maximum count greater than zero
</span><span class="comment">-- and belonging to a group. The function calculates the ratio of each type against the total and categorizes
</span><span class="comment">-- types as either limited or non-limited based on their settings. This seeding process is crucial for
</span><span class="comment">-- ensuring a diverse and balanced mix of types for spawn generation. Debug information detailing the
</span><span class="comment">-- types added and their properties is output if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing
</span><span class="comment">-- is recorded if enabled, to track the performance of the seeding process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><a id="2794"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_seedTypes()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._seedTypes = {Time = {},}
    self.BenchmarkLog._seedTypes.Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">local</span> _AllTypes = {}
  <span class="keyword">local</span> _totalTypesMax = <span class="number">0</span>
  <span class="keyword">for</span> _typeENUM, _templateType <span class="keyword">in</span> <span class="global">pairs</span> (self.TEMPLATETYPES_ ) <span class="keyword">do</span>

    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | _typeENUM"</span> , _typeENUM)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | _templateType"</span> , _templateType)

    <span class="keyword">if</span> (_templateType.Max &gt; <span class="number">0</span>)
      <span class="keyword">and</span>
      #_templateType.GroupNames &gt; <span class="number">0</span>
    <span class="keyword">then</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | NOT NIL SO ADD: "</span>)
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | _typeENUM"</span> , _typeENUM)
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | _templateType"</span> , _templateType)
      _AllTypes[_typeENUM] = _templateType
      _totalTypesMax       = _totalTypesMax + _templateType.Max
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">for</span> _typeENUM, _templateType <span class="keyword">in</span> <span class="global">pairs</span> (_AllTypes ) <span class="keyword">do</span>
    _templateType.RatioMax = _templateType.Max/_totalTypesMax <span class="keyword">or</span> <span class="number">0</span>
  <span class="keyword">end</span>

  self._totalTypesMax = _totalTypesMax
  self.AllTypes = _AllTypes

  <span class="keyword">for</span> _k, _v <span class="keyword">in</span> <span class="global">pairs</span>(self.AllTypes) <span class="keyword">do</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | ADD AllTypesManip_  | "</span> , _k)
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes | value:  | "</span> , _v)
    self.AllTypesManip_[_k] = _v
    <span class="keyword">if</span> _v.limited == <span class="keyword">true</span> <span class="keyword">then</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes |ADD LimitedTypes  | "</span> , _k)
      self.LimitedTypes[_k] = _v
    <span class="keyword">else</span>
      SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_seedTypes |ADD NonLimitedTypes  | "</span> , _k)
      self.NonLimitedTypes[_k] = _v
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._seedTypes.Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>


<span class="comment">--- Create and return a group settings object based on the provided size and group spacing configurations.
</span><span class="comment">--
</span><span class="comment">-- This function constructs a group settings object for a specified group size. It uses provided
</span><span class="comment">-- spacing configurations for groups and units within those groups. The function calculates the minimum
</span><span class="comment">-- and maximum separations for both groups and units, incorporating specific settings for the group size,
</span><span class="comment">-- or defaulting to general settings if specific ones are not available. The created group settings object
</span><span class="comment">-- is then configured with these spacing parameters, along with the number of groups and their sizes.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self The instance of the SPAWNER class.
</span><span class="comment">-- @param size The size of the group.
</span><span class="comment">-- @param numGroupSize The number of groups of the specified size.
</span><span class="comment">-- @param SpacingSettings_ The spacing settings for groups.
</span><a id="2861"></a><span class="comment">-- @return #GroupSettings_ A new group settings object with the specified configurations.
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_createGroupSettings(size, numGroupSize, SpacingSettings_)
  <span class="keyword">local</span> groupsMinSeperation   = SpacingSettings_[size].Groups.minSeperation <span class="keyword">or</span> SpacingSettings_.General.Groups.minSeperation
  <span class="keyword">local</span> groupsMaxSeperation   = SpacingSettings_[size].Groups.maxSeperation <span class="keyword">or</span> SpacingSettings_.General.Groups.maxSeperation
  <span class="keyword">local</span> unitsMinSeperation    = SpacingSettings_[size].Units.minSeperation  <span class="keyword">or</span> SpacingSettings_.General.Units.minSeperation
  <span class="keyword">local</span> unitsMaxSeperation    = SpacingSettings_[size].Units.maxSeperation  <span class="keyword">or</span> SpacingSettings_.General.Units.maxSeperation
  <span class="keyword">local</span> distanceFromBuildings = SpacingSettings_[size].distanceFromBuildings <span class="keyword">or</span> SpacingSettings_.General.DistanceFromBuildings

  <span class="keyword">return</span> self.GroupSettings_:New():setGroupSettings(size, numGroupSize, groupsMinSeperation, groupsMaxSeperation, unitsMinSeperation, unitsMaxSeperation, distanceFromBuildings)
<span class="keyword">end</span>


<span class="comment">--- Set the vector positions for unit templates within each group of a zone.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for determining the specific vector positions (<code>Vec2</code>) for unit templates within each group
</span><span class="comment">-- of a given zone. It iterates through each group setting within the zone, calculating potential positions for units while
</span><span class="comment">-- adhering to specified separation requirements and checking against restricted areas. This process ensures that units are
</span><span class="comment">-- appropriately spaced both within their groups and relative to other groups and restricted zones. The function generates
</span><span class="comment">-- and stores these vector positions for use in subsequent spawning processes. Debug information is output detailing
</span><span class="comment">-- the placement process if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled, to track the
</span><span class="comment">-- efficiency of the vector positioning process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _zoneObject The zone object for which unit template positions are being set.
</span><a id="2885"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Set_Vec2_UnitTemplates(_zoneObject)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:Set_Vec2_UnitTemplates | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.BenchmarkLog.Set_Vec2_UnitTemplates <span class="keyword">then</span> self.BenchmarkLog.Set_Vec2_UnitTemplates = {} <span class="keyword">end</span>
    self.BenchmarkLog.Set_Vec2_UnitTemplates[_zoneObject.name] = {Time = {},}
    self.BenchmarkLog.Set_Vec2_UnitTemplates[_zoneObject.name].Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Loop through each group setting.
</span>  <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
    <span class="keyword">local</span> _groupTypes = {}
    <span class="keyword">local</span> _groupTypesobj = {}
    <span class="comment">-- Loop for the number of groups specified in the current setting.
</span>    <span class="keyword">for</span> _groupIndex = <span class="number">1</span>, setting.numGroups <span class="keyword">do</span>
      <span class="keyword">local</span> tempZoneName = _zoneObject.name .. <span class="string">"z"</span> .. _groupSettingIndex .. <span class="string">"j"</span> .. _groupIndex
      <span class="keyword">local</span> tempZoneVec2 = setting.GroupCenters[_groupIndex]

      <span class="keyword">local</span> tempZoneRadius = (setting.seperation.units.max * setting.size) +
        (setting.seperation.groups.min * setting.numGroups) +
        setting.distanceFromBuildings

      setting.ZoneObjects[_groupIndex] = ZONE_RADIUS:New(tempZoneName, tempZoneVec2, tempZoneRadius)
      <span class="keyword">local</span> _tempZoneObject = setting.ZoneObjects[_groupIndex]
      <span class="keyword">local</span> objectCoords = self.FindObjectsInZone(_tempZoneObject)
      <span class="comment">-- List to store types for this group.
</span>      <span class="keyword">local</span> _UnitTypes = {}
      <span class="comment">--local _UnitTypesobj = {}
</span>
      <span class="comment">-- Loop for the size of the group + extra units.
</span>      <span class="keyword">for</span> _Unit = <span class="number">1</span>, setting.size + _zoneObject.SpawnAmountSettings.numExtraUnits <span class="keyword">do</span> <span class="comment">--+ self.Config.numExtraUnits
</span>        <span class="keyword">local</span> possibleVec2
        <span class="keyword">local</span> flag_goodcoord = <span class="keyword">true</span>
        <span class="keyword">local</span> glassBreak = <span class="number">0</span>

        <span class="keyword">repeat</span>
          flag_goodcoord = <span class="keyword">true</span>
          possibleVec2 = _tempZoneObject:GetRandomVec2()

          <span class="keyword">if</span> flag_goodcoord <span class="keyword">then</span> flag_goodcoord = self.checkNOGO(self, possibleVec2, self.Zones.Restricted) <span class="keyword">end</span>

          <span class="keyword">if</span> flag_goodcoord <span class="keyword">then</span>
            <span class="keyword">for</span> _, coords <span class="keyword">in</span> <span class="global">pairs</span>(objectCoords) <span class="keyword">do</span>
              <span class="keyword">local</span> distance = coords == <span class="string">"units"</span> <span class="keyword">and</span> setting.seperation.units.min <span class="keyword">or</span> setting.distanceFromBuildings
              <span class="keyword">for</span> _, checkCoord <span class="keyword">in</span> <span class="global">ipairs</span>(coords) <span class="keyword">do</span>
                <span class="keyword">if</span> SPECTRE.WORLD.f_distance(checkCoord, possibleVec2) &lt; distance <span class="keyword">then</span>
                  flag_goodcoord = <span class="keyword">false</span>
                  <span class="keyword">break</span>
                <span class="keyword">end</span>
              <span class="keyword">end</span>
              <span class="keyword">if</span> <span class="keyword">not</span> flag_goodcoord <span class="keyword">then</span> <span class="keyword">break</span> <span class="keyword">end</span>
            <span class="keyword">end</span>
          <span class="keyword">end</span>

          <span class="keyword">if</span> glassBreak &gt;= self.Config.operationLimit <span class="keyword">then</span>
            flag_goodcoord = <span class="keyword">true</span>
          <span class="keyword">end</span>
          glassBreak = glassBreak + <span class="number">1</span>
        <span class="keyword">until</span> flag_goodcoord

        <span class="comment">-- Add the selected type
</span>        objectCoords.units[#objectCoords.units + <span class="number">1</span>] = possibleVec2
        <span class="global">table</span>.insert(_UnitTypes, possibleVec2)
      <span class="keyword">end</span>
      <span class="global">table</span>.insert(_groupTypesobj, objectCoords)
      <span class="global">table</span>.insert(_groupTypes, _UnitTypes)
    <span class="keyword">end</span>
    <span class="comment">-- Add the group types list to the main group list for this iteration.
</span>    setting.TemplateCoords = _groupTypes
    setting.ObjectCoords = _groupTypesobj
  <span class="keyword">end</span>

  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Set_Vec2_UnitTemplates[_zoneObject.name].Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set up spawn groups for a specific zone object.
</span><span class="comment">--
</span><span class="comment">-- This internal function configures the spawn groups for a given zone within the SPAWNER system.
</span><span class="comment">-- It iterates through each group setting in the zone, creating spawn groups based on the predefined
</span><span class="comment">-- templates, types, and vector positions. The function manages the creation and configuration of these
</span><span class="comment">-- groups, ensuring they are properly initialized with the correct coalition, country, and heading.
</span><span class="comment">-- Debug information is output for each group's configuration details if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1.
</span><span class="comment">-- Benchmark timing is recorded if enabled, to track the performance of the group setup process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER
</span><span class="comment">-- @param _zoneObject The zone object for which spawn groups are being set up.
</span><a id="2973"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:_SetupSpawnGroups(_zoneObject)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.BenchmarkLog._SetupSpawnGroups <span class="keyword">then</span> self.BenchmarkLog._SetupSpawnGroups = {} <span class="keyword">end</span>
    self.BenchmarkLog._SetupSpawnGroups[_zoneObject.name] = {Time = {},}
    self.BenchmarkLog._SetupSpawnGroups[_zoneObject.name].Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">local</span> typeCounter = self.COUNTER
  <span class="comment">-- Loop through each group setting.
</span>  <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
    <span class="keyword">local</span> _groupTypes = {}
    <span class="comment">-- Loop for the number of groups specified in the current setting.
</span>    <span class="keyword">for</span> _groupIndex = <span class="number">1</span>, setting.numGroups <span class="keyword">do</span>
      <span class="comment">-- List to store types for this group.
</span>      <span class="keyword">local</span> _UnitTypes = {}

      <span class="comment">-- Loop for the size of the group + extra units.
</span>      <span class="keyword">for</span> _Unit = <span class="number">1</span>, setting.size + _zoneObject.SpawnAmountSettings.numExtraUnits <span class="keyword">do</span> <span class="comment">--+ self.Config.numExtraUnits
</span>        <span class="keyword">local</span> _vec2 = setting.TemplateCoords[_groupIndex][_Unit]
        <span class="keyword">local</span> _TemplateName = setting.Templates[_groupIndex][_Unit]
        <span class="keyword">local</span> _TypeName = setting.Types[_groupIndex][_Unit]
        <span class="keyword">local</span> _SPAWNNAME = self.PREFIX .. _TypeName

        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _Spawn"</span>)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _vec2"</span>, _vec2)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _TemplateName"</span>, _TemplateName)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _TypeName"</span>, _TypeName)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _SPAWNNAME"</span>, _SPAWNNAME)

        <span class="keyword">local</span> tempCode = typeCounter
        <span class="keyword">local</span> FoundGroup
        <span class="keyword">repeat</span>
          FoundGroup = GROUP:FindByName(_SPAWNNAME .. <span class="string">"_"</span> .. tempCode .. <span class="string">"#001"</span>)
          <span class="keyword">if</span> FoundGroup <span class="keyword">then</span>
            tempCode = tempCode + <span class="number">1</span>
          <span class="keyword">else</span>
            FoundGroup = <span class="keyword">false</span>
          <span class="keyword">end</span>
        <span class="keyword">until</span> (FoundGroup == <span class="keyword">false</span>)
        typeCounter = tempCode

        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | GROUP ------------------------------------"</span>)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | Name          : "</span>.. _SPAWNNAME .. <span class="string">"_"</span> .. tempCode)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _TemplateName : "</span>.. _TemplateName)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _vec2.x       : "</span>.. _vec2.x .. <span class="string">" | _vec2.y : "</span>.. _vec2.y)
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | spawnCoalition: "</span> .. <span class="global">tostring</span>(self.spawnCoalition))
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | spawnCountry  : "</span> .. <span class="global">tostring</span>(self.spawnCountry))

        <span class="keyword">local</span> _spawnunit = SPAWN:NewWithAlias(_TemplateName, _SPAWNNAME .. <span class="string">"_"</span> .. tempCode)
          :InitCoalition(self.spawnCoalition)
          :InitCountry(self.spawnCountry)
          :InitHeading(<span class="number">0</span>,<span class="number">364</span>)

        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:_SetupSpawnGroups | _spawnunit"</span> , _spawnunit)
        typeCounter = typeCounter + <span class="number">1</span>
        <span class="comment">-- Add the selected type to the group types list, all types list, and the main AllTypes list.
</span>        <span class="global">table</span>.insert(_UnitTypes, _spawnunit)
        <span class="comment">--table.insert(_UnitTypesobj, objectCoords)
</span>      <span class="keyword">end</span>
      <span class="global">table</span>.insert(_groupTypes, _UnitTypes)
    <span class="keyword">end</span>
    <span class="comment">-- Add the group types list to the main group list for this iteration.
</span>    setting.SpawnedGROUPS = _groupTypes
  <span class="keyword">end</span>
  self.COUNTER = typeCounter
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog._SetupSpawnGroups[_zoneObject.name].Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set the central vector positions for groups within a zone.
</span><span class="comment">--
</span><span class="comment">-- This function calculates and assigns central vector positions (<code>Vec2</code>) for each group in a given zone
</span><span class="comment">-- object. It iterates through the group settings of the zone, determining suitable central positions for
</span><span class="comment">-- the groups while respecting separation constraints from other units, groups, and restricted zones.
</span><span class="comment">-- The function ensures that each group center is appropriately located, facilitating organized and
</span><span class="comment">-- strategically placed spawns. Debug information is output detailing the process of finding these central
</span><span class="comment">-- positions if <a href="../modules/SPECTRE.html#DebugEnabled">SPECTRE.DebugEnabled</a> is set to 1. Benchmark timing is recorded if enabled, to track the
</span><span class="comment">-- efficiency of the positioning process.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER self
</span><span class="comment">-- @param _zoneObject The zone object for which group centers are being set.
</span><a id="3057"></a><span class="comment">-- @return #SPAWNER self
</span><span class="keyword">function</span> SPECTRE.SPAWNER:Set_Vec2_GroupCenters(_zoneObject)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.SPAWNER:Set_Vec2_GroupCenters | -------------------------------------------------------------------------"</span>)
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.BenchmarkLog.Set_Vec2_GroupCenters <span class="keyword">then</span> self.BenchmarkLog.Set_Vec2_GroupCenters = {} <span class="keyword">end</span>
    self.BenchmarkLog.Set_Vec2_GroupCenters[_zoneObject.name] = {Time = {},}
    self.BenchmarkLog.Set_Vec2_GroupCenters[_zoneObject.name].Time.start = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="comment">-- Loop through each group setting.
</span>  <span class="keyword">for</span> _groupSettingIndex, setting <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.GroupSettings) <span class="keyword">do</span>
    <span class="keyword">local</span> _groupTypes = {}
    <span class="comment">-- Loop for the number of groups specified in the current setting.
</span>    <span class="keyword">for</span> _ = <span class="number">1</span>, setting.numGroups <span class="keyword">do</span>
      <span class="keyword">local</span> glassBreak = <span class="number">0</span>
      <span class="keyword">local</span> possibleVec2
      <span class="keyword">local</span> flag_goodcoord = <span class="keyword">true</span>

      <span class="keyword">repeat</span>
        flag_goodcoord = <span class="keyword">true</span>
        possibleVec2 = _zoneObject.Object:GetRandomVec2()
        <span class="keyword">if</span> flag_goodcoord <span class="keyword">then</span> flag_goodcoord = self.checkNOGO(self, possibleVec2, self.Zones.Restricted) <span class="keyword">end</span>

        <span class="keyword">if</span> flag_goodcoord <span class="keyword">then</span>
          <span class="keyword">for</span> _, coords <span class="keyword">in</span> <span class="global">pairs</span>(_zoneObject.ObjectCoords) <span class="keyword">do</span>
            <span class="keyword">local</span> distance
            <span class="keyword">if</span> coords == <span class="string">"units"</span> <span class="keyword">then</span>
              distance = setting.seperation.units.min
            <span class="keyword">elseif</span> coords == <span class="string">"groupcenters"</span> <span class="keyword">then</span>
              distance = setting.seperation.groups.min
            <span class="keyword">else</span>
              distance = setting.distanceFromBuildings
            <span class="keyword">end</span>
            <span class="keyword">if</span> coords == <span class="string">"groupcenters"</span> <span class="keyword">then</span>
              <span class="keyword">for</span> _, checkCoord <span class="keyword">in</span> <span class="global">ipairs</span>(_zoneObject.ObjectCoords[coords]) <span class="keyword">do</span>
                <span class="keyword">if</span> SPECTRE.WORLD.f_distance(checkCoord, possibleVec2) &lt; distance <span class="keyword">then</span>
                  flag_goodcoord = <span class="keyword">false</span>
                  <span class="keyword">break</span>
                <span class="keyword">end</span>
              <span class="keyword">end</span>
            <span class="keyword">end</span>
            <span class="keyword">if</span> <span class="keyword">not</span> flag_goodcoord <span class="keyword">then</span> <span class="keyword">break</span> <span class="keyword">end</span>
          <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="keyword">if</span> glassBreak &gt;= self.Config.operationLimit <span class="keyword">then</span>
          flag_goodcoord = <span class="keyword">true</span>
        <span class="keyword">end</span>
        glassBreak = glassBreak + <span class="number">1</span>
      <span class="keyword">until</span> flag_goodcoord

      _zoneObject.ObjectCoords.groupcenters[#_zoneObject.ObjectCoords.groupcenters + <span class="number">1</span>] = possibleVec2
      <span class="global">table</span>.insert(_groupTypes, possibleVec2)
    <span class="keyword">end</span>
    <span class="comment">-- Add the group types list to the main group list for this iteration.
</span>    setting.GroupCenters = _groupTypes
  <span class="keyword">end</span>
  <span class="keyword">if</span> self.Benchmark == <span class="keyword">true</span> <span class="keyword">then</span>
    self.BenchmarkLog.Set_Vec2_GroupCenters[_zoneObject.name].Time.stop = <span class="global">os</span>.clock()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Blueprint for template type objects in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">-- This table outlines the basic structure and attributes that a template type object should possess.
</span><a id="3121"></a><span class="comment">-- @field #SPAWNER.templateTypesObject
</span>SPECTRE.SPAWNER.templateTypesObject = {
  <span class="comment">-- The priority value for the template type. Determines precedence in certain operations.
</span>  _Priority = <span class="number">0</span>,
  <span class="comment">-- A collection of group names associated with this template type.
</span>  GroupNames = {},
  <span class="comment">-- The actual value or count of the template type in a given context.
</span>  Actual = <span class="number">0</span>,
  <span class="comment">-- The nominal or standard value for the template type.
</span>  Nominal = <span class="number">0</span>,
  <span class="comment">-- The maximum allowable value or count for the template type.
</span>  Max = <span class="number">0</span>,
  <span class="comment">-- The minimum allowable value or count for the template type.
</span>  Min = <span class="number">0</span>,
  <span class="comment">-- Ratio used to calculate the maximum value relative to the nominal.
</span>  RatioMax = <span class="number">0</span>,
  <span class="comment">-- Ratio used to calculate the minimum value relative to the nominal.
</span>  RatioMin = <span class="number">0</span>,
  <span class="comment">-- Ratio used to adjust the nominal value under certain conditions.
</span>  RatioNominal = <span class="number">0</span>,
  <span class="comment">-- Flag indicating whether the template type has a limit on its usage or spawn count.
</span>  limited = <span class="keyword">false</span>
}

<span class="comment">--- Create a new templateTypesObject.
</span><span class="comment">--
</span><span class="comment">-- This constructor function initializes a new instance of the templateTypesObject within the SPAWNER system.
</span><span class="comment">-- It sets up the object with a given priority and initializes default values for its properties,
</span><span class="comment">-- including group names and nominal, maximum, and minimum counts. This object is essential for managing
</span><span class="comment">-- and organizing template types based on their priority and other characteristics.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.templateTypesObject self The instance of the templateTypesObject being created.
</span><span class="comment">-- @param Priority The priority level assigned to the template type object, with a default value of 0 if not specified.
</span><span class="comment">-- @return #SPAWNER.templateTypesObject self The newly created instance of templateTypesObject with the specified priority.
</span><a id="3155"></a><span class="comment">-- @usage local newObj = SPECTRE.SPAWNER.templateTypesObject:New(1) -- Creates a new templateTypesObject with priority 1.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.templateTypesObject:New(Priority)
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New())

  <span class="comment">-- Set the provided priority and initialize default values for other properties
</span>  self._Priority = Priority <span class="keyword">or</span> <span class="number">0</span>
  self.GroupNames = {}
  self.Nominal = <span class="number">0</span>
  self.Max = <span class="number">0</span>
  self.Min = <span class="number">0</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>




<span class="comment">--- Group settings for the SPECTRE spawner system.
</span><span class="comment">-- This structure defines the configuration settings for groups in the dynamic spawning mechanism.
</span><span class="comment">-- It controls aspects such as group size, number of groups, separation between entities, and distances from landmarks like buildings.
</span><a id="3175"></a><span class="comment">-- @field #SPAWNER.GroupSettings_
</span>SPECTRE.SPAWNER.GroupSettings_ = {
  <span class="comment">-- The size of the group.
</span>  size = <span class="number">0</span>,
  <span class="comment">-- The number of groups.
</span>  numGroups = <span class="number">0</span>,
  <span class="comment">-- Separation distances for groups and units within groups.
</span>  seperation = {
    groups = {
      <span class="comment">-- Minimum separation distance between groups.
</span>      min = <span class="number">0</span>,
      <span class="comment">-- Maximum separation distance between groups.
</span>      max = <span class="number">0</span>
    },
    units = {
      <span class="comment">-- Minimum separation distance between units within a group.
</span>      min = <span class="number">0</span>,
      <span class="comment">-- Maximum separation distance between units within a group.
</span>      max = <span class="number">0</span>
    }
  },
  <span class="comment">-- The minimum distance from buildings for spawning.
</span>  distanceFromBuildings = <span class="number">0</span>,
  <span class="comment">-- Storage for types assigned to this group.
</span>  Types = {},
  <span class="comment">-- Storage for template types assigned to this group.
</span>  Templates = {},
  <span class="comment">-- Coordinates for the center of each group.
</span>  GroupCenters = {},
  <span class="comment">-- Generated zone objects for each group.
</span>  ZoneObjects = {},
  <span class="comment">-- Coordinates for templates within each group.
</span>  TemplateCoords = {},
  <span class="comment">-- Coordinates for objects within each group.
</span>  ObjectCoords = {},
  <span class="comment">-- Spawned group objects.
</span>  SpawnedGROUPS = {},
  <span class="comment">-- Scheduler for spawning groups.
</span>  SpawnScheduler = {}
}

<span class="comment">--- Create a new instance of GroupSettings for the SPECTRE spawner system.
</span><span class="comment">--
</span><span class="comment">-- This constructor function initializes a new instance of GroupSettings, a component of the SPECTRE spawner system.
</span><span class="comment">-- The newly created object is tailored to manage and configure group settings
</span><span class="comment">-- for spawn operations, which is essential for controlling the characteristics and behavior of spawned groups.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.GroupSettings_
</span><a id="3223"></a><span class="comment">-- @return #SPAWNER.GroupSettings_ self The newly initialized GroupSettings instance.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.GroupSettings_:New()
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New())
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Set the configurations for a group within the SPECTRE.SPAWNER.GroupSettings_ object.
</span><span class="comment">--
</span><span class="comment">-- This function configures the settings for a group in the SPAWNER system. It defines various parameters
</span><span class="comment">-- such as the size of the group, the number of such groups, and the separation distances between groups
</span><span class="comment">-- and individual units within them. Additionally, it sets the minimum required distance from nearby buildings.
</span><span class="comment">-- These settings are crucial for managing the spatial arrangement and behavior of spawned groups. The function
</span><span class="comment">-- returns the updated <code>GroupSettings_</code> object with these configurations.
</span><span class="comment">--
</span><span class="comment">-- @param #SPAWNER.GroupSettings_ self The instance of the GroupSettings being configured.
</span><span class="comment">-- @param size The size of the group.
</span><span class="comment">-- @param numGroups The number of groups of the specified size.
</span><span class="comment">-- @param groupsMinSeperation The minimum separation distance between groups.
</span><span class="comment">-- @param groupsMaxSeperation The maximum separation distance between groups.
</span><span class="comment">-- @param unitsMinSeperation The minimum separation distance between units within a group.
</span><span class="comment">-- @param unitsMaxSeperation The maximum separation distance between units within a group.
</span><span class="comment">-- @param distanceFromBuildings The minimum distance from nearby buildings.
</span><span class="comment">-- @return #SPAWNER.GroupSettings_ self The updated GroupSettings object.
</span><a id="3246"></a><span class="comment">-- @usage local groupSettings = SPECTRE.SPAWNER.GroupSettings_:setGroupSettings(size, numGroups, groupsMinSeperation, groupsMaxSeperation, unitsMinSeperation, unitsMaxSeperation, distanceFromBuildings) -- Configures and returns group settings.
</span><span class="keyword">function</span> SPECTRE.SPAWNER.GroupSettings_:setGroupSettings(size, numGroups, groupsMinSeperation, groupsMaxSeperation, unitsMinSeperation, unitsMaxSeperation, distanceFromBuildings)
  self.size = size
  self.numGroups = numGroups
  self.seperation = {
    groups = {min = groupsMinSeperation, max = groupsMaxSeperation},
    units = {min = unitsMinSeperation, max = unitsMaxSeperation},
  }
  self.distanceFromBuildings = distanceFromBuildings
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- 3 - TEMPLATETYPES_.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All TEMPLATETYPES_.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.SPAWNER
</span>
<span class="comment">--- Definitions and attributes for template types in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">--
</span><span class="comment">-- This table defines the properties and attributes associated with template types in the <code>SPECTRE.SPAWNER</code> system.
</span><span class="comment">-- It provides a mapping of different unit and vehicle types to their associated template objects.
</span><span class="comment">--
</span><a id="3271"></a><span class="comment">-- @field #SPAWNER.TEMPLATETYPES_
</span>SPECTRE.SPAWNER.TEMPLATETYPES_ = {}
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Ships]               = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">91</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.UnarmedShips]        = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">92</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.ArmedShips]          = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">93</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.LightArmedShips]     = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">94</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.HeavyArmedShips]     = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">95</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Corvettes]           = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">96</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Frigates]            = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">97</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Destroyers]          = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">98</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Cruisers]            = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">99</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.AircraftCarriers]    = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">100</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.GroundUnits]         = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">35</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Infantry]            = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">37</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.LightArmoredUnits]   = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">40</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.IFV]                 = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">53</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.APC]                 = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">54</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Artillery]           = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">51</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.MLRS]                = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">52</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.HeavyArmoredUnits]   = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">45</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.ModernTanks]         = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">57</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.OldTanks]            = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">56</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Tanks]               = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">55</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Buildings]           = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">65</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Fortifications]      = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">60</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.GroundVehicles]      = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">30</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.AAA]                 = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">71</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.AA_flak]             = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">73</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.StaticAAA]           = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">72</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.MobileAAA]           = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">75</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.EWR]                 = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">86</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.UnarmedVehicles]     = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">21</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Cars]                = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">25</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.Trucks]              = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">27</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.SamElements]         = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">80</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.IRGuidedSam]         = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">84</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.SRsam]               = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">81</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.MRsam]               = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">82</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.LRsam]               = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">83</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.ArmedGroundUnits]    = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">32</span>)
<span class="comment">---.
</span>SPECTRE.SPAWNER.TEMPLATETYPES_[SPECTRE.SPAWNER.typeENUMS.MANPADS]             = SPECTRE.SPAWNER.templateTypesObject:New(<span class="number">85</span>)</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2023-11-20 11:04:26 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
