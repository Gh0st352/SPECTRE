<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>S.P.E.C.T.R.E.</h1>


<ul>
  <li><a href="../manual.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/ai.lua.html">ai.lua</a></li>
  <li><a href="../source/brain.lua.html">brain.lua</a></li>
  <li><a href="../source/handlers.lua.html">handlers.lua</a></li>
  <li><a href="../source/iads.lua.html">iads.lua</a></li>
  <li><a href="../source/io.lua.html">io.lua</a></li>
  <li><a href="../source/markers.lua.html">markers.lua</a></li>
  <li><a href="../source/menu.lua.html">menu.lua</a></li>
  <li><strong>plyrmgr.lua</strong></li>
  <li><a href="../source/poly.lua.html">poly.lua</a></li>
  <li><a href="../source/rewards.lua.html">rewards.lua</a></li>
  <li><a href="../source/spawner.lua.html">spawner.lua</a></li>
  <li><a href="../source/spectre.lua.html">spectre.lua</a></li>
  <li><a href="../source/utils.lua.html">utils.lua</a></li>
  <li><a href="../source/world.lua.html">world.lua</a></li>
  <li><a href="../source/zonemgr.lua.html">zonemgr.lua</a></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/AI.html">AI</a></li>
  <li><a href="../modules/BRAIN.html">BRAIN</a></li>
  <li><a href="../modules/HANDLERS.html">HANDLERS</a></li>
  <li><a href="../modules/IADS.html">IADS</a></li>
  <li><a href="../modules/IO.html">IO</a></li>
  <li><a href="../modules/MARKERS.html">MARKERS</a></li>
  <li><a href="../modules/MENU.html">MENU</a></li>
  <li><a href="../modules/PLYRMGR.html">PLYRMGR</a></li>
  <li><a href="../modules/POLY.html">POLY</a></li>
  <li><a href="../modules/REWARDS.html">REWARDS</a></li>
  <li><a href="../modules/SPAWNER.html">SPAWNER</a></li>
  <li><a href="../modules/SPECTRE.html">SPECTRE</a></li>
  <li><a href="../modules/UTILS.html">UTILS</a></li>
  <li><a href="../modules/WORLD.html">WORLD</a></li>
  <li><a href="../modules/ZONEMGR.html">ZONEMGR</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/readme.md.html">readme</a></li>
</ul>

</div>

<div id="content">

    <h2>plyrmgr.lua</h2>
<pre>
<span class="comment">--- **PLYRMGR**
</span><span class="comment">--
</span><span class="comment">-- Comprehensive player management module within the SPECTRE framework.
</span><span class="comment">--
</span><span class="comment">--   * Manages player data, including points, groups, and slots.
</span><span class="comment">--   * Handles dynamic support functionalities like CAP, AIRDROP, and STRIKE.
</span><span class="comment">--   * Integrates with in-game events for real-time player updates.
</span><span class="comment">--
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- @module PLYRMGR
</span><span class="comment">-- @extends SPECTRE
</span>
<span class="comment">--- PLYRMGR.
</span><span class="comment">--
</span><span class="comment">-- This field represents the player management system within the broader SPECTRE framework. It includes functionalities
</span><span class="comment">-- for random seed generation, resource management, and player-specific operations. The module manages various aspects
</span><span class="comment">-- of player interaction and gameplay within the simulation environment.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR
</span>SPECTRE.PLYRMGR = {
  _randSeedMin = <span class="number">500</span>, <span class="comment">-- Minimum value for the random seed generator.
</span>  _randSeedMax = <span class="number">2000</span>, <span class="comment">-- Maximum value for the random seed generator.
</span>  _randSeedNom = <span class="number">2000</span>, <span class="comment">-- Nominal value for the random seed generator.
</span>  _randSeedNudge = <span class="number">0.7</span> <span class="comment">-- Nudge factor for the random seed generation process.
</span>}

<span class="comment">--- A table storing player-related data, indexed by player UCID.
</span><span class="comment">-- This table is used to keep track of individual player data within the SPECTRE.PLYRMGR system.
</span><a id="32"></a><span class="comment">-- @field #PLYRMGR.Players
</span>SPECTRE.PLYRMGR.Players = {}


<span class="comment">--- A table to store tracking information related to player actions or events.
</span><span class="comment">-- It is used to monitor and manage various player-related events and actions in the game.
</span><a id="38"></a><span class="comment">-- @field #PLYRMGR.TRACKERS
</span>SPECTRE.PLYRMGR.TRACKERS = {}

<span class="comment">--- An instance of an EVENT object to handle various game or simulation events.
</span><span class="comment">-- This object is pivotal for event handling within the SPECTRE.PLYRMGR system.
</span><a id="43"></a><span class="comment">-- @field #PLYRMGR.Handler_
</span>SPECTRE.PLYRMGR.Handler_ = EVENT:New()

<span class="comment">--- Settings.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Settings.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- A table to store the settings for the SPECTRE.PLYRMGR system.
</span><span class="comment">-- This includes various configurations and options that dictate the behavior of the system.
</span><a id="56"></a><span class="comment">-- @field #PLYRMGR.Settings
</span>SPECTRE.PLYRMGR.Settings = {}

<span class="comment">--- Indicates whether a reward system is active within the SPECTRE.PLYRMGR system.
</span><a id="60"></a><span class="comment">-- A true value enables the reward system, while false disables it.
</span>SPECTRE.PLYRMGR.Settings.Rewards = <span class="keyword">false</span>

<span class="comment">--- Indicates whether data persistence across sessions or events is active.
</span><a id="64"></a><span class="comment">-- A true value enables data persistence, while false disables it.
</span>SPECTRE.PLYRMGR.Settings.Persistance = <span class="keyword">false</span>

<a id="67"></a><span class="comment">--- A table to store report templates for the SPECTRE.PLYRMGR system.
</span>SPECTRE.PLYRMGR.Settings.Reports = {}

<a id="70"></a><span class="comment">--- The welcome report template for the SPECTRE.PLYRMGR system.
</span>SPECTRE.PLYRMGR.Settings.Reports.Welcome = {
  <span class="string">"Welcome to S.P.E.C.T.R.E. Dynamic Campaign!"</span>,
  <span class="string">"================================"</span>,
  <span class="string">"MISSION: Capture all enemy zones."</span>,
}

<span class="comment">--- Specifies which type of support functionalities are active (CAP, TOMAHAWK, BOMBER, etc.).
</span><span class="comment">-- This table is used to enable or disable different support functionalities within the SPECTRE.PLYRMGR system.
</span><a id="79"></a><span class="comment">-- @field #PLYRMGR.Settings.Support
</span>SPECTRE.PLYRMGR.Settings.Support = {}

<a id="82"></a><span class="comment">--- Indicates whether CAP (Combat Air Patrol) support is active.
</span>SPECTRE.PLYRMGR.Settings.Support.CAP = <span class="keyword">false</span>

<a id="85"></a><span class="comment">--- Indicates whether TOMAHAWK support is active.
</span>SPECTRE.PLYRMGR.Settings.Support.TOMAHAWK = <span class="keyword">false</span>

<a id="88"></a><span class="comment">--- Indicates whether BOMBER support is active.
</span>SPECTRE.PLYRMGR.Settings.Support.BOMBER = <span class="keyword">false</span>

<a id="91"></a><span class="comment">--- Indicates whether AIRDROP support is active.
</span>SPECTRE.PLYRMGR.Settings.Support.AIRDROP = <span class="keyword">false</span>

<a id="94"></a><span class="comment">--- Indicates whether STRIKE support is active.
</span>SPECTRE.PLYRMGR.Settings.Support.STRIKE = <span class="keyword">false</span>

<span class="comment">--- Create a new player manager instance.
</span><span class="comment">--
</span><span class="comment">-- This function initializes a new player manager instance, inheriting properties from the SPECTRE base class.
</span><span class="comment">-- It also generates a random seed count within specified parameters and iterates through the 'math.random()' function
</span><span class="comment">-- that number of times to ensure varied randomization in subsequent operations.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><a id="104"></a><span class="comment">-- @return #PLYRMGR self The newly created player manager instance.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:New()
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New())
  <span class="comment">-- Generate a nominal random seed count based on defined parameters.
</span>  <span class="keyword">local</span> _randseedCount = SPECTRE.UTILS.generateNominal(self._randSeedNom, self._randSeedMin, self._randSeedMax, self._randSeedNudge)

  <span class="comment">-- Iterate through 'math.random()' to ensure varied randomization.
</span>  <span class="keyword">for</span> _seedC = <span class="number">1</span>, _randseedCount, <span class="number">1</span> <span class="keyword">do</span>
    <span class="global">math</span>.random()
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for CAP custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="120"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_CAP(cost_)
  SPECTRE.REWARDS.Config.PointCost.CAP = cost_
  SPECTRE.MENU.Text.CAP.Cost = <span class="global">string</span>.format(<span class="string">"C.A.P. Cost: %d Points"</span>, cost_)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for TOMAHAWK custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="130"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_TOMAHAWK(cost_)
  SPECTRE.REWARDS.Config.PointCost.TOMAHAWK = cost_
  SPECTRE.MENU.Text.TOMAHAWK.Cost = <span class="global">string</span>.format(<span class="string">"Tomahawk Cost: %d Points"</span>, cost_)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for BOMBER custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="140"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_BOMBER(cost_)
  SPECTRE.REWARDS.Config.PointCost.BOMBER = cost_
  SPECTRE.MENU.Text.BOMBER.Cost = <span class="global">string</span>.format(<span class="string">"Bomber Cost: %d Points"</span>, cost_)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for STRIKE custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="150"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_STRIKE(cost_)
  SPECTRE.REWARDS.Config.PointCost.STRIKE = cost_
  SPECTRE.MENU.Text.STRIKE.Cost = <span class="global">string</span>.format(<span class="string">"Strike Team Cost: %d Points"</span>, cost_)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_ARTILLERY custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="160"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_ARTILLERY(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }

  <span class="keyword">return</span> self
<span class="keyword">end</span>
<span class="comment">--- Sets the point cost for AIRDROP_IFV custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="191"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_IFV(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_TANK custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="222"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_TANK(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_AAA custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="253"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_AAA(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_IRSAM custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="284"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_IRSAM(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_RDRSAM custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="315"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_RDRSAM(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_EWR custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="346"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_EWR(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Sets the point cost for AIRDROP_SUPPLY custom support redemption.
</span><span class="comment">-- @param #PLYRMGR self
</span><span class="comment">-- @param cost_
</span><a id="377"></a><span class="comment">-- @return #PLYRMGR self
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:setPointCost_AIRDROP_SUPPLY(cost_)
  SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY = cost_

  SPECTRE.MENU.Text.Reports.Instructions.AIRDROPCOST = {
    <span class="string">"Airdrop Group {Type} Costs:"</span>,
    <span class="string">"================================"</span>,
    <span class="string">""</span>,
    <span class="string">"Usage: /airdrop artillery"</span>,
    <span class="global">string</span>.format(<span class="string">"Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.ARTILLERY),
    <span class="string">"Usage: /airdrop ifv"</span>,
    <span class="global">string</span>.format(<span class="string">"Infantry Fighting Vehicle Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IFV),
    <span class="string">"Usage: /airdrop tank"</span>,
    <span class="global">string</span>.format(<span class="string">"Tank Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.TANK),
    <span class="string">"Usage: /airdrop aaa"</span>,
    <span class="global">string</span>.format(<span class="string">"Anti-Aircraft Artillery Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.AAA),
    <span class="string">"Usage: /airdrop irsam"</span>,
    <span class="global">string</span>.format(<span class="string">"IR SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.IRSAM),
    <span class="string">"Usage: /airdrop rdrsam"</span>,
    <span class="global">string</span>.format(<span class="string">"Radar SAM Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.RDRSAM),
    <span class="string">"Usage: /airdrop ewr"</span>,
    <span class="global">string</span>.format(<span class="string">"Early Warning Radar Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.EWR),
    <span class="string">"Usage: /airdrop supply"</span>,
    <span class="global">string</span>.format(<span class="string">"Supply Cost: %d Points"</span>, SPECTRE.REWARDS.Config.PointCost.AIRDROP.SUPPLY),
  }
  <span class="keyword">return</span> self
<span class="keyword">end</span>



<span class="comment">--- Init.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Init operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Initialize the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for initializing various subsystems of the player manager instance.
</span><span class="comment">-- It includes initializing the reward system, tracking system, and persistence system.
</span><span class="comment">-- Additionally, it registers an event handler for the event when a player enters an aircraft.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><a id="422"></a><span class="comment">-- @return #PLYRMGR self The initialized player manager instance.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:Init()
  <span class="comment">-- Initialize the reward system.
</span>  self:RewardsInit()

  <span class="comment">-- Initialize the tracking system.
</span>  self:TrackersInit()

  <span class="comment">-- Initialize the persistence system.
</span>  self:PersistanceInit()

  <span class="comment">-- Register the event handler for when a player enters an aircraft.
</span>  self:HandleEvent(EVENTS.PlayerEnterAircraft, self.PlayerEnterAircraft_)

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Initialize the rewards system for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function is tasked with setting up the rewards system within the player manager instance.
</span><span class="comment">-- It checks whether the rewards system is enabled in the settings, and if so, it sets up an event handler
</span><span class="comment">-- that is responsible for rewarding players for kill events. This setup ensures that players receive appropriate
</span><span class="comment">-- rewards for their in-game actions when the rewards system is active.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><a id="447"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after initializing the rewards system.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:RewardsInit()
  <span class="comment">-- Check if the rewards system is enabled in the settings.
</span>  <span class="keyword">if</span> self.Settings.Rewards <span class="keyword">then</span>
    <span class="comment">-- Set up an event handler for rewarding players upon kill events.
</span>    self:HandleEvent(EVENTS.Kill, self.RewardKillEvent_)
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Initialize the persistence system for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function sets up the persistence system within the player manager instance, provided that persistence is enabled in the settings.
</span><span class="comment">-- It begins by importing existing persistence data, detecting any existing units within the mission, and then proceeds to set up
</span><span class="comment">-- event handlers for player actions and mission events that are relevant to maintaining persistence. These event handlers are crucial for
</span><span class="comment">-- tracking and responding to various scenarios, such as players leaving units, crashes, and the end of the mission, ensuring
</span><span class="comment">-- the persistence of game state across sessions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><a id="466"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after initializing the persistence system.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:PersistanceInit()
  <span class="comment">-- Check if the persistence system is enabled in the settings.
</span>  <span class="keyword">if</span> self.Settings.Persistance <span class="keyword">then</span>
    <span class="comment">-- Import persistence data.
</span>    self:ImportData()
    <span class="comment">-- Detect existing units in the mission.
</span>    self:DetectExistingUnits()
    <span class="comment">-- Set up event handlers for player actions and mission events related to persistence.
</span>    self:HandleEvent(EVENTS.PlayerLeaveUnit, self.PlayerLeaveUnit_)
    self:HandleEvent(EVENTS.Crash, self.CrashEvent_)
    self:HandleEvent(EVENTS.MissionEnd, self.EndMission_)
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Initialize the trackers for the SPECTRE.PLYRMGR.Manager instance based on the support settings.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for setting up trackers and event handlers for various types of support.
</span><span class="comment">-- It iterates over all support settings and initializes trackers for each enabled support type. This involves setting up specific marker
</span><span class="comment">-- functions and event handlers to track changes in markers related to each type of support. The function ensures that appropriate tracking
</span><span class="comment">-- mechanisms are in place for the enabled support features, facilitating efficient management and response to in-game events.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after initializing the trackers.
</span><a id="491"></a><span class="comment">-- @usage manager:TrackersInit() -- Initialize trackers based on the manager's support settings.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:TrackersInit()
  <span class="comment">-- Iterate over all support settings
</span>  <span class="keyword">for</span> supportType, isEnabled <span class="keyword">in</span> <span class="global">pairs</span>(self.Settings.Support) <span class="keyword">do</span>
    <span class="comment">-- Initialize tracker if the support type is not "ESCORT" and it is enabled
</span>    <span class="keyword">if</span> isEnabled <span class="keyword">then</span>
      self.TRACKERS[supportType] = {}

      <span class="comment">-- Set the event marker function
</span>      self._EventMarker = self[<span class="string">"_EventMarker"</span>]

      <span class="keyword">local</span> markerSettings = self.MARKERS.Settings[supportType]
      <span class="keyword">if</span> <span class="keyword">not</span> markerSettings.KeyWords <span class="keyword">or</span> #markerSettings.KeyWords == <span class="number">0</span> <span class="keyword">then</span>
        self.MARKERS.TRACKERS[supportType] = MARKEROPS_BASE:New(markerSettings.TagName, markerSettings.CaseSensitive)
      <span class="keyword">else</span>
        self.MARKERS.TRACKERS[supportType] = MARKEROPS_BASE:New(markerSettings.TagName, markerSettings.KeyWords, markerSettings.CaseSensitive)
      <span class="keyword">end</span>

      <span class="comment">-- Set up event handler for changes in markers
</span>      self.MARKERS.TRACKERS[supportType].OnAfterMarkChanged = <span class="keyword">function</span>(From, Event, To, Text, Keywords, Coord)
        <span class="keyword">local</span> origText = Keywords
        <span class="keyword">local</span> sanitizedText = Keywords:gsub(<span class="string">"/"</span>, <span class="string">""</span>):upper()
        <span class="keyword">local</span> MarkerInfo = {}
        <span class="keyword">for</span> word <span class="keyword">in</span> sanitizedText:gmatch(<span class="string">"%w+"</span>) <span class="keyword">do</span> <span class="global">table</span>.insert(MarkerInfo, word) <span class="keyword">end</span>

        <span class="keyword">local</span> Packet = {
          From = From,
          Event = Event,
          To = To,
          Text = Text,
          origText = origText,
          sanitizedText = sanitizedText,
          MarkerType = MarkerInfo,
          Keywords = Keywords,
          Coord = Coord,
        }
        self  = self._EventMarker(self, Packet)
        <span class="keyword">return</span> self
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Schedulers.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Schedulers operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Schedule a resource restock for a given coalition and type.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for scheduling the restocking of resources. It handles both general resource types and
</span><span class="comment">-- specific types related to airdrops. Based on the coalition number and resource type, it updates resource counters and
</span><span class="comment">-- notifies the appropriate coalition about the restock. It includes a timer to handle the restocking process after a specified delay.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The instance of the player manager.
</span><span class="comment">-- @param coal Coalition number (2 for Blue, otherwise Red).
</span><span class="comment">-- @param type The general resource type.
</span><span class="comment">-- @param AIRDROPTYPE The specific type for airdrops (optional).
</span><a id="553"></a><span class="comment">-- @return #PLYRMGR self The updated player manager instance after scheduling the restock.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:scheduleRestock(coal, <span class="global">type</span>, AIRDROPTYPE)
  <span class="comment">-- Determine the coalition name based on the given number.
</span>  <span class="keyword">local</span> coal_ = (coal == <span class="number">2</span>) <span class="keyword">and</span> <span class="string">"Blue"</span> <span class="keyword">or</span> <span class="string">"Red"</span>

  <span class="comment">-- Create a timer to handle the restock.
</span>  <span class="keyword">local</span> restockTimer = TIMER:New(<span class="keyword">function</span>()
    <span class="keyword">local</span> report
    <span class="keyword">if</span> <span class="keyword">not</span> AIRDROPTYPE <span class="keyword">then</span>
      <span class="comment">-- Update resource counters for general types.
</span>      self.RESOURCES[<span class="global">type</span>][coal_] = self.RESOURCES[<span class="global">type</span>][coal_] + <span class="number">1</span>
      self.COUNTERS.RESTOCK[<span class="global">type</span>][coal_] = self.COUNTERS.RESTOCK[<span class="global">type</span>][coal_] - <span class="number">1</span>
      report = REPORT:New(<span class="string">"A new custom "</span> .. <span class="global">type</span> .. <span class="string">" is available for tasking."</span>)
      report:AddIndent(<span class="string">"Total "</span> .. <span class="global">type</span> .. <span class="string">" Resources available: "</span> .. self.RESOURCES[<span class="global">type</span>][coal_], <span class="string">"-"</span>)
    <span class="keyword">else</span>
      <span class="comment">-- Update resource counters for specific airdrop types.
</span>      self.RESOURCES[<span class="global">type</span>][AIRDROPTYPE][coal_] = self.RESOURCES[<span class="global">type</span>][AIRDROPTYPE][coal_] + <span class="number">1</span>
      self.COUNTERS.RESTOCK[<span class="global">type</span>][AIRDROPTYPE][coal_] = self.COUNTERS.RESTOCK[<span class="global">type</span>][AIRDROPTYPE][coal_] - <span class="number">1</span>
      report = REPORT:New(<span class="string">"New "</span> .. AIRDROPTYPE .. <span class="string">" group is available for airdrop."</span>)
      report:AddIndent(<span class="string">"Total "</span> .. AIRDROPTYPE .. <span class="string">" Resources available: "</span> .. self.RESOURCES[<span class="global">type</span>][AIRDROPTYPE][coal_], <span class="string">"-"</span>)
    <span class="keyword">end</span>
    <span class="comment">-- Notify the coalition about the restock.
</span>    trigger.action.outTextForCoalition(coal, report:Text(), <span class="number">10</span> )
  <span class="keyword">end</span>)

  <span class="comment">-- Update the restock counter immediately.
</span>  <span class="keyword">if</span> <span class="keyword">not</span> AIRDROPTYPE <span class="keyword">then</span>
    self.COUNTERS.RESTOCK[<span class="global">type</span>][coal_] = self.COUNTERS.RESTOCK[<span class="global">type</span>][coal_] + <span class="number">1</span>
  <span class="keyword">else</span>
    self.COUNTERS.RESTOCK[<span class="global">type</span>][AIRDROPTYPE][coal_] = self.COUNTERS.RESTOCK[<span class="global">type</span>][AIRDROPTYPE][coal_] + <span class="number">1</span>
  <span class="keyword">end</span>

  <span class="comment">-- Start the restock timer (after a 30-second delay).
</span>  restockTimer:Start(<span class="number">30</span>)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Persistence.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Persistence operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Import resource data for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for importing resource data into the player manager instance.
</span><span class="comment">-- It achieves this by calling the Import method on the RESOURCES member of the player manager,
</span><span class="comment">-- effectively loading and integrating resource data into the manager's operational context.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><a id="605"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after importing the resource data.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:ImportData()
  <span class="comment">-- Call the Import method on the RESOURCES member to load the resource data.
</span>  self.RESOURCES:Import()
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Enable Toggles.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Enable Toggles.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Enable or disable all support settings for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for toggling the status of all support settings within the player manager instance.
</span><span class="comment">-- It sets the value of each support setting based on the provided 'enabled' parameter. If no value is given,
</span><span class="comment">-- it defaults to enabling all support settings ('true'). This function allows for a comprehensive and quick
</span><span class="comment">-- adjustment of all support settings in a single call, either enabling or disabling them as required.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance for which support settings are to be adjusted.
</span><span class="comment">-- @param enabled A boolean value (true or false) to enable or disable all support settings respectively. Defaults to true if not specified.
</span><a id="629"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after adjusting the support settings.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:enableSupport_All(enabled)
  <span class="comment">-- Default to true if no value is provided.
</span>  enabled = enabled <span class="keyword">or</span> <span class="keyword">true</span>

  <span class="comment">-- Iterate over all support settings and set their value based on the 'enabled' parameter.
</span>  <span class="keyword">for</span> key <span class="keyword">in</span> <span class="global">pairs</span>(self.Settings.Support) <span class="keyword">do</span>
    self.Settings.Support[key] = enabled
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Enable or disable a specific support setting for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function is used to adjust a specific support setting within the player manager instance.
</span><span class="comment">-- It allows for enabling or disabling an individual support setting, identified by the 'type' parameter,
</span><span class="comment">-- based on the provided 'enabled' parameter. If no value for 'enabled' is given, the function defaults to enabling
</span><span class="comment">-- the support setting ('true'). This targeted approach enables fine-grained control over each distinct support setting.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance for which the support setting is to be adjusted.
</span><span class="comment">-- @param type The specific support setting under SPECTRE.PLYRMGR.Settings.Support to be modified.
</span><span class="comment">-- @param enabled A boolean value (true or false) to enable or disable the specified support setting. Defaults to true if not specified.
</span><a id="652"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after adjusting the specified support setting.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:enableSupport(<span class="global">type</span>, enabled)
  <span class="comment">-- Default to true if no value is provided.
</span>  enabled = enabled <span class="keyword">or</span> <span class="keyword">true</span>

  <span class="comment">-- Set the specific support setting based on the 'enabled' parameter.
</span>  self.Settings.Support[<span class="global">type</span>] = enabled

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Enable or disable the rewards system for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function controls the activation status of the rewards system within the player manager instance.
</span><span class="comment">-- It sets the rewards setting to either enabled or disabled based on the provided 'enabled' parameter.
</span><span class="comment">-- If no value is given, the function defaults to enabling the rewards system ('true'). This allows for easy
</span><span class="comment">-- toggling of the rewards system, facilitating gameplay customization according to player or scenario requirements.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance for which the rewards system is to be toggled.
</span><span class="comment">-- @param enabled A boolean value (true or false) to enable or disable the rewards system respectively. Defaults to true if not specified.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after toggling the rewards system.
</span><span class="comment">-- @usage manager:enableRewards() -- Enable the rewards system.
</span><a id="674"></a><span class="comment">-- @usage manager:enableRewards(false) -- Disable the rewards system.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:enableRewards(enabled)
  <span class="comment">-- Default to true if no value is provided.
</span>  enabled = enabled <span class="keyword">or</span> <span class="keyword">true</span>

  <span class="comment">-- Set the rewards setting based on the 'enabled' parameter.
</span>  self.Settings.Rewards = enabled

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Enable or disable the persistence system for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function is used to toggle the persistence system of the player manager instance.
</span><span class="comment">-- It adjusts the persistence setting to either enable or disable it, based on the value provided in the 'enabled' parameter.
</span><span class="comment">-- In the absence of a provided value, the function defaults to enabling the persistence system ('true').
</span><span class="comment">-- This toggle capability allows for flexible management of game state persistence, adapting to different gameplay needs or scenarios.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance for which the persistence system is to be toggled.
</span><span class="comment">-- @param enabled A boolean value (true or false) to enable or disable the persistence system respectively. Defaults to true if not specified.
</span><a id="694"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after toggling the persistence system.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:enablePersistance(enabled)
  <span class="comment">-- Default to true if no value is provided.
</span>  enabled = enabled <span class="keyword">or</span> <span class="keyword">true</span>

  <span class="comment">-- Set the persistence setting based on the 'enabled' parameter.
</span>  self.Settings.Persistance = enabled

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Check if any support settings are enabled for the SPECTRE.PLYRMGR instance.
</span><span class="comment">--
</span><span class="comment">-- This function examines the support settings of the player manager instance and determines if any of them are currently enabled.
</span><span class="comment">-- It iterates over all the support settings and returns true as soon as it finds an enabled setting. If none of the settings are enabled,
</span><span class="comment">-- the function will return false. This is useful for quickly ascertaining the overall status of support systems within the game environment.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><a id="712"></a><span class="comment">-- @return #boolean True if any support setting is enabled, otherwise false.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:anySupportOn()
  <span class="comment">-- Iterate over all support settings.
</span>  <span class="keyword">for</span> _, supportEnabled <span class="keyword">in</span> <span class="global">pairs</span>(self.Settings.Support) <span class="keyword">do</span>
    <span class="comment">-- If any support setting is enabled, return true.
</span>    <span class="keyword">if</span> supportEnabled <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">true</span> <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="comment">-- If no support setting is enabled, return false.
</span>  <span class="keyword">return</span> <span class="keyword">false</span>
<span class="keyword">end</span>

<span class="comment">--- Marker OPs.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Markers operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>

<span class="comment">--- Process marker events and take actions based on the marker type.
</span><span class="comment">--
</span><span class="comment">-- This function is designed to interpret and respond to marker events. It analyzes the marker type and descriptor,
</span><span class="comment">-- sets up new markers, and modifies player menus based on the marker's intent. The function handles different marker
</span><span class="comment">-- types, such as CAP, TOMAHAWK, BOMBER, STRIKE, and AIRDROP, executing specific actions for each. It ensures that marker
</span><span class="comment">-- events are processed correctly, facilitating dynamic in-game interactions based on player inputs.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance processing the marker event.
</span><span class="comment">-- @param Packet Information about the marker event, including type and other relevant data.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after processing the marker event.
</span><a id="743"></a><span class="comment">-- @usage manager:_EventMarker(packetData) -- Process the marker event based on the provided packet data.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:_EventMarker(Packet)
  <span class="keyword">local</span> _,_,heading, distance, code,MarkInfo,NewMarkerCoord,PlayerUCID,descriptor,newMarkerText,newMarkerID
  <span class="comment">--local _tCode = SPECTRE.COUNTERS
</span>  code = SPECTRE.COUNTER<span class="comment">--self.COUNTERS.CodeMarker -- Incrementing CodeMarker counter
</span>  <span class="comment">--self.COUNTERS.CodeMarker = self.COUNTERS.CodeMarker + 5
</span>  SPECTRE.COUNTER = SPECTRE.COUNTER + <span class="number">1</span>
  <span class="comment">--  local _,_,heading, distance, code,MarkInfo,NewMarkerCoord,PlayerUCID,descriptor,newMarkerText,newMarkerID
</span>  <span class="comment">--  local _tCode = SPECTRE.COUNTERS
</span>  <span class="comment">--  code = _tCode--self.COUNTERS.CodeMarker -- Incrementing CodeMarker counter
</span>  <span class="comment">--  --self.COUNTERS.CodeMarker = self.COUNTERS.CodeMarker + 5
</span>  <span class="comment">--  SPECTRE.COUNTERS = code + 1
</span>  MarkInfo = SPECTRE.MARKERS.World.FindByText(Packet.origText) <span class="comment">-- Finding mark info using Text
</span>  NewMarkerCoord = COORDINATE:New(MarkInfo.pos.x,MarkInfo.pos.y,MarkInfo.pos.z) <span class="comment">-- Creating a new coordinate object
</span>  PlayerUCID = SPECTRE.UTILS.GetPlayerInfo(MarkInfo.author, <span class="string">"ucid"</span>) <span class="comment">-- Fetching the unique ID of the player who changed the mark
</span>
  <span class="keyword">local</span> markerType = Packet.MarkerType[<span class="number">1</span>]


  <span class="keyword">if</span> markerType == <span class="string">"CAP"</span> <span class="keyword">then</span>
    heading = Packet.MarkerType[<span class="number">2</span>] <span class="keyword">or</span> <span class="keyword">nil</span>
    distance = Packet.MarkerType[<span class="number">3</span>] <span class="keyword">or</span> <span class="keyword">nil</span>
    descriptor = heading <span class="keyword">and</span> <span class="global">string</span>.format(<span class="string">"- Racetrack %03d for %d"</span>, heading, distance) <span class="keyword">or</span> <span class="string">"- Circular Orbit"</span>
  <span class="keyword">end</span>

  <span class="keyword">if</span> markerType == <span class="string">"TOMAHAWK"</span> <span class="keyword">then</span>
    descriptor =  <span class="string">"- Tomahawk Strike"</span>
  <span class="keyword">end</span>

  <span class="keyword">if</span> markerType == <span class="string">"BOMBER"</span> <span class="keyword">then</span>
    descriptor =  <span class="string">"- B-52 Carpet Bomb"</span>
  <span class="keyword">end</span>

  <span class="keyword">if</span> markerType == <span class="string">"STRIKE"</span> <span class="keyword">then</span>
    descriptor =  <span class="string">"- Strike Team"</span>
  <span class="keyword">end</span>

  <span class="keyword">if</span> markerType == <span class="string">"AIRDROP"</span> <span class="keyword">then</span>
    <span class="keyword">local</span> dropType = Packet.MarkerType[<span class="number">2</span>]
    <span class="keyword">if</span> dropType <span class="keyword">and</span> self.MARKERS.Settings.AIRDROP.Types[dropType] <span class="keyword">then</span>
      descriptor = <span class="string">"- Airdrop "</span> .. dropType .. <span class="string">" group."</span>
    <span class="keyword">else</span>
      trigger.action.outTextForGroup( self.Players[PlayerUCID].GroupID, <span class="string">"Invalid airdrop type request. Please check you are using the correct format."</span> ,<span class="number">15</span>)
    <span class="keyword">end</span>
    <span class="comment">-- Handle invalid airdrop type
</span>    SPECTRE.MARKERS.World.RemoveByID(MarkInfo.idx)
  <span class="keyword">end</span>


  <span class="keyword">if</span> <span class="keyword">not</span> descriptor <span class="keyword">then</span> <span class="keyword">return</span> self <span class="keyword">end</span> <span class="comment">-- Exit if descriptor is not found
</span>
  newMarkerText = <span class="string">"ID: "</span> .. markerType .. code .. <span class="string">" "</span> .. descriptor
  newMarkerID = NewMarkerCoord:MarkToGroup(newMarkerText,self.Players[PlayerUCID].GROUP,<span class="keyword">true</span>) <span class="comment">-- Create a new marker on the map
</span>
  <span class="keyword">local</span> MarkerTable = {
    Packet = Packet,
    descriptor = descriptor,
    newMarkerText = newMarkerText,
    code = code,
    MarkInfo = MarkInfo,
    PermMarkerID = newMarkerID,
    MarkCoords = NewMarkerCoord,
    heading = heading <span class="keyword">and</span> <span class="global">tonumber</span>(heading),
    distance = distance <span class="keyword">and</span> <span class="global">tonumber</span>(distance)
  }

  self:AddMarkerToPlayer(PlayerUCID, MarkerTable) <span class="comment">--Add new mark to player table
</span>  SPECTRE.MARKERS.World.RemoveByID(MarkInfo.idx) <span class="comment">-- Remove the old mark
</span>  self.Players[PlayerUCID].Markers[markerType].MenuArrays.Main:RemoveSubMenus() <span class="comment">-- Remove the support menu for TYPE operations
</span>  self.Players[PlayerUCID]:setupSubMenu(markerType, self) <span class="comment">-- Build the support menu for TYPE operations
</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Events.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Events operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Event handler for the "Kill" event.
</span><span class="comment">--
</span><span class="comment">-- This function serves as an event handler for the "Kill" event within the player manager system. When a kill event is triggered,
</span><span class="comment">-- it identifies the player responsible for the event and awards them points based on the specifics of the event. The function
</span><span class="comment">-- ensures that players are appropriately rewarded for their in-game achievements, reinforcing game dynamics and player engagement.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance handling the "Kill" event.
</span><span class="comment">-- @param eventData Data associated with the "Kill" event, including information about the initiator and the event details.
</span><a id="833"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after processing the "Kill" event.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:RewardKillEvent_(eventData)
  <span class="comment">-- Fetch the unique ID of the player who initiated the event
</span>  <span class="keyword">local</span> PlayerUCID = SPECTRE.UTILS.GetPlayerInfo(eventData.IniPlayerName, <span class="string">"ucid"</span>)

  <span class="comment">-- If the event initiator is a player, disperse points based on the event data
</span>  <span class="keyword">if</span> PlayerUCID <span class="keyword">and</span> self.Players[PlayerUCID] <span class="keyword">then</span>
    <span class="keyword">local</span> pointsAwarded = SPECTRE.REWARDS.DispersePoints(eventData)
    self.Players[PlayerUCID]:UpdatePoints(pointsAwarded)
  <span class="keyword">end</span>

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Event handler for the "End Mission" event.
</span><span class="comment">--
</span><span class="comment">-- This function acts as an event handler for the "End Mission" event in the player manager system.
</span><span class="comment">-- It is triggered at the conclusion of a mission and is responsible for collating end-of-mission resources and storing ground resource data.
</span><span class="comment">-- The function ensures that essential data related to mission resources is accurately compiled and saved, providing continuity and
</span><span class="comment">-- consistency in resource management across game sessions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance handling the "End Mission" event.
</span><span class="comment">-- @param eventData Data associated with the "End Mission" event, typically including mission-closure details.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after handling the "End Mission" event.
</span><a id="857"></a><span class="comment">-- @usage manager:EndMission_(eventData) -- Handle the "End Mission" event and perform end-of-mission tasks.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:EndMission_(eventData)
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.PLYRMGR:EndMission_ | eventData"</span> , eventData)
  <span class="comment">-- Collate end-of-mission resources
</span>  self:EndMizResourceCollate()

  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.PLYRMGR:EndMission_ | self.RESOURCES.AIRDROP"</span> , self.RESOURCES.AIRDROP)
  <span class="comment">-- Store the ground resource data
</span>  SPECTRE.IO.PersistenceToFile(SPECTRE._persistenceLocations.PLYRMGR.path .. <span class="string">"SupportResources/GroundResources.lua"</span>, self.RESOURCES.AIRDROP, <span class="keyword">true</span>)
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Event handler for the "PlayerEnterAircraft" event.
</span><span class="comment">--
</span><span class="comment">-- This function is an event handler that activates when a player enters an aircraft. It is responsible for setting up the player's data
</span><span class="comment">-- within the manager's system, sending a welcome message to the player, and initializing the support menu if any support options are enabled.
</span><span class="comment">-- The function ensures that players are properly integrated into the game's management system upon entering an aircraft, providing necessary
</span><span class="comment">-- information and options for an enhanced gameplay experience.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance handling the "PlayerEnterAircraft" event.
</span><span class="comment">-- @param eventData Data associated with the "PlayerEnterAircraft" event, including the player's details.
</span><a id="878"></a><span class="comment">-- @return #PLYRMGR self The player manager instance after handling the "PlayerEnterAircraft" event.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:PlayerEnterAircraft_(eventData)
<span class="keyword">if</span> eventData.IniPlayerName ~= <span class="keyword">nil</span> <span class="keyword">then</span>
  <span class="comment">-- Retrieve the player's information using their name from the event data
</span>  <span class="keyword">local</span> PlayerInfo = SPECTRE.UTILS.GetPlayerInfo(eventData.IniPlayerName)
  <span class="keyword">local</span> PlayerUCID = PlayerInfo.ucid

  <span class="comment">-- If the player doesn't already exist in the manager's player table, create a new entry for them
</span>  <span class="keyword">if</span> <span class="keyword">not</span> self.Players[PlayerUCID] <span class="keyword">then</span>
    self.Players[PlayerUCID] = self.Player:New(PlayerInfo, self):ImportData()
  <span class="keyword">end</span>

  <span class="comment">-- Update the player's slot data and send them a welcome message
</span>  self.Players[PlayerUCID]:SlotDataUpdate(eventData)
  self.Players[PlayerUCID]:WelcomeMessage()

  <span class="comment">-- If any support options are enabled, set up the support menu for the player
</span>  <span class="keyword">if</span> self:anySupportOn() <span class="keyword">then</span>
    self.Players[PlayerUCID]:setupMenu(self)
  <span class="keyword">end</span>
<span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Event handler for the "PlayerLeaveUnit" event.
</span><span class="comment">--
</span><span class="comment">-- This function serves as an event handler for situations where a player leaves a unit in the game. It performs necessary actions
</span><span class="comment">-- such as storing the player's data and clearing any world markers associated with that player. This ensures that the player's
</span><span class="comment">-- game state is properly managed and updated when they exit a unit, maintaining the integrity and continuity of the gameplay experience.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance handling the "PlayerLeaveUnit" event.
</span><span class="comment">-- @param eventData Data associated with the "PlayerLeaveUnit" event, including the player's details.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after handling the "PlayerLeaveUnit" event.
</span><a id="911"></a><span class="comment">-- @usage manager:PlayerLeaveUnit_(eventData) -- Handle the "PlayerLeaveUnit" event and perform necessary actions.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:PlayerLeaveUnit_(eventData)
  <span class="comment">-- If the event has a player initiator
</span>  <span class="keyword">if</span> eventData.IniPlayerName ~= <span class="keyword">nil</span> <span class="keyword">then</span>
    <span class="comment">-- Retrieve the player's information using their name from the event data
</span>    <span class="keyword">local</span> PlayerInfo = SPECTRE.UTILS.GetPlayerInfo(eventData.IniPlayerName)
    <span class="keyword">local</span> PlayerUCID = PlayerInfo.ucid

    <span class="comment">-- If the player exists in the manager's player table
</span>    <span class="keyword">if</span>  self.Players[PlayerUCID] <span class="keyword">then</span>
      <span class="comment">-- Store the player's data, clear their world markers, and then remove them from the manager's player table
</span>      self.Players[PlayerUCID]:StoreData()
      self.Players[PlayerUCID]:ClearWorldMarkers(<span class="number">0</span>)
      self.Players[PlayerUCID] = <span class="keyword">nil</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Event handler for the "Crash" event.
</span><span class="comment">--
</span><span class="comment">-- This function acts as an event handler for crash events within the game. It specifically handles cases where the initiator of the crash
</span><span class="comment">-- is a player. In such instances, the function stores the player's data to ensure that any relevant game state or progress is recorded
</span><span class="comment">-- accurately. This mechanism is crucial for maintaining a consistent and fair gameplay experience, especially in scenarios involving
</span><span class="comment">-- unintended or accidental crashes.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance handling the "Crash" event.
</span><span class="comment">-- @param eventData Data associated with the "Crash" event, including the player's details if they initiated the crash.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after processing the "Crash" event.
</span><a id="940"></a><span class="comment">-- @usage manager:CrashEvent_(eventData) -- Handle the "Crash" event and store the player's data if necessary.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:CrashEvent_(eventData)
  <span class="comment">-- If the event has a player initiator
</span>  <span class="keyword">if</span> eventData.IniPlayerName ~= <span class="keyword">nil</span> <span class="keyword">then</span>
    <span class="comment">-- Retrieve the player's information using their name from the event data
</span>    <span class="keyword">local</span> PlayerInfo = SPECTRE.UTILS.GetPlayerInfo(eventData.IniPlayerName)
    <span class="keyword">local</span> PlayerUCID = PlayerInfo.ucid

    <span class="comment">-- If the player exists in the manager's player table, store their data
</span>    <span class="keyword">if</span>  self.Players[PlayerUCID] <span class="keyword">then</span>
      self.Players[PlayerUCID]:StoreData()
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Internal.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">--  Not meant to be used, but can be.
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Internal operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Collate resources at the end of a mission.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for updating the resource counts at the conclusion of a mission. It goes through each support type and
</span><span class="comment">-- tallies the remaining stock, adjusting the resource counts accordingly. The function handles different support types, including
</span><span class="comment">-- special handling for AIRDROP types, ensuring that the resource data accurately reflects the state of resources at mission's end.
</span><span class="comment">-- This is crucial for maintaining consistency and accuracy in resource tracking across game sessions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after updating resource counts.
</span><a id="975"></a><span class="comment">-- @usage manager:EndMizResourceCollate() -- Update resource counts at the end of the mission.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:EndMizResourceCollate()
  SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.PLYRMGR:EndMizResourceCollate | ----------------"</span>, self )
  <span class="comment">-- Iterate over all support settings
</span>  <span class="keyword">for</span> supportType, isEnabled <span class="keyword">in</span> <span class="global">pairs</span>(self.Settings.Support) <span class="keyword">do</span>
    SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.PLYRMGR:EndMizResourceCollate | supportType: "</span> .. supportType .. <span class="string">" | enabled: "</span> .. <span class="global">tostring</span>(isEnabled))
    <span class="keyword">if</span> isEnabled <span class="keyword">then</span>
      <span class="comment">-- If the support type is not AIRDROP, update the Red and Blue resources directly
</span>      <span class="keyword">if</span> supportType ~= <span class="string">"AIRDROP"</span> <span class="keyword">then</span>

<span class="comment">--        self.RESOURCES[supportType].Red = self.RESOURCES[supportType].Red + self.COUNTERS.RESTOCK[supportType].Red
</span><span class="comment">--        self.RESOURCES[supportType].Blue = self.RESOURCES[supportType].Blue + self.COUNTERS.RESTOCK[supportType].Blue
</span>      <span class="keyword">else</span>
        SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.PLYRMGR:EndMizResourceCollate | AIRDROP.Types: "</span> , self.MARKERS.Settings.AIRDROP.Types)
        <span class="comment">-- If the support type is AIRDROP, iterate over the airdrop types and update their counts
</span>        <span class="keyword">for</span> airdropType, _ <span class="keyword">in</span> <span class="global">pairs</span>(self.MARKERS.Settings.AIRDROP.Types) <span class="keyword">do</span>
          SPECTRE.UTILS.debugInfo(<span class="string">"SPECTRE.PLYRMGR:EndMizResourceCollate | airdropType: "</span> .. airdropType)
          self.RESOURCES[supportType][airdropType].Blue = self.RESOURCES[supportType][airdropType].Blue + self.COUNTERS.RESTOCK[supportType][airdropType].Blue
          self.RESOURCES[supportType][airdropType].Red = self.RESOURCES[supportType][airdropType].Red + self.COUNTERS.RESTOCK[supportType][airdropType].Red
        <span class="keyword">end</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Detect existing ground units and set up event handlers for them based on their types.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for identifying existing ground units within the game and setting up appropriate event handlers for each.
</span><span class="comment">-- It first constructs a list of filter prefixes based on airdrop type settings. Then, it iterates over ground units that match these prefixes,
</span><span class="comment">-- processing each unit by setting up event handlers that are tailored to their specific airdrop types. This function ensures that existing
</span><span class="comment">-- ground units are integrated into the game's event handling system, allowing for responsive and dynamic gameplay interactions based on unit types.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after detecting and setting up event handlers for existing units.
</span><a id="1010"></a><span class="comment">-- @usage manager:DetectExistingUnits() -- Detect existing units and set up their event handlers.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:DetectExistingUnits()
  <span class="comment">-- Construct the list of filter prefixes based on the provided airdrop type settings
</span>  <span class="keyword">local</span> filterprefixes = {}
  <span class="keyword">for</span> _, airdropType <span class="keyword">in</span> <span class="global">pairs</span>(SPECTRE.MENU.Settings.AIRDROP.Types) <span class="keyword">do</span>
    <span class="keyword">local</span> prefix = airdropType.AliasPrefix:sub(<span class="number">1</span>, -<span class="number">3</span>)
    <span class="global">table</span>.insert(filterprefixes, prefix)
  <span class="keyword">end</span>

  <span class="comment">-- Helper function to process each group of ground units
</span>  <span class="keyword">local</span> <span class="keyword">function</span> processGroup(GroupObject, Manager)
    <span class="keyword">local</span> groupname = GroupObject:GetName()
    <span class="keyword">local</span> split_str = {}

    <span class="comment">-- Split the group name based on underscores
</span>    <span class="keyword">for</span> word <span class="keyword">in</span> <span class="global">string</span>.gmatch(groupname, <span class="string">'([^_]+)'</span>) <span class="keyword">do</span>
      <span class="global">table</span>.insert(split_str, word)
    <span class="keyword">end</span>

    <span class="keyword">local</span> Packet = {
      Type = <span class="string">"AIRDROP"</span>,
      subtype_ = split_str[<span class="number">1</span>]
    }

    <span class="keyword">local</span> messageOnDead = Packet.subtype_ .. <span class="string">" group destroyed! Prepping new assets."</span>
    <span class="comment">-- Set event handlers for the group based on its airdrop type
</span>    GroupObject = SPECTRE.AI.setAirdropEventHandlers(GroupObject, Manager, Packet, messageOnDead)
  <span class="keyword">end</span>

  <span class="comment">-- Create a set of existing ground units that match the filter prefixes and process each of them
</span>  <span class="keyword">local</span> GroundUnitsSet = SET_GROUP:New():FilterCategoryGround():FilterPrefixes(filterprefixes):FilterOnce()
  GroundUnitsSet:ForEachGroup(processGroup, self)

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Client.
</span><span class="comment">-- ===
</span><span class="comment">--
</span><span class="comment">-- *All Functions associated with Client operations.*
</span><span class="comment">--
</span><span class="comment">-- ===
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span>
<span class="comment">--- Set up the player table.
</span><span class="comment">--
</span><span class="comment">-- This function is tasked with initializing a player table within the player manager system.
</span><span class="comment">-- It uses the provided player information and event data to create and set up a new player object.
</span><span class="comment">-- This includes updating the player's slot data and integrating the player into the manager's system,
</span><span class="comment">-- thereby ensuring that the player's details are accurately recorded and managed within the game's context.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance responsible for setting up the player table.
</span><span class="comment">-- @param eventData Data associated with the relevant event, used for updating player slot data.
</span><span class="comment">-- @param PlayerInfo Attribute table containing the player's details, such as unique ID.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after setting up the player table.
</span><a id="1065"></a><span class="comment">-- @usage manager:SetupPlayerTable(eventData, PlayerInfo) -- Initialize the player table using the provided player information and event data.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:SetupPlayerTable(eventData, PlayerInfo)
  <span class="comment">-- Retrieve the player's unique ID from the provided player information
</span>  <span class="keyword">local</span> PlayerUCID = PlayerInfo[<span class="string">"ucid"</span>]

  <span class="comment">-- Create a new player object, update its slot data, and assign it to the manager's player table
</span>  <span class="keyword">local</span> PlayerObject = self.Player:New(PlayerInfo, self):SlotDataUpdate(eventData)
  self.Players[PlayerUCID] = PlayerObject

  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- Adds a marker to the appropriate player's marker table based on the marker type.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for categorizing and assigning markers to players based on the operation type, such as CAP, Bomber, etc.
</span><span class="comment">-- It takes the marker details and integrates them into the player's data, ensuring that the markers are properly managed and accessible
</span><span class="comment">-- within the context of each player's ongoing operations. The function also enforces a limit on the number of markers a player can have
</span><span class="comment">-- for a specific type, maintaining an organized and manageable marker system.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR self The player manager instance responsible for adding markers to a player's data.
</span><span class="comment">-- @param PlayerUCID The unique identifier for the player.
</span><span class="comment">-- @param MarkerTable Table containing details about the marker, including its type and other relevant information.
</span><span class="comment">-- @return #PLYRMGR self The player manager instance after adding the marker to the player's data.
</span><a id="1088"></a><span class="comment">-- @usage manager:AddMarkerToPlayer(PlayerUCID, MarkerTable) -- Assigns a marker to the appropriate table for the specified player.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR:AddMarkerToPlayer(PlayerUCID, MarkerTable)
  <span class="comment">-- Extract the type of the marker from the MarkerTable's Packet data
</span>  <span class="keyword">local</span> <span class="global">type</span> = MarkerTable.Packet.MarkerType[<span class="number">1</span>]

  <span class="comment">-- Add the marker to the player's marker table based on its type
</span>  <span class="keyword">local</span> playerMarkers = self.Players[PlayerUCID].Markers[<span class="global">type</span>].MarkerArrays
  playerMarkers[#playerMarkers + <span class="number">1</span>] = MarkerTable

  <span class="comment">-- Limit the number of markers for the player to a maximum of 5
</span>  self.Players[PlayerUCID]:LimitMaxMarkers(<span class="global">type</span>, <span class="number">5</span>)
<span class="keyword">end</span>

<span class="comment">---SPAWNER.
</span><span class="comment">--
</span><span class="comment">-- This section defines the SPAWNER field within the PLYRMGR namespace.
</span><span class="comment">-- The SPAWNER table is utilized for managing and controlling various spawning functionalities within the SPECTRE.PLYRMGR system.
</span><span class="comment">-- It plays a critical role in dynamically creating or manipulating game entities as per the game logic or player interactions.
</span><span class="comment">--
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.SPAWNER
</span>SPECTRE.PLYRMGR.SPAWNER = {}

<span class="comment">--- Spawn a Combat Air Patrol (CAP) based on a player's marker and index.
</span><span class="comment">--
</span><span class="comment">-- This function is designed to spawn a Combat Air Patrol (CAP) unit in response to a player's action.
</span><span class="comment">-- It utilizes the details provided in the player's marker to determine the patrol path and spawn configuration.
</span><span class="comment">-- The function pre-calculates various flight parameters and then proceeds to spawn the CAP unit, ensuring that it
</span><span class="comment">-- follows the intended route and behavior as per the game scenario. This is crucial for dynamic and responsive gameplay
</span><span class="comment">-- where player inputs directly influence in-game events and actions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.SPAWNER self The spawner instance from the player manager system.
</span><span class="comment">-- @param #PLYRMGR.Player Player The player who is executing the CAP operation.
</span><span class="comment">-- @param MarkerIndex The index of the player's marker, used to extract coordinates and relevant information for the CAP.
</span><span class="comment">-- @return spawnGroup The spawned group of the CAP, fully configured and initiated.
</span><a id="1123"></a><span class="comment">-- @usage spawner:CAP(Player, MarkerIndex) -- Spawns a CAP based on the specified player's marker and index.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.SPAWNER:CAP(Player, MarkerIndex)
  <span class="comment">-- Build the packet for the CAP using player information and marker index
</span>  <span class="keyword">local</span> Packet = SPECTRE.AI.buildPacket.CAP(Player, MarkerIndex)

  <span class="comment">-- Set up the spawn configuration for the CAP
</span>  <span class="keyword">local</span> spawnGroup = SPAWN:NewWithAlias(Packet.alias_, <span class="global">string</span>.format(SPECTRE.MENU.Settings.CAP.AliasPrefix, Packet.code))
    :InitCoalition(Packet.coal_)
    :InitCountry(Packet.country_)
    :InitCleanUp(<span class="number">120</span>)
    :InitSkill(<span class="string">"Excellent"</span>)
    :OnSpawnGroup(
      <span class="keyword">function</span>(spawnGroup_, MANAGER)
        <span class="comment">-- Build the CAP route using the spawn group and packet details
</span>        <span class="keyword">local</span> route = SPECTRE.AI.buildRoute.CAP(spawnGroup_, Packet)
        <span class="comment">-- Configure the spawn group for the CAP
</span>        spawnGroup_ = SPECTRE.AI.configureGroup.CAP(MANAGER, spawnGroup_, route, Packet)
      <span class="keyword">end</span>, self)

  <span class="comment">-- Set the initial heading of the spawn group towards the racetrack's start position
</span>  spawnGroup:InitHeading(Packet.spawnCoord:HeadingTo(Packet.RacetrackStart))

  <span class="comment">-- Spawn the CAP group at the specified coordinates
</span>  spawnGroup:SpawnFromVec3(Packet.spawnCoord:GetVec3())

  <span class="keyword">return</span> spawnGroup
<span class="keyword">end</span>

<span class="comment">--- Spawn a Tomahawk missile strike based on a player's marker and index.
</span><span class="comment">--
</span><span class="comment">-- This function orchestrates the spawning of a Tomahawk missile strike in response to a player's command.
</span><span class="comment">-- It interprets the details from the player's marker to direct a designated group
</span><span class="comment">-- to fire at multiple targets around the marker's coordinates. This function enhances the strategic elements of gameplay,
</span><span class="comment">-- allowing players to execute precise missile strikes based on their tactical decisions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.SPAWNER self The spawner instance from the player manager system.
</span><span class="comment">-- @param #PLYRMGR.Player Player The player who is executing the Tomahawk missile strike operation.
</span><span class="comment">-- @param MarkerIndex The index of the player's marker, used to extract coordinates and relevant information for the missile strike.
</span><span class="comment">-- @return The spawned group responsible for executing the Tomahawk missile strike.
</span><a id="1162"></a><span class="comment">-- @usage spawner:TOMAHAWK(Player, MarkerIndex) -- Spawns a Tomahawk missile strike based on the specified player's marker and index.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.SPAWNER:TOMAHAWK(Player, MarkerIndex)
  <span class="comment">-- Build the packet for the Tomahawk strike using player information and marker index
</span>  <span class="keyword">local</span> Packet = SPECTRE.AI.buildPacket.TOMAHAWK(Player, MarkerIndex)

  <span class="comment">-- Find the group responsible for firing the Tomahawk missiles
</span>  <span class="keyword">local</span> FireGroup = GROUP:FindByName(Packet.alias_)

  <span class="comment">-- Instruct the group to fire at 5 random points around the marker's coordinates
</span>  <span class="keyword">for</span> _iCounter = <span class="number">1</span>, <span class="number">5</span> <span class="keyword">do</span>
    <span class="keyword">local</span> RandomPoint = Packet.Coordinate_:GetRandomVec2InRadius(<span class="number">10</span>)
    <span class="keyword">local</span> Task = FireGroup:TaskFireAtPoint(RandomPoint, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3221225470</span>)
    FireGroup:PushTask(Task, <span class="number">1</span>)
  <span class="keyword">end</span>

  <span class="comment">-- Remove the marker after the Tomahawk strike has been executed
</span>  SPECTRE.MARKERS.World.RemoveByID(Packet.MarkerID)

  <span class="comment">-- Schedule a restock of the Tomahawk missiles
</span>  self:scheduleRestock(Packet.coal, Packet.Type)
<span class="keyword">end</span>


<span class="comment">--- Spawn a bomber aircraft based on a player's marker and index.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for spawning a bomber aircraft in response to a player's directive.
</span><span class="comment">-- It uses the details provided in the player's marker to determine the bomber's flight path and spawn configuration.
</span><span class="comment">-- The function sets up the necessary parameters and then proceeds to spawn the bomber aircraft, ensuring that it
</span><span class="comment">-- follows the intended route and carries out the designated mission as per the player's strategy and gameplay dynamics.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.SPAWNER self The spawner instance from the player manager system.
</span><span class="comment">-- @param #PLYRMGR.Player Player The player who is executing the bomber operation.
</span><span class="comment">-- @param MarkerIndex The index of the player's marker, used to extract coordinates and relevant information for the bomber's mission.
</span><span class="comment">-- @return Spawned group of the bomber aircraft, fully configured and initiated for the mission.
</span><a id="1196"></a><span class="comment">-- @usage spawner:BOMBER(Player, MarkerIndex) -- Spawns a bomber aircraft based on the specified player's marker and index.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.SPAWNER:BOMBER(Player, MarkerIndex)
  <span class="comment">-- Build the packet for the bomber using player information and marker index
</span>  <span class="keyword">local</span> Packet = SPECTRE.AI.buildPacket.BOMBER(Player, MarkerIndex)

  <span class="comment">-- Set up the spawn configuration for the bomber
</span>  <span class="keyword">local</span> spawnGroup = SPAWN:NewWithAlias(Packet.alias_, <span class="global">string</span>.format(SPECTRE.MENU.Settings.BOMBER.AliasPrefix, Packet.code))
    :InitCoalition(Packet.coal_)
    :InitCountry(Packet.country_)
    :InitCleanUp(<span class="number">120</span>)
    :InitSkill(<span class="string">"Excellent"</span>)
    :OnSpawnGroup(
      <span class="keyword">function</span>(spawnGroup_, MANAGER)
        <span class="comment">-- Build the bomber's route using the spawn group and packet details
</span>        <span class="keyword">local</span> route = SPECTRE.AI.buildRoute.BOMBER(spawnGroup_, Packet)
        <span class="comment">-- Configure the spawn group for the bomber
</span>        spawnGroup_ = SPECTRE.AI.configureGroup.BOMBER(MANAGER, spawnGroup_, route, Packet)
      <span class="keyword">end</span>, self)

  <span class="comment">-- Set the initial heading of the spawn group towards the drop coordinates
</span>  spawnGroup:InitHeading(Packet.spawnCoord:HeadingTo(Packet.dropCoord))

  <span class="comment">-- Spawn the bomber group at the specified coordinates
</span>  spawnGroup:SpawnFromVec3(Packet.spawnCoord:GetVec3())

  <span class="keyword">return</span> spawnGroup
<span class="keyword">end</span>

<span class="comment">--- Spawn a strike group based on a player's marker and index.
</span><span class="comment">--
</span><span class="comment">-- This function is tasked with spawning a strike group in accordance with a player's instructions.
</span><span class="comment">-- It utilizes the information from the player's marker to determine the strike group's path and spawn configuration.
</span><span class="comment">-- After configuring the necessary parameters, the function proceeds to spawn the strike group, ensuring that it executes
</span><span class="comment">-- the intended mission in alignment with the player's strategic objectives. This functionality enhances the tactical aspect
</span><span class="comment">-- of gameplay, allowing players to influence in-game events through their decisions and actions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.SPAWNER self The spawner instance from the player manager system.
</span><span class="comment">-- @param #PLYRMGR.Player Player The player responsible for executing the strike operation.
</span><span class="comment">-- @param MarkerIndex The index of the player's marker, used to determine coordinates and details for the strike mission.
</span><span class="comment">-- @return Spawned group of the strike, fully prepared and configured for the operation.
</span><a id="1236"></a><span class="comment">-- @usage spawner:STRIKE(Player, MarkerIndex) -- Spawns a strike group based on the specified player's marker and index.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.SPAWNER:STRIKE(Player, MarkerIndex)
  <span class="comment">-- Build the packet for the strike using player information and marker index
</span>  <span class="keyword">local</span> Packet = SPECTRE.AI.buildPacket.STRIKE(Player, MarkerIndex)

  <span class="comment">-- Set up the spawn configuration for the strike group
</span>  <span class="keyword">local</span> spawnGroup = SPAWN:NewWithAlias(Packet.alias_, <span class="global">string</span>.format(SPECTRE.MENU.Settings.STRIKE.Transport.AliasPrefix, Packet.code))
    :InitCoalition(Packet.coal_)
    :InitCountry(Packet.country_)
    :InitCleanUp(<span class="number">120</span>)
    :InitSkill(<span class="string">"Excellent"</span>)
    :OnSpawnGroup(
      <span class="keyword">function</span>(spawnGroup_, MANAGER)
        <span class="comment">-- Build the strike's route using the spawn group and packet details
</span>        <span class="keyword">local</span> route = SPECTRE.AI.buildRoute.STRIKE(spawnGroup_, Packet)
        <span class="comment">-- Configure the spawn group for the strike
</span>        spawnGroup_ = SPECTRE.AI.configureGroup.STRIKE(MANAGER, spawnGroup_, route, Packet)
      <span class="keyword">end</span>, self)

  <span class="comment">-- Set the initial heading of the spawn group towards the target coordinates
</span>  spawnGroup:InitHeading(Packet.spawnCoord:HeadingTo(Packet.TargetCoord))

  <span class="comment">-- Spawn the strike group at the specified coordinates
</span>  spawnGroup:SpawnFromVec3(Packet.spawnCoord:GetVec3())

  <span class="keyword">return</span> spawnGroup
<span class="keyword">end</span>

<span class="comment">--- Spawn an airdrop group based on a player's marker and index.
</span><span class="comment">--
</span><span class="comment">-- This function facilitates the spawning of an airdrop group in alignment with a player's commands.
</span><span class="comment">-- It leverages the details from the player's marker to establish the airdrop path and configure the spawn settings.
</span><span class="comment">-- After setting up the necessary parameters, the function proceeds to spawn the airdrop group, ensuring that it
</span><span class="comment">-- adheres to the planned route and objectives, as dictated by the player's strategic decisions.
</span><span class="comment">-- This feature enriches the game by allowing players to directly influence logistical aspects through tactical airdrops.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.SPAWNER self The spawner instance within the player manager system.
</span><span class="comment">-- @param #PLYRMGR.Player Player The player orchestrating the airdrop operation.
</span><span class="comment">-- @param MarkerIndex The index of the player's marker, which provides coordinates and details for the airdrop.
</span><span class="comment">-- @return spawnGroup The spawned group for the airdrop, fully equipped and ready for the mission.
</span><a id="1276"></a><span class="comment">-- @usage spawner:AIRDROP(Player, MarkerIndex) -- Spawns an airdrop group based on the specified player's marker and index.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.SPAWNER:AIRDROP(Player, MarkerIndex)
  <span class="comment">-- Build the packet for the airdrop using player information and marker index
</span>  <span class="keyword">local</span> Packet = SPECTRE.AI.buildPacket.AIRDROP(Player, MarkerIndex)

  <span class="comment">-- Set up the spawn configuration for the airdrop group
</span>  <span class="keyword">local</span> spawnGroup = SPAWN:NewWithAlias(Packet.alias_, <span class="global">string</span>.format(SPECTRE.MENU.Settings.AIRDROP.AliasPrefix, Packet.code))
    :InitCoalition(Packet.coal_)
    :InitCountry(Packet.country_)
    :InitCleanUp(<span class="number">120</span>)
    :InitSkill(<span class="string">"Excellent"</span>)
    :OnSpawnGroup(
      <span class="keyword">function</span>(spawnGroup_, MANAGER)
        <span class="comment">-- Build the airdrop's route using the spawn group and packet details
</span>        <span class="keyword">local</span> route = SPECTRE.AI.buildRoute.AIRDROP(spawnGroup_, Packet)
        <span class="comment">-- Configure the spawn group for the airdrop
</span>        spawnGroup_ = SPECTRE.AI.configureGroup.AIRDROP(MANAGER, spawnGroup_, route, Packet)
      <span class="keyword">end</span>, self)

  <span class="comment">-- Set the initial heading of the spawn group towards the target coordinates
</span>  spawnGroup:InitHeading(Packet.spawnCoord:HeadingTo(Packet.TargetCoord))

  <span class="comment">-- Spawn the airdrop group at the specified coordinates
</span>  spawnGroup:SpawnFromVec3(Packet.spawnCoord:GetVec3())

  <span class="keyword">return</span> spawnGroup
<span class="keyword">end</span>

<span class="comment">--- MARKERS.
</span><span class="comment">-- This section defines the MARKERS field within the PLYRMGR namespace.
</span><span class="comment">-- The MARKERS table is used for managing and tracking various marker-related functionalities in the SPECTRE.PLYRMGR system.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.MARKERS
</span>SPECTRE.PLYRMGR.MARKERS = {}

<span class="comment">--- MARKERS Settings.
</span><span class="comment">-- This section contains various settings for the SPECTRE Custom Support Module related to markers.
</span><span class="comment">-- It includes configurations for different types of support operations such as CAP, Bomber, Tomahawk, etc.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.MARKERS.Settings
</span>SPECTRE.PLYRMGR.MARKERS.Settings = {}

<a id="1318"></a><span class="comment">--- Settings for Combat Air Patrol (CAP) markers.
</span>SPECTRE.PLYRMGR.MARKERS.Settings.CAP = {
  TagName = <span class="string">"/cap"</span>, <span class="comment">-- Tag used to identify CAP markers.
</span>  KeyWords = {<span class="string">"%d%d%d* %d+"</span>}, <span class="comment">-- Keywords or patterns recognized in CAP markers.
</span>  CaseSensitive = <span class="keyword">false</span>, <span class="comment">-- Specifies if the CAP marker recognition is case sensitive.
</span>  MarkerEnum = <span class="string">"CAP"</span> <span class="comment">-- Enumeration type for CAP markers.
</span>}

<a id="1326"></a><span class="comment">--- Settings for Tomahawk missile strike markers.
</span>SPECTRE.PLYRMGR.MARKERS.Settings.TOMAHAWK = {
  TagName = <span class="string">"/tomahawk"</span>, <span class="comment">-- Tag used to identify Tomahawk strike markers.
</span>  KeyWords = {}, <span class="comment">-- Keywords or patterns recognized in Tomahawk markers.
</span>  CaseSensitive = <span class="keyword">false</span>, <span class="comment">-- Specifies if the Tomahawk marker recognition is case sensitive.
</span>  MarkerEnum = <span class="string">"TOMAHAWK"</span> <span class="comment">-- Enumeration type for Tomahawk markers.
</span>}

<a id="1334"></a><span class="comment">--- Settings for Bomber strike markers.
</span>SPECTRE.PLYRMGR.MARKERS.Settings.BOMBER = {
  TagName = <span class="string">"/bomber"</span>, <span class="comment">-- Tag used to identify Bomber strike markers.
</span>  KeyWords = {}, <span class="comment">-- Keywords or patterns recognized in Bomber markers.
</span>  CaseSensitive = <span class="keyword">false</span>, <span class="comment">-- Specifies if the Bomber marker recognition is case sensitive.
</span>  MarkerEnum = <span class="string">"BOMBER"</span> <span class="comment">-- Enumeration type for Bomber markers.
</span>}

<a id="1342"></a><span class="comment">--- Settings for Airdrop operation markers.
</span>SPECTRE.PLYRMGR.MARKERS.Settings.AIRDROP = {
  TagName = <span class="string">"/airdrop"</span>, <span class="comment">-- Tag used to identify Airdrop markers.
</span>  KeyWords = {<span class="string">"%a"</span>}, <span class="comment">-- Keywords or patterns recognized in Airdrop markers.
</span>  CaseSensitive = <span class="keyword">false</span>, <span class="comment">-- Specifies if the Airdrop marker recognition is case sensitive.
</span>  MarkerEnum = <span class="string">"AIRDROP"</span>, <span class="comment">-- Enumeration type for Airdrop markers.
</span>  Types = { <span class="comment">-- Defines different types of airdrops.
</span>    TANK = <span class="string">"TANK"</span>,
    IFV = <span class="string">"IFV"</span>,
    ARTILLERY = <span class="string">"ARTILLERY"</span>,
    AAA = <span class="string">"AAA"</span>,
    IRSAM = <span class="string">"IRSAM"</span>,
    RDRSAM = <span class="string">"RDRSAM"</span>,
    EWR = <span class="string">"EWR"</span>,
    SUPPLY = <span class="string">"SUPPLY"</span>
  }
}

<a id="1360"></a><span class="comment">--- Settings for Strike operation markers.
</span>SPECTRE.PLYRMGR.MARKERS.Settings.STRIKE = {
  TagName = <span class="string">"/strike"</span>, <span class="comment">-- Tag used to identify Strike operation markers.
</span>  KeyWords = {}, <span class="comment">-- Keywords or patterns recognized in Strike markers.
</span>  CaseSensitive = <span class="keyword">false</span>, <span class="comment">-- Specifies if the Strike marker recognition is case sensitive.
</span>  MarkerEnum = <span class="string">"STRIKE"</span> <span class="comment">-- Enumeration type for Strike markers.
</span>}


<span class="comment">--- MARKERS TRACKERS.
</span><span class="comment">-- This section defines the TRACKERS field within the MARKERS namespace of PLYRMGR.
</span><span class="comment">-- The TRACKERS table is used for managing and tracking various types of player-made markers within the SPECTRE.PLYRMGR system.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.MARKERS.TRACKERS
</span>SPECTRE.PLYRMGR.MARKERS.TRACKERS = {}

<span class="comment">--- Tracker for player-made CAP markers.
</span><a id="1377"></a><span class="comment">-- This tracker specifically handles CAP (Combat Air Patrol) markers created by players, managing their interpretation and response within the game.
</span>SPECTRE.PLYRMGR.MARKERS.TRACKERS.CAP = {}

<span class="comment">--- Tracker for player-made TOMAHAWK markers.
</span><a id="1381"></a><span class="comment">-- This tracker is designated for managing and responding to TOMAHAWK strike markers that players place in the game.
</span>SPECTRE.PLYRMGR.MARKERS.TRACKERS.TOMAHAWK = {}

<span class="comment">--- Tracker for player-made BOMBER markers.
</span><a id="1385"></a><span class="comment">-- Responsible for handling markers related to bomber operations, this tracker interprets and responds to player directives for bomber strikes.
</span>SPECTRE.PLYRMGR.MARKERS.TRACKERS.BOMBER = {}

<span class="comment">--- Tracker for player-made AIRDROP markers.
</span><a id="1389"></a><span class="comment">-- This tracker oversees the handling of airdrop requests, ensuring that player-made airdrop markers are processed and acted upon correctly.
</span>SPECTRE.PLYRMGR.MARKERS.TRACKERS.AIRDROP = {}

<span class="comment">--- Tracker for player-made STRIKE markers.
</span><a id="1393"></a><span class="comment">-- This tracker deals with strike operation requests from players, managing markers related to various strike missions within the game.
</span>SPECTRE.PLYRMGR.MARKERS.TRACKERS.STRIKE = {}

<span class="comment">--- RESOURCES.
</span><span class="comment">-- This class within the SPECTRE.PLYRMGR module handles the management of resources available for various support functionalities.
</span><span class="comment">-- It maintains counters indicating the amount of resources available for both 'Red' and 'Blue' factions for each type of support (e.g., CAP, TOMAHAWK, etc.).
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.RESOURCES
</span>SPECTRE.PLYRMGR.RESOURCES = {}

<span class="comment">--- CAP support resource counters.
</span><span class="comment">-- These counters indicate the number of resources available for CAP (Combat Air Patrol) support for each faction.
</span><a id="1405"></a><span class="comment">-- @field #PLYRMGR.RESOURCES.CAP
</span>SPECTRE.PLYRMGR.RESOURCES.CAP = {
  Red = <span class="number">3</span>, <span class="comment">-- Resources for the Red faction.
</span>  Blue = <span class="number">3</span> <span class="comment">-- Resources for the Blue faction.
</span>}

<span class="comment">--- TOMAHAWK support resource counters.
</span><span class="comment">-- These counters indicate the number of resources available for TOMAHAWK support for each faction.
</span><a id="1413"></a><span class="comment">-- @field #PLYRMGR.RESOURCES.TOMAHAWK
</span>SPECTRE.PLYRMGR.RESOURCES.TOMAHAWK = {
  Red = <span class="number">3</span>,
  Blue = <span class="number">3</span>
}

<span class="comment">--- BOMBER support resource counters.
</span><span class="comment">-- These counters indicate the number of resources available for BOMBER support for each faction.
</span><a id="1421"></a><span class="comment">-- @field #PLYRMGR.RESOURCES.BOMBER
</span>SPECTRE.PLYRMGR.RESOURCES.BOMBER = {
  Red = <span class="number">3</span>,
  Blue = <span class="number">3</span>
}

<span class="comment">--- STRIKE support resource counters.
</span><span class="comment">-- These counters indicate the number of resources available for STRIKE support for each faction.
</span><a id="1429"></a><span class="comment">-- @field #PLYRMGR.RESOURCES.STRIKE
</span>SPECTRE.PLYRMGR.RESOURCES.STRIKE = {
  Red = <span class="number">3</span>,
  Blue = <span class="number">3</span>
}

<span class="comment">--- AIRDROP support resource counters for various types.
</span><span class="comment">-- These counters indicate the number of resources available for different types of AIRDROP support for each faction.
</span><a id="1437"></a><span class="comment">-- @field #PLYRMGR.RESOURCES.AIRDROP
</span>SPECTRE.PLYRMGR.RESOURCES.AIRDROP = {
  <span class="comment">--  Red = 3, -- General resources for the Red faction.
</span>  <span class="comment">--  Blue = 3, -- General resources for the Blue faction.
</span>  ARTILLERY = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- Artillery AIRDROP resources.
</span>  IFV = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- IFV AIRDROP resources.
</span>  TANK = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- Tank AIRDROP resources.
</span>  AAA = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- AAA AIRDROP resources.
</span>  IRSAM = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- SAM_IR AIRDROP resources.
</span>  RDRSAM = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- SAM_RDR AIRDROP resources.
</span>  EWR = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- EWR AIRDROP resources.
</span>  SUPPLY = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>} <span class="comment">-- Supply AIRDROP resources.
</span>}

<span class="comment">--- Import function for the <code>SPECTRE.PLYRMGR.RESOURCES</code> class.
</span><span class="comment">--
</span><span class="comment">-- This method is crucial for importing resource data into the <code>SPECTRE.PLYRMGR.RESOURCES</code> class.
</span><span class="comment">-- It specifically focuses on importing data related to the <code>AIRDROP</code> functionality.
</span><span class="comment">-- The method retrieves and integrates resource data from a specified file, ensuring that the system has up-to-date information
</span><span class="comment">-- on available resources for airdrop operations.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.RESOURCES
</span><a id="1459"></a><span class="comment">-- @return #PLYRMGR.RESOURCES self The updated instance of the <code>SPECTRE.PLYRMGR.RESOURCES</code> class with the imported airdrop data.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.RESOURCES:Import()
  <span class="keyword">local</span> _filename = SPECTRE._persistenceLocations.PLYRMGR.path .. <span class="string">"SupportResources/GroundResources.lua"</span>
  self.AIRDROP = SPECTRE.BRAIN.checkAndPersist(
    _filename,
    <span class="keyword">false</span>,
    self.AIRDROP,
    <span class="keyword">true</span>,
    <span class="keyword">function</span>(_Object)  <span class="comment">-- Update: Include _Object as a parameter
</span>      <span class="keyword">return</span> _Object  <span class="comment">-- Update: Pass _Object to the new function
</span>    <span class="keyword">end</span>
  )
  <span class="comment">--self.AIRDROP  = SPECTRE.IO.PersistenceFromFile(SPECTRE._persistenceLocations.PLYRMGR.path .. "SupportResources/GroundResources.lua")
</span>  <span class="keyword">return</span> self
<span class="keyword">end</span>

<span class="comment">--- COUNTERS.
</span><span class="comment">-- Counter for the amount of resources available for custom support functionalities.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.COUNTERS
</span>SPECTRE.PLYRMGR.COUNTERS = {
  CodeMarker = <span class="number">100</span>, <span class="comment">-- Overall Code Counter for generated marker operations.
</span>  CodeESCORT = <span class="number">1</span>, <span class="comment">-- Overall Code Counter for escort operations.
</span>  ID_ = <span class="number">6000</span> <span class="comment">-- Overall ID Counter for marker operations.
</span>}

<span class="comment">--- COUNTERS RESTOCK.
</span><span class="comment">-- Tracker for how many restock timers are active, allowing re-adding resources to the available pool if the mission restarts.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.COUNTERS.RESTOCK
</span>SPECTRE.PLYRMGR.COUNTERS.RESTOCK = {
  CAP = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- Counter for CAP resources with active restock timers.
</span>  TOMAHAWK = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- Counter for TOMAHAWK resources with active restock timers.
</span>  BOMBER = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- Counter for BOMBER resources with active restock timers.
</span>  STRIKE = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}, <span class="comment">-- Counter for STRIKE resources with active restock timers.
</span>  AIRDROP = { <span class="comment">-- Counters for various AIRDROP resources with active restock timers.
</span>    <span class="comment">--    Red = 3,
</span>    <span class="comment">--    Blue = 3,
</span>    ARTILLERY = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    IFV = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    TANK = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    AAA = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    IRSAM = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    RDRSAM = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    EWR = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>},
    SUPPLY = {Red = <span class="number">3</span>, Blue = <span class="number">3</span>}
  }
}

<span class="comment">--- Player TypeDef.
</span><span class="comment">-- This class is responsible for creating and managing Player Objects within the SPECTRE system.
</span><span class="comment">-- It encompasses all aspects related to player management, including attributes and state.
</span><span class="comment">-- @section SPECTRE.PLYRMGR
</span><span class="comment">-- @field #PLYRMGR.Player
</span>SPECTRE.PLYRMGR.Player = {
  MANAGER = {}, <span class="comment">-- Reference to the manager handling this player.
</span>  id = <span class="number">0</span>, <span class="comment">-- Unique identifier for the player.
</span>  name = <span class="string">""</span>, <span class="comment">-- Name of the player.
</span>  side = <span class="number">0</span>, <span class="comment">-- Side of the player (e.g., Red or Blue).
</span>  slot = <span class="number">0</span>, <span class="comment">-- Slot occupied by the player.
</span>  ucid = <span class="string">""</span>, <span class="comment">-- Unique Client ID of the player.
</span>  GROUP = {}, <span class="comment">-- Group to which the player belongs.
</span>  GroupName = <span class="string">""</span>, <span class="comment">-- Name of the player's group.
</span>  GroupID = <span class="number">0</span>, <span class="comment">-- Identifier for the player's group.
</span>  UnitName = <span class="string">""</span>, <span class="comment">-- Name of the unit the player is controlling.
</span>  UnitID = <span class="number">0</span>, <span class="comment">-- Identifier for the unit the player is controlling.
</span>  TypeName = <span class="string">""</span>, <span class="comment">-- Type of the unit the player is controlling.
</span>  Points = { <span class="comment">-- Points accrued by the player on each side.
</span>    [<span class="number">1</span>] = <span class="number">0</span>, <span class="comment">-- Points for side 1.
</span>    [<span class="number">2</span>] = <span class="number">0</span>, <span class="comment">-- Points for side 2.
</span>  }
}

<span class="comment">--- Creates a new SPECTRE.PLYRMGR.Player instance.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for constructing and initializing a new instance of the SPECTRE.PLYRMGR.Player class.
</span><span class="comment">-- It takes detailed information about the player and a reference to the managing entity within the SPECTRE system.
</span><span class="comment">-- The new player instance is set up with all necessary attributes, preparing it for interaction and management within the game environment.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The base instance from which the new player instance is derived.
</span><span class="comment">-- @param PlayerInfo Table containing details about the player, such as id, name, side, slot, and ucid.
</span><span class="comment">-- @param #PLYRMGR MANAGER Reference to the manager responsible for handling this player instance.
</span><span class="comment">-- @return #PLYRMGR.Player self The newly created and initialized player instance.
</span><a id="1542"></a><span class="comment">-- @usage local playerInstance = SPECTRE.PLYRMGR.Player:New(playerDetails, managerRef) -- Creates a new player instance.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:New(PlayerInfo, MANAGER)
  <span class="keyword">local</span> self = BASE:Inherit(self, SPECTRE:New()) <span class="comment">-- Inherit from the BASE class
</span>  self.MANAGER = MANAGER <span class="comment">-- Assign the manager reference to the player
</span>
  <span class="comment">-- Initialize player attributes from the provided PlayerInfo
</span>  self.id    = PlayerInfo[<span class="string">"id"</span>]
  self.name  = PlayerInfo[<span class="string">"name"</span>]
  self.side  = PlayerInfo[<span class="string">"side"</span>]
  self.slot  = PlayerInfo[<span class="string">"slot"</span>]
  self.ucid  = PlayerInfo[<span class="string">"ucid"</span>]

  <span class="keyword">return</span> self <span class="comment">-- Return the initialized player instance
</span><span class="keyword">end</span>

<span class="comment">--- Updates the player's slot data based on the given eventData.
</span><span class="comment">--
</span><span class="comment">-- This function is crucial for updating the attributes of a SPECTRE.PLYRMGR.Player instance using information from in-game events.
</span><span class="comment">-- It extracts and applies relevant data from the provided eventData to the player's instance, ensuring that the player's in-game
</span><span class="comment">-- information is accurately reflected and up to date. This includes updating group names, unit names, IDs, and other pertinent details.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The player instance to be updated.
</span><span class="comment">-- @param eventData Table containing event-related details, used to update the player's slot data.
</span><span class="comment">-- @return #PLYRMGR.Player self The updated player instance with the latest slot data.
</span><a id="1566"></a><span class="comment">-- @usage playerInstance:SlotDataUpdate(eventDetails) -- Updates the player's slot data based on event details.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:SlotDataUpdate(eventData)
  <span class="comment">-- Update player attributes using the eventData
</span>  self.GroupName  = eventData.IniGroupName
  self.GroupID    = eventData.IniDCSGroup.id_
  self.UnitName   = eventData.IniUnitName
  self.UnitID     = eventData.initiator.id_
  self.TypeName   = eventData.IniTypeName
  self.GROUP      = GROUP:FindByName(self.GroupName) <span class="comment">-- Find the group object by the group name
</span>
  <span class="keyword">return</span> self <span class="comment">-- Return the updated player instance
</span><span class="keyword">end</span>

<span class="comment">--- Import player data.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for importing player data into a SPECTRE.PLYRMGR.Player instance. It attempts to retrieve the player's
</span><span class="comment">-- data from a pre-existing database. If the specific player's data is not found in the database, it assigns default values to the player's
</span><span class="comment">-- instance. This ensures that each player has the necessary data loaded for their gameplay, whether it's retrieved from stored data or initialized
</span><span class="comment">-- with default settings.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player
</span><span class="comment">-- @return #PLYRMGR.Player self The updated player instance with either imported data or default values.
</span><a id="1588"></a><span class="comment">-- @usage playerInstance:ImportData() -- Imports data for the given player.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:ImportData()
  <span class="comment">-- Define the path to the player database and the specific player's data file.
</span>
  <span class="keyword">local</span> force = force <span class="keyword">or</span> <span class="keyword">false</span>
  <span class="keyword">local</span> _Randname = name_ <span class="keyword">or</span> <span class="global">os</span>.time()
  <span class="keyword">local</span> _filename =  SPECTRE._persistenceLocations.PLYRMGR.path .. <span class="string">"PlayerDB/"</span> .. self.ucid .. <span class="string">".lua"</span>
  self.Points = SPECTRE.BRAIN.checkAndPersist(
    _filename,
    force,
    self.Points,
    self._persistence,
    <span class="keyword">function</span>(_Object)  <span class="comment">-- Update: Include _Object as a parameter
</span>      _Object[<span class="number">1</span>] = <span class="number">100</span>
      _Object[<span class="number">2</span>] = <span class="number">100</span>
      <span class="keyword">return</span> _Object  <span class="comment">-- Update: Pass _Object to the new function
</span>    <span class="keyword">end</span>
  )



  <span class="comment">--  -- Check if the player's data file exists.
</span>  <span class="comment">--  if lfs.attributes(PlayerDatabase_File) then
</span>  <span class="comment">--    -- Load the player's data from the file.
</span>  <span class="comment">--    LoadedDatabase = SPECTRE.IO.PersistenceFromFile(PlayerDatabase_File)
</span>  <span class="comment">--    -- If the database is loaded successfully, extract the player's point values.
</span>  <span class="comment">--    self.Points[1] = LoadedDatabase["pointsred"] or 100
</span>  <span class="comment">--    self.Points[2] = LoadedDatabase["pointsblue"] or 100
</span>  <span class="comment">--  else
</span>  <span class="comment">--    -- If the player's data file doesn't exist, assign default values.
</span>  <span class="comment">--    self.Points[1] = 100
</span>  <span class="comment">--    self.Points[2] = 100
</span>  <span class="comment">--  end
</span>
  <span class="keyword">return</span> self  <span class="comment">-- Return the updated player instance.
</span><span class="keyword">end</span>

<span class="comment">--- Stores the player's data, specifically points for red and blue teams, in a designated file.
</span><span class="comment">--
</span><span class="comment">-- This function handles the persistent storage of player data for the SPECTRE.PLYRMGR.Player instance. It ensures that the necessary directory
</span><span class="comment">-- and data file exist for storing the player's data. The function constructs a data structure comprising the player's points for the red and
</span><span class="comment">-- blue teams, then saves this data in the player's designated file. If the directory or file does not exist, they are created to facilitate
</span><span class="comment">-- data storage, ensuring that player's progress and points are retained across game sessions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player
</span><span class="comment">-- @return #PLYRMGR.Player self The player instance after storing its data.
</span><a id="1634"></a><span class="comment">-- @usage playerInstance:StoreData() -- Persists the player's data in the designated file.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:StoreData()
  <span class="comment">-- Define the path to the player database and the specific player's data file.
</span>  <span class="keyword">local</span> PlayerDatabase_Path = SPECTRE._persistenceLocations.PLYRMGR.path .. <span class="string">"PlayerDB/"</span><span class="comment">--lfs.writedir() .. "SPECTRE/PlayerDatabase/"
</span>  <span class="keyword">local</span> PlayerDatabase_File = PlayerDatabase_Path .. self.ucid .. <span class="string">".lua"</span>

  <span class="comment">--  -- Ensure the directory exists or create it if not.
</span>  <span class="comment">--  SPECTRE.IO.DirExists(PlayerDatabase_Path)
</span>  <span class="comment">--
</span>  <span class="comment">--  -- Ensure the player's data file exists or create it if not.
</span>  <span class="comment">--  SPECTRE.IO.FileExists(PlayerDatabase_File)
</span>
  <span class="comment">-- Store the data structure in the player's data file.
</span>  SPECTRE.IO.PersistenceToFile(PlayerDatabase_File, self.Points)

  <span class="keyword">return</span> self <span class="comment">-- Return the player instance
</span><span class="keyword">end</span>

<span class="comment">--- Updates the player's points based on their side with a specified reward.
</span><span class="comment">--
</span><span class="comment">-- This function is crucial for managing the scoring system within the SPECTRE.PLYRMGR.Player instance.
</span><span class="comment">-- It identifies the player's current side (either red or blue) and increases their points by the specified reward amount.
</span><span class="comment">-- This allows for dynamic point allocation based on player actions and achievements in the game, ensuring an accurate reflection
</span><span class="comment">-- of their performance.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The instance of the player object to be updated.
</span><span class="comment">-- @param pointReward The amount of points to be added to the player's current points tally.
</span><span class="comment">-- @return #PLYRMGR.Player self The player instance after updating the points.
</span><a id="1662"></a><span class="comment">-- @usage playerInstance:UpdatePoints(10) -- Adds 10 points to the player's current points based on their side.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:UpdatePoints(pointReward)
  <span class="comment">-- Update the player's points based on their side with the given reward.
</span>  self.Points[self.side] = self.Points[self.side] + pointReward

  <span class="keyword">return</span> self <span class="comment">-- Return the updated player instance.
</span><span class="keyword">end</span>

<span class="comment">--- Generates and displays a welcome message for the player.
</span><span class="comment">--
</span><span class="comment">-- This function is designed to create a personalized welcome message for the player using a predefined report template.
</span><span class="comment">-- The message includes information about the player's current points, specific to their side (either red or blue).
</span><span class="comment">-- Once constructed, this welcome message is displayed to the player within the game, providing them with essential information
</span><span class="comment">-- and a warm introduction or reminder at the start of or during the gameplay.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player
</span><span class="comment">-- @return #PLYRMGR.Player self The player instance after the welcome message has been displayed.
</span><a id="1679"></a><span class="comment">-- @usage playerInstance:WelcomeMessage() -- Displays the welcome message to the player.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:WelcomeMessage()
  <span class="keyword">local</span> report = SPECTRE.UTILS.ReportGenerator(SPECTRE.PLYRMGR.Settings.Reports.Welcome)
  report:Add(<span class="string">""</span>)
  report:AddIndent(<span class="string">"You have: "</span> .. self.Points[self.side] .. <span class="string">" points."</span>, <span class="string">"--"</span>)
  trigger.action.outTextForGroup(self.GroupID, report:Text(), <span class="number">20</span>)
<span class="keyword">end</span>

<span class="comment">--- Limits the maximum number of markers a player can have for a specific type.
</span><span class="comment">--
</span><span class="comment">-- This function plays a crucial role in managing the number of active markers a player can have for a particular type,
</span><span class="comment">-- such as "CAP" or "STRIKE". It checks the current count of markers against a specified limit. If the number exceeds the limit,
</span><span class="comment">-- the function systematically removes the oldest markers until the count aligns with the limit. This ensures a manageable
</span><span class="comment">-- number of markers for each type, preventing clutter and maintaining organization within the game's interface.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The player instance whose markers are to be limited.
</span><span class="comment">-- @param type The type of marker to limit (e.g., "CAP", "STRIKE").
</span><span class="comment">-- @param limit The maximum number of markers allowed for the specified type.
</span><span class="comment">-- @return #PLYRMGR.Player self The player instance after applying the marker limit.
</span><a id="1698"></a><span class="comment">-- @usage playerInstance:LimitMaxMarkers("CAP", 5) -- Ensures that the player has no more than 5 CAP markers.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:LimitMaxMarkers(<span class="global">type</span>, limit)
  <span class="comment">-- Get the current number of markers of the specified type for the player.
</span>  <span class="keyword">local</span> CurrentAmountMarkers = #self.Markers[<span class="global">type</span>].MarkerArrays

  <span class="comment">-- Calculate the number of markers to remove.
</span>  <span class="keyword">local</span> AmountToRemove = CurrentAmountMarkers - limit

  <span class="comment">-- If the player exceeds the marker limit...
</span>  <span class="keyword">if</span> AmountToRemove &gt; <span class="number">0</span> <span class="keyword">then</span>
    <span class="comment">-- Remove the oldest markers until the limit is met.
</span>    <span class="keyword">for</span> _i = <span class="number">1</span>, AmountToRemove, <span class="number">1</span> <span class="keyword">do</span>
      <span class="comment">-- Remove the marker from the in-game display.
</span>      trigger.action.removeMark(self.Markers[<span class="global">type</span>].MarkerArrays[<span class="number">1</span>].PermMarkerID)

      <span class="comment">-- Remove the marker from the player's internal list.
</span>      <span class="global">table</span>.remove(self.Markers[<span class="global">type</span>].MarkerArrays, <span class="number">1</span>)
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">return</span> self <span class="comment">-- Return the player instance.
</span><span class="keyword">end</span>

<span class="comment">--- Set up a submenu for a specific menu type for a player.
</span><span class="comment">--
</span><span class="comment">-- This function is responsible for setting up a submenu of a specific type (e.g., "CAP", "STRIKE") for a player within the SPECTRE.PLYRMGR system.
</span><span class="comment">-- It creates menu items and commands based on the chosen type, integrating them into the player's group menu. This includes creating options
</span><span class="comment">-- for point balance, instructions, and specific actions related to the menu type. The function enhances the interactive aspect of the game by
</span><span class="comment">-- providing players with tailored menu options that correspond to their in-game choices and actions.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The player instance for which the submenu is to be set up.
</span><span class="comment">-- @param menuType The type of menu to set up (e.g., "CAP", "STRIKE").
</span><span class="comment">-- @param #PLYRMGR MANAGER The player manager instance responsible for the overall menu system.
</span><a id="1731"></a><span class="comment">-- @return #PLYRMGR.Player self The player instance after the submenu setup.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:setupSubMenu(menuType, MANAGER)

  <span class="comment">-- Extract relevant references for the menu type.
</span>  <span class="keyword">local</span> marker = self.Markers[menuType]
  <span class="keyword">local</span> menuText = SPECTRE.MENU.Text[menuType]
  <span class="keyword">local</span> printInstructions = SPECTRE.MENU.Print.Instructions_

  <span class="comment">-- Create the main menu and associated commands for the player's group.
</span>  marker.MenuArrays.Main = MENU_GROUP:New(self.GROUP, menuText.Title, self.MainMenu)
  marker.MenuArrays.PointBalance = MENU_GROUP_COMMAND:New(self.GROUP, SPECTRE.MENU.Text.Main.PrintPoints, marker.MenuArrays.Main, SPECTRE.MENU.Print.Balance, self)
  marker.MenuArrays.Instructions = MENU_GROUP_COMMAND:New(self.GROUP, SPECTRE.MENU.Text.Main.PrintInstructions, marker.MenuArrays.Main, printInstructions, menuType, self)

  <span class="comment">--  -- Special menu handling for Escort type.
</span>  <span class="comment">--  if menuType == MANAGER.MARKERS.Settings.ESCORT.MarkerEnum then
</span>  <span class="comment">--  --marker.MenuArrays.Request = MENU_GROUP_COMMAND:New(self.GROUP, menuText.Title, marker.MenuArrays.Main, SPECTRE.MENU.SPAWNER.Menu.Escort, self)
</span>  <span class="comment">--  end
</span>
  <span class="comment">-- Special menu handling for Airdrop type.
</span>  <span class="keyword">if</span> menuType == MANAGER.MARKERS.Settings.AIRDROP.MarkerEnum <span class="keyword">then</span>
    marker.MenuArrays.PointCost = MENU_GROUP_COMMAND:New(self.GROUP, menuText.Cost, marker.MenuArrays.Main, SPECTRE.MENU.Print.AirdropCost, self)
  <span class="keyword">else</span>
    marker.MenuArrays.PointCost = MENU_GROUP_COMMAND:New(self.GROUP, menuText.Cost, marker.MenuArrays.Main, SPECTRE.MENU.Print.NULL)
  <span class="keyword">end</span>

  <span class="comment">-- Create a menu option for each marker associated with the player.
</span>  <span class="keyword">for</span> Index_ = <span class="number">1</span>, #marker.MarkerArrays, <span class="number">1</span> <span class="keyword">do</span>
    <span class="keyword">local</span> MARKER_OPTION_ = MENU_GROUP_COMMAND:New(self.GROUP, <span class="string">"Spawn ID: "</span> .. menuType .. marker.MarkerArrays[Index_].code ,marker.MenuArrays.Main,SPECTRE.MENU.Buttons.Dispatcher, MANAGER, self, menuType, Index_)
  <span class="keyword">end</span>

  <span class="keyword">return</span> self <span class="comment">-- Return the player instance.
</span><span class="keyword">end</span>

<span class="comment">--- Set up the main menu and associated submenus for a player.
</span><span class="comment">--
</span><span class="comment">-- This function creates the main menu for a player and populates it with various submenus and commands, based on the player's available support options.
</span><span class="comment">-- It checks the support settings in the manager and, for each enabled support type, sets up the corresponding submenu. This allows players to interact
</span><span class="comment">-- with different aspects of the game, such as earning points or initiating specific support actions, directly through an in-game menu system.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The player instance for which the main menu and submenus are to be set up.
</span><span class="comment">-- @param #PLYRMGR MANAGER The player manager instance, used to reference support settings and functionalities.
</span><a id="1772"></a><span class="comment">-- @return #PLYRMGR.Player self The player instance after setting up the main menu and submenus.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:setupMenu(MANAGER)

  <span class="comment">-- Create the main menu for the player's group.
</span>  self.MainMenu = MENU_GROUP:New(self.GROUP, SPECTRE.MENU.Text.Main.Title)

  <span class="comment">-- Add a command in the main menu to show information on earning points.
</span>  <span class="keyword">local</span> EarningPoints = MENU_GROUP_COMMAND:New(self.GROUP, SPECTRE.MENU.Text.Main.InfoPoints, self.MainMenu, SPECTRE.MENU.Print.Instructions.EarningPoints, self)

  <span class="comment">-- Loop through the support settings in the manager.
</span>  <span class="comment">-- If a support setting is enabled (set to true), then set up the associated submenu for that type.
</span>  <span class="keyword">for</span> _k, _v <span class="keyword">in</span> <span class="global">pairs</span>(MANAGER.Settings.Support) <span class="keyword">do</span>
    <span class="keyword">if</span> _v == <span class="keyword">true</span> <span class="keyword">then</span>
      self:setupSubMenu(_k,MANAGER)
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">return</span> self <span class="comment">-- Return the player instance.
</span><span class="keyword">end</span>

<span class="comment">--- Clear world markers associated with the player based on a given flag.
</span><span class="comment">--
</span><span class="comment">-- This function is designed to remove specific types of world markers associated with the player, based on the provided numeric flag.
</span><span class="comment">-- It maps flags to corresponding marker types (e.g., "CAP", "TOMAHAWK", "BOMBER", etc.) and clears those markers from the game world.
</span><span class="comment">-- This allows for selective removal of markers, ensuring that the game environment remains organized and clutter-free,
</span><span class="comment">-- especially in scenarios where numerous markers may be present.
</span><span class="comment">--
</span><span class="comment">-- @param #PLYRMGR.Player self The player instance whose markers are to be cleared.
</span><span class="comment">-- @param flag Numeric flag determining which types of markers to clear (0 for all, 1 for "CAP", etc.).
</span><a id="1801"></a><span class="comment">-- @return #PLYRMGR.Player self The player instance after clearing the specified markers.
</span><span class="keyword">function</span> SPECTRE.PLYRMGR.Player:ClearWorldMarkers(flag)

  <span class="comment">-- Mapping of flags to marker types.
</span>  <span class="keyword">local</span> flagToMarkerType = {
    [<span class="number">0</span>] = {<span class="string">"CAP"</span>, <span class="string">"TOMAHAWK"</span>, <span class="string">"BOMBER"</span>, <span class="string">"AIRDROP"</span>, <span class="string">"STRIKE"</span>},
    [<span class="number">1</span>] = {<span class="string">"CAP"</span>},
    [<span class="number">2</span>] = {<span class="string">"TOMAHAWK"</span>},
    [<span class="number">3</span>] = {<span class="string">"BOMBER"</span>},
    [<span class="number">4</span>] = {<span class="string">"AIRDROP"</span>},
    [<span class="number">5</span>] = {<span class="string">"STRIKE"</span>},
  }

  <span class="comment">-- Identify the marker types to be cleared based on the flag.
</span>  <span class="keyword">local</span> markers = flagToMarkerType[flag]

  <span class="comment">-- If no marker types are identified for the given flag, exit the function.
</span>  <span class="keyword">if</span> <span class="keyword">not</span> markers <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">end</span>

  <span class="comment">-- Loop through the identified marker types.
</span>  <span class="keyword">for</span> _, markerType <span class="keyword">in</span> <span class="global">ipairs</span>(markers) <span class="keyword">do</span>
    <span class="keyword">local</span> markerArray = self.Markers[markerType].MarkerArrays

    <span class="comment">-- Loop through each marker of the current type and remove it from the world.
</span>    <span class="keyword">for</span> _i, markerData <span class="keyword">in</span> <span class="global">ipairs</span>(markerArray) <span class="keyword">do</span>
      trigger.action.removeMark(markerData.PermMarkerID)
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">return</span> self <span class="comment">-- Return the player instance.
</span><span class="keyword">end</span>
<span class="comment">--- SPECTRE.PLYRMGR.Player.Markers.
</span><span class="comment">-- This table stores marker-related data for different types of operations within the SPECTRE.PLYRMGR.Player class.
</span><a id="1834"></a><span class="comment">-- @field #PLYRMGR.Player.Markers
</span>SPECTRE.PLYRMGR.Player.Markers = {}

<span class="comment">--- CAP Markers.
</span><span class="comment">-- Stores arrays for CAP (Combat Air Patrol) markers and associated menus.
</span><a id="1839"></a><span class="comment">-- @field #PLYRMGR.Player.Markers.CAP
</span>SPECTRE.PLYRMGR.Player.Markers.CAP = {
  MarkerArrays = {}, <span class="comment">-- Array to store marker data for CAP operations.
</span>  MenuArrays = {} <span class="comment">-- Array to store menu data for CAP operations.
</span>}

<span class="comment">--- TOMAHAWK Markers.
</span><span class="comment">-- Stores arrays for TOMAHAWK missile strike markers and associated menus.
</span><a id="1847"></a><span class="comment">-- @field #PLYRMGR.Player.Markers.TOMAHAWK
</span>SPECTRE.PLYRMGR.Player.Markers.TOMAHAWK = {
  MarkerArrays = {}, <span class="comment">-- Array to store marker data for TOMAHAWK strikes.
</span>  MenuArrays = {} <span class="comment">-- Array to store menu data for TOMAHAWK strikes.
</span>}

<span class="comment">--- BOMBER Markers.
</span><span class="comment">-- Stores arrays for bomber strike markers and associated menus.
</span><a id="1855"></a><span class="comment">-- @field #PLYRMGR.Player.Markers.BOMBER
</span>SPECTRE.PLYRMGR.Player.Markers.BOMBER = {
  MarkerArrays = {}, <span class="comment">-- Array to store marker data for bomber strikes.
</span>  MenuArrays = {} <span class="comment">-- Array to store menu data for bomber strikes.
</span>}

<span class="comment">--- AIRDROP Markers.
</span><span class="comment">-- Stores arrays for airdrop operation markers and associated menus.
</span><a id="1863"></a><span class="comment">-- @field #PLYRMGR.Player.Markers.AIRDROP
</span>SPECTRE.PLYRMGR.Player.Markers.AIRDROP = {
  MarkerArrays = {}, <span class="comment">-- Array to store marker data for airdrop operations.
</span>  MenuArrays = {} <span class="comment">-- Array to store menu data for airdrop operations.
</span>}

<span class="comment">--- STRIKE Markers.
</span><span class="comment">-- Stores arrays for strike operation markers and associated menus.
</span><a id="1871"></a><span class="comment">-- @field #PLYRMGR.Player.Markers.STRIKE
</span>SPECTRE.PLYRMGR.Player.Markers.STRIKE = {
  MarkerArrays = {}, <span class="comment">-- Array to store marker data for strike operations.
</span>  MenuArrays = {} <span class="comment">-- Array to store menu data for strike operations.
</span>}</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2024-01-06 07:03:52 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
